<template name=Help><h2><i>Welcome to OS13k!</i></h2><p>OS13k is a tiny operating system designed for JS13k.<p>Play JS13k games to earn trophies and unlock music. <a href=https://github.com/KilledByAPixel/OS13k target=_blank>More info on GitHub.</a><p>‚úåÔ∏èüòÑ ‚ù§Ô∏è OS13k Team</template>

<template name=Settings><style>body{background:#111;color:#fff;user-select:none;text-align:center}</style>
Volume <input type=range id=V oninput=s() style=width:99>&nbsp;&nbsp;
Music <input type=range id=M oninput=s() style=width:99><br><br>
System Sounds <input type=checkbox id=Y oninput=s()>&nbsp;&nbsp;
Speech <input type=checkbox id=S oninput=s()>&nbsp;&nbsp;
Popups <input type=checkbox id=P oninput=s()>
<br><br>Background
<input id=C type=color oninput=s()>&nbsp;&nbsp;
<input id=D type=color oninput=s()>&nbsp;&nbsp;
<input id=T oninput=s()><span id=F></span><script>s=e=>parent.OS13k.SaveSettings(V.value/100,M.value/100,S.checked,P.checked,Y.checked,D.value,C.value,T.value,t),s(i=parent.OS13k.Settings(),V.value=100*i.v,M.value=100*i.m,S.checked=i.s,P.checked=i.p,Y.checked=i.o,C.value=i.d,D.value=i.c,T.value=i.t,t=i.f)</script></template>

<template name="Trophy Case"><style>body{background:#232}</style>&nbsp;<script>OS13kReload=()=>{for(t of(this.document.body.innerHTML="",parent.OS13k.Trophies()))this.document.body.innerHTML+=`<div style='display:inline-block;font-family:arial;padding:9;overflow:hidden;text-align:center;background:linear-gradient(#eee,#888);width:120;height:120;margin:9;font-size:18;box-shadow:5px 5px 9px;border:2px solid;border-radius:29px'title='${i=t[0]||"üèÜ"} ${n=t[2]}\n${g=t[1]}\n${m=t[3]}'onmousedown='parent.OS13k.Speak(\`${n}\`,1,1,1,"ja",1)'><div style='padding:3;white-space:nowrap;font-size:28;text-shadow:2px 2px 4px'>${i}</div><div><b>${n}</b><br><i>${g}</i><br><div style=font-size:14>${m}</div></div></div>`},OS13kReload()</script></template>

<template name="Sticky Note"><style>*{background:#ff8;font-family:cursive;font-size:23}</style>&nbsp;<script>b=document.body;b.setAttribute("contenteditable",true);b.spellcheck=false;b.innerHTML=localStorage.OS13kN||'';b.oninput=e=>localStorage.OS13kN=b.innerHTML;OS13kReload=e=>b.innerHTML=localStorage.OS13kN='';b.focus();</script></template>

<template name=Clock>D=Date(L=(t,e,l,o=-6)=>x.fillRect(-e/2,o,e,l,x.rotate(-a+(a=Math.PI*(2*t-1)))));if(c.title!=D){document.hasFocus()&&OS13k.PlaySeed(6,.1,1,.01);c.title=D;c.style.background='#111';c.width=198;x.translate(99,99);D=D.slice(16,24).split`:`;for(a=i=0;61>i++;L(i/60,2,i%5?3:8,88))x.fillStyle='#fff';L(D[0]%12/12+D[1]/720,6,59);L(D[1]/60,3,85);x.fillStyle='#f00';L(D[2]/60,2,99)}</template>

<template name="Music Player"><style>body{background:#111;color:#fff;user-select:none;text-align:center;overflow-x:hidden;white-space:nowrap}</style><div id=N style=font-size:27;font-family:arial>&nbsp;</div><div id=F style=height:9></div><br><button onmousedown=P()>Play</button>
<button onmousedown=X&&X.stop(X=0)>Stop</button>
<button onmousedown=A()>Load</button>
<button onmousedown=R()>Delete</button><br><br>Volume <input type=range id=V>
Loop <input type=checkbox id=O><br><canvas id=C style=width:350;height:29;image-rendering:-moz-crisp-edges;image-rendering:pixelated></canvas><br><select id=S size=9 style=width:350;background:#000;color:#fff><script>OS13k=parent.OS13k,X=E=T=0,Q=-1,U=e=>{Q<0||(l=L[Q],T=0,Q=-1,(X=OS13k.PlayMusic(l.d))||alert`‚ö†Ô∏è Error!`),C.getContext`2d`.drawImage(OS13k.GetAnalyser(),0,0,C.width=32,C.height=32),F.innerText=X?(X.gain.gain.value=V.value/100,d=X.buffer.duration,T+=.05,X.loop=O.checked?T%=d:T>d&&X.stop(X=0),W(T)+"/"+W(d)):(N.innerText="OS13k Music Player","")},B=e=>{for(e in i=S.selectedIndex,S.innerHTML="",Z=0,L=[],localStorage)I(e);L.sort((e,n)=>e.n.localeCompare(n.n)).map(e=>S.innerHTML+=`<option>${e.n}</option>`),S.selectedIndex=OS13k.Clamp(E?L.findIndex(e=>e.k==E):i,S.length-1,E=0),localStorage.OS13kM=JSON.stringify(K)},I=e=>{if(p=e.split`,`,f=p.shift(),"OS13kMusic"==f.substring(0,10)){n=p[0]?p[0]:"Untitled","U"==f.substring(10,11)?Z=Math.max(Z,f.substring(11)):K.indexOf(e)<0&&(OS13k.Popup("üéµ New Music<br><b>"+n,n),K.push(e));try{(d=J(localStorage[e]))&&L.push({d:d,k:e,n:n})}catch(e){}}},P=e=>{X&&X.stop(X=0),(Q=S.selectedIndex)<0||(N.innerText=L[Q].n,F.innerText="Loading...")},A=e=>{try{parent.zzfxM(...J(d=prompt`ZzFXM Data`)),B(localStorage[E=`OS13kMusicU${Z+1},`+prompt`Name`.replace(/,/g,"")]=d)}catch(e){alert`‚ö†Ô∏è Error!`}},R=e=>confirm(`‚ö†Ô∏è Delete ${L[S.selectedIndex].n}?`)&&B(localStorage[L[S.selectedIndex].k]=0),J=k=>k.replace(/null|[[\],\d\.-]/g,"")||eval(k.replace(/null/g,void 0)),W=e=>(e/60|0)+((e=e%60|0)<=9?":0":":")+e,localStorage["OS13kMusic,OS13k Test"]=JSON.stringify([[[,0,219,,,,,1.1,,-.1,-50,-.05,-.01,1],[2,0,84,,,.1,,.7,,,,.5,,6.7,1,.05]],[[[0,-1,1,0,5.5,0],[1,1,8,8.3,3,0]]],[0,0,0,0],4]),K=localStorage.OS13kM?JSON.parse(localStorage.OS13kM):[],B(onunload=e=>X&&X.stop()),setInterval(U,50)</script></template>

<template name=Visualizer>for(x.fillRect(0,0,2e3,2e3),x.fillStyle="#0003",t?x.lineWidth=9:h=[],x.strokeStyle="#fff",i=32;i--;x.beginPath(x.strokeStyle=`hsl(${-99-i*360/32} 99%${9+m/2}%)`,x.stroke()))for(m=199*OS13k.GetAnalyserData(i),j=5;j--;)x.arc(960,540,256+(j+1&2?1:-1)*m,a=2*((2&j)/2-8.5+i)*Math.PI/32,a);x.drawImage(c,-40,-20,2e3,1120)</template>

<template name="Don't Fall">for(t||(A=B=P=8,a=b=p=0),I=OS13k.Input(window),a=-I.x/2,k=I.y,b-=.006,A-=a,B-=b,r=.2-B/240,P-=r,B+=r,c.width=512,i=3e3;X=63&i,Y=i>>6,i--;x.fillRect(8*X,8*Y,8,8))y=Y/3+B+P,z=X/3+4*(y>>4),G=T(y+z^z-y),M=G>5,A^X|B^Y|!M||(OS13k.PlaySeed(96*G,p+k*k,.3),b=k?p/3:.2,p=k?0:p>1?1:p+G%2/12),y-=P/2,z+=A/3,g=T(y+z^z-y),m=t<32?12+g%8+Y-B:(G^g)+Y-B&31,x.fillStyle=`hsl(${M*G*30+m}deg 99%${50*M+m*(1-S(t/16)**3)/2}%`;x.font=16+16*p+"px a",x.fillText(k?"üôâ":"üêµ",8*A-8-8*p,8*B),B<48&&OS13k.Trophy([..."üê¢ü¶íü¶âü¶áü¶úüïäüêíü¶Ö"][y=32-y>>5],"Don't Fall",16*y+"ft")</template>

<template name="Bogus Slopes">i=OS13k.Input(window),(!t||i.keypress[32])&&(T=U=V=F=0,W=[],Y=540,X=-700),X>0||(x.fillStyle="#ddd8",x.fillRect(0,0,2e3,2e3),x.font='9em"',x.textAlign="center",x.textBaseline="middle",x.scale(-1,1),F=Math.min(F+.2,19+T/1e4),W.push((60*t|0)%Math.max(9,19-T/1e4|0)?{t:"‚óè",x:X,y:Y,c:`hsl(${T} 99%${U<-1?50:100}%)`}:{t:[..."üå≤üå≥‚≠ê"][2*Math.random()+(Math.random()<.1)|0],x:-2200,y:79+900*Math.random()}),W=W.filter(t=>(x.fillStyle=t.c||R(),x.fillText(t.t,t.x+=F*("‚≠ê"==t.t?.7:1),t.y),t.x<99&&("‚óè"==t.t||(Math.hypot(X-t.x,Y-t.y)>99?1:(OS13k.PlaySeed("‚≠ê"==t.t?169:121),U="‚≠ê"==t.t?-9:F=9,0))))),x.fillText("üèÇüèª",X=Math.max(X+(U*=.98),-1800),Y=OS13k.Clamp(Y+(V=.95*V-i.y),1e3,99)),x.scale(-1,1),x.textAlign="left",x.fillStyle=R(),x.fillText(s=(T+=F)/1e3|0,9,99),x.textAlign="right",x.fillStyle=R(255,0,0,9-t),x.fillText(d=OS13k.GetTrophy("Bogus Slopes","High Score"),c.width-9,99),s>99&&OS13k.Trophy("‚≠ê","Bogus Slopes","100!"),X>0&&(OS13k.PlaySeed(370,5),s>d&&OS13k.Trophy("üèÇüèª","Bogus Slopes","High Score",s)))</template>

<template name=Ziano><style>body{background:#111;color:#fff;user-select:none;text-align:center}</style><span id=B></span>üå± <input onchange=B() style=width:240 id=S><p>üîä <input onchange=B() style=width:99 type=range id=V> üìê <input onchange=B() style=width:99 type=range id=L><script>OS13k=parent.OS13k,B=e=>P(0,R(),setTimeout(e=>X(0),500)),R=e=>{for(onblur(D=[]),i=5;--i;D[i]=OS13k.SeedSamples(S.value,.5+L.value/5,1,0,OS13k.Note(12*i-33)));},P=e=>e<0||A[e]||((A[e]=OS13k.PlaySamples(D[2+e/12|0],2)).detune.value=e%12*100,A[e].gain.gain.value=V.value/50),X=e=>A[e]&&(A[e].gain.gain.linearRampToValueAtTime(V.value/50,t=A[e].context.currentTime+.02),A[e].gain.gain.linearRampToValueAtTime(A[e]=0,t+.1)),onunload=onblur=e=>A.map((e,a)=>X(a)),R(A=[]),K=e=>(k="ZSXDCVGBHNJM,L.;/Q2W3ER5T6Y7UI9O0P[=]".indexOf(e.key?.toUpperCase()),k-5*(k>16)),onkeydown=e=>document.activeElement==S||P(K(e)),onkeyup=e=>X(K(e))</script></template>

<template name="Byte Beat Player"><style>body{background:#111;color:#fff;user-select:none;text-align:center}</style>∆í(t) <input id=I value='t&t>>7'><p>üìê <input style=width:99 id=L type=number value=30 min=1 max=120> <button onmousedown=P()>‚ñ∫</button> <button onmousedown=A&&A.stop()>‚óº</button><p><script>A=0,P=e=>{A&&A.stop(),l=44100*(L.value=OS13k.Clamp(L.value,120)),s=[];try{for(eval("f=t=>"+I.value),i=0;i<l;s[i]=OS13k.Clamp(f(i++))-.5);A=OS13k.PlaySamples(s,1)}catch(e){}},onunload=l=>A&&A.stop()</script></template>

<meta charset=utf-8><style>body{opacity:0;margin:0;overflow:hidden;font-family:arial;font-size:22;user-select:none;white-space:nowrap;background:#000}#M{display:flex;flex-direction:column;background:#000}.PM{background:linear-gradient(#fff,#888)}#M,.PM{visibility:hidden;position:absolute;z-index:20000;box-shadow:5px 5px 9px;border:2px solid}.P{font-size:18;height:18;padding:4}.W{border:3px solid#aaa}.TI{width:50;height:40;text-shadow:1px 1px 3px#000;overflow:hidden}.PA,.TIA{background:linear-gradient(#ff8,#fff)}.TI:hover{background:linear-gradient(#fff,#44f)}.R{padding:2}.R:hover{background:#fff3}.TI,.F,.P{display:flex;align-items:center;justify-content:center}</style><div class=F id=B style=position:absolute;width:100%;height:100%;color:#0002;font-family:impact;font-size:30vw;font-weight:900;position:absolute></div><div id=D><div class=F style="position:absolute;z-index:10000;width:100%;background:linear-gradient(#888,#333);box-shadow:0px 1px 9px;border:2px solid;left:-2"><div id=FS style=flex:1></div><div class=F id=F style="margin:2;padding-left:9;padding-right:9;color:#fff;background:linear-gradient(#000,#333);border:1px solid;border-radius:6px;text-shadow:1px 1px 3px#000"></div></div><div id=PU style=float:right></div><div id=PM style=position:absolute></div><div id=M> <button id=BF>Full Screen <button id=BC>Code <button id=BH>Help <button id=BS>Reset Size <button id=BR>Reload <button id=BL>Close <template id=T><style>:host{visibility:hidden;position:absolute;background:#000;box-shadow:5px 5px 9px;border:3px solid#222;border-radius:6px;overflow:hidden}input,button,span{margin:4}span{white-space:nowrap}.T{height:34;font-size:24;display:flex;align-items:center;white-space:nowrap;background:linear-gradient(#ccc,#444);border-bottom:3px solid}.TA{background:linear-gradient(#eee,#88f)}.TAU{background:linear-gradient(#eee,#8f8)}.TAS{background:linear-gradient(#eee,#f88)}.TS{background:linear-gradient(#ccc,#844)}.U{width:100%;resize:none;outline:0;border-top:2px solid}</style></template><script>
"use strict";const aa=[["‚ùå",,,256,"Close All"],["<b><span style=color:#0f0>?",300,210,1,"Help","Check here to see help, code, or edit user programs.\n\nHave fun! ‚úåÔ∏èüòÑ"],["‚öôÔ∏è",,,,"System",,[["üèÜ",,,25,"Trophy Case"],["‚úèÔ∏è",300,263,3,"Sticky Note","Ctrl+B = Bold\nCtrl+I = Italic\nCtrl+U = Underline\nReload = Clear"],["üï∞Ô∏è",198,198,165,"Clock"],["üéöÔ∏è",470,130,1,"Settings"]]],["üéÆ",,,,"Games",,[["üôâ",,,154,"Don't Fall"],["üèÇüèª",,,154,"Bogus Slopes"]]],["üé∂",,,,"Music",,[["üéµ",400,330,,"Music Player"],["üëÅÔ∏è",,,188,"Visualizer"],["üéπ",350,99,2,"Ziano","Keyboard = Play Note"],["ü¶à",300,89,2,"Byte Beat Player"]]]];function ba(e,t,i=44100){const s=q.createBuffer(e.length,e[0].length,i);return i=q.createBufferSource(),e.map((e,t)=>s.getChannelData(t).set(e)),i.buffer=s,i.connect(i.gain=q.createGain()).connect(t?ca:u),t&&(1<t?i.gain:i).connect(ha),i.start(),i}class ia{Clamp(e,t=1,i=0){return e<i?i:e>t?t:e}Percent(e,t,i){return i-t?this.Clamp((e-t)/(i-t)):0}Lerp(e,t,i){return t+this.Clamp(e)*(i-t)}Hash(e){return[...e].reduce((e,t)=>t.charCodeAt()+31*e|0,0)}Random(e=1,t=0){return this.randomSeed^=this.randomSeed<<13,this.randomSeed^=this.randomSeed>>17,this.Lerp(Math.abs(this.randomSeed^=this.randomSeed<<5)%1e9/1e9,t,e)}Trophy(e,t,i,s){var n=e=>this.StripHTML(e||"",32).replace(/[,`]/g,"");e=n(e),t=n(t),i=n(i),s=n(s);const a=e+","+t+","+i;if(!(0<=(n=w.findIndex(e=>e[4]==a))&&w[n][3]==s)){var o=[e,t,i,s,a];0>n?w.unshift(o):w[n]=o,localStorage["OS13kTrophy,"+a]=s,i||(i=t,t=""),this.Popup(`<div style='padding:9;font-size:40;text-shadow:2px 2px 4px;white-space:nowrap'>${e||"üèÜ"}</div><div><b>${i}</b><br><i>${t}</i></div>`+s,i+". "+t,"ja"),this.l(y.a.w&&z(y.a.w))}}GetTrophy(e,t){const i=w.find(i=>i[1]==e&i[2]==t);return i?i[3]:0}Trophies(){return w}PlaySeed(e,t=1,i=1,s=.05,n,a){return this.PlaySamples(this.SeedSamples(...arguments),a)}SeedSamples(e,t=1,i=1,s=.05,n){return zzfxG(...this.SeedParameters(...arguments))}SeedParameters(e,t=1,i=1,s=.05,n){if(!e)return[i,s,n,0,t];if(parseFloat(e=(e+"").trim())!=e){if("zzfx(...["==e.slice(0,9))return e.slice(9).split(",").map((e,t)=>t?1==t?s:2==t&&n?n:e.length?parseFloat(e):void 0:i);e=this.Hash(e)}this.randomSeed=e;const a=(e=(()=>this.Random()))()**3/4*t,o=e()**3/4*t,l=e()**3/4*t,h=a+o+l+(t*=e()**3/4),r=2e3*e()**2;return[i,s,n||r,a,l,t,5*e()|0,3*e()**2,(.5>e()?e():0)**3*(.5>e()&&e()?99:-99),(.5>e()?e():0)**3*(.5>e()&&e()?99:-99),(.5>e()?e():0)**2*(.5>e()&&e()?1e3:-1e3),e()**2*h,(.5>e()?e():0)*h,(.5>e()?e():0)**4,(.5>e()?e():0)**3*(.5>e()&&e()?9:-9),(.5>e()?e():0)**4,(.5>e()?e():0)**3/2,1-(.5>e()?e():0),o]}PlaySamples(e,t,i=44100){return ba([e],t,i)}PlayMusic(e){try{return ba(zzfxM(...e),1)}catch(e){}}GetAnalyser(){return E}GetAnalyserData(e){return ja[e]?ja[e]:0}Note(e=0,t=440,i=12){return t*2**(e/i)}Speak(e,t=1,i=1,s=1,n="en",a){(e=new SpeechSynthesisUtterance(e)).volume=s*u.gain.value*3,e.pitch=i,e.rate=t,e.lang=n,a&&speechSynthesis&&speechSynthesis.cancel(),S.s&H&&speechSynthesis&&speechSynthesis.speak(e)}StripHTML(e,t){return(e+"").substring(0,t||e.length).replace(/<.*>/g,"")}Popup(e,t,i){const s=PU.appendChild(document.createElement("div"));s.style="position:relative;z-index:10000;width:200;padding:8;pointer-events:none;white-space:normal;text-align:center;background:linear-gradient(#eee,#888);box-shadow:9px 9px 19px;border:2px solid;border-radius:9px;",s.innerHTML=e,s.F=t,s.fa=i,s.style.visibility="hidden"}Input(e){let t;e.document.OS13kInput&&((t={...e.document.OS13kInput}).x=t.y=0,t.keydown[87]|t.keydown[38]&&++t.y,t.keydown[83]|t.keydown[40]&&--t.y,t.keydown[68]|t.keydown[39]&&++t.x,t.keydown[65]|t.keydown[37]&&--t.x);const i=e.document.OS13kInput={x:0,y:0,keypress:[],mousepress:[],keydown:e.document.OS13kInput?e.document.OS13kInput.keydown:[],mousedown:e.document.OS13kInput?e.document.OS13kInput.mousedown:[],mousex:e.document.OS13kInput?e.document.OS13kInput.mousex:0,mousey:e.document.OS13kInput?e.document.OS13kInput.mousey:0,ja:0};return e.onkeydown=(e=>e.repeat||(i.keydown[e.keyCode]=i.keypress[e.keyCode]=1)),e.onkeyup=(e=>i.keydown[e.keyCode]=0),e.onmousedown=(e=>(i.mousedown[e.button]=i.mousepress[e.button]=1,1!=e.button)),e.onmouseup=(e=>i.mousedown[e.button]=0),e.onmousemove=(e=>(i.mousex=e.x,i.mousey=e.y)),e.onblur=(()=>(i.keydown=[],i.mousedown=[])),e.onwheel=(e=>i.ja=e.deltaY),t||i}l(){H&&(localStorage.OS13k=JSON.stringify([w,S,I,K,ka])),u.gain.value=S.v,ca.gain.value=S.m,S.s&&S.v||speechSynthesis&&speechSynthesis.cancel(),B.style.background=`linear-gradient(${S.c},${S.d})`,B.innerText=S.t}SaveSettings(e,t,i,s,n,a,o,l){this.l(S={v:u.gain.value=e,m:ca.gain.value=t,s:i,p:s,o:n,c:a,d:o,t:l})}Settings(){return S}}var OS13k=new ia;const q=new AudioContext,u=q.createGain(),ca=q.createGain(),ha=q.createAnalyser(),N=()=>{const e=[],t=i=>i.map(i=>i[6]?t(i[6]):e.push(i));t(aa),L&&L.O.lastChild&&(L.O.removeChild(L.O.lastChild),aa.pop()),la(aa,["üòÄ",,,,"User Programs"],"",e),ma(L.O)},la=(e,t,i,s)=>{const n=[["üìå",,,512,"New User Program",,,,i],["‚ö†Ô∏è",,,1024,i?`Delete User Folder ${i}`:"Delete User Programs",,,,i]],a=[];i||I.map(e=>null!=e.h&&e.i&&!a.includes(e.i)&&la(n,["üìÅ",,,,e.i],e.i,s,a.push(e.i))),I.map(e=>null!=e.h&&e.i==i&&n.push(s.find(t=>t[6]==e.B)||[e.C,e.D,e.M,58,e.j,,,e.B,e.i])),t[6]=n,e.push(t)},na=e=>{requestAnimationFrame(na),O|H||OS13k.l(oa.prepend(E=document.createElement("canvas")),E.style="width:16;height:16;margin:2;pointer-events:none;display:none",P&&P.H(P=0),H=1);var t=document.activeElement,i=t.shadowRoot&&t.shadowRoot.activeElement==t.I?t.I:0;if(i&&pa!=i&&t.g(qa=1),pa=i,document.body.style.opacity=OS13k.Clamp(.02*!O+1*document.body.style.opacity),y.innerHTML=w.length+"üèÜ",ra.title=Date(),ra.innerHTML=ra.title.replace(/.* (\d+):(\d+).*/,(e,t,i)=>(t%12||12)+":"+i),!(!H|!qa)){t=new Uint8Array(ha.fftSize=512),i=E.getContext("2d"),ha.getByteFrequencyData(t),E.width=E.height=32;for(let s=0;32>s;){const n=(t[s+3]/255)**3*(1+Math.log10(44100*(s+3)/1024));i.fillStyle=`hsl(${-99-59*n} 99%50%)`,i.fillRect(s,31,1,-7*n),ja[s++]=OS13k.Clamp(n/5),sa=n?e:sa}E.style.display=1e4>e-sa?"":"none";var s=0;[...PU.children].map((e,t)=>{if(e.F&&OS13k.Speak(e.F,1,1,1,e.fa),e.F=0,S.p){if(!document.fullscreenElement){let i=e.style.visibility?innerHeight:parseInt(e.style.top)+s-9;e.style.visibility="",44>i&&(i=44,!t&&0>(e.style.opacity=(e.style.opacity||3)-.01)&&(s+=e.getBoundingClientRect().height,PU.removeChild(e))),e.style.top=i}}else PU.removeChild(e)})}},ua=()=>{[...PM.children].map(e=>e.style.visibility=M.style.visibility=""),ta&&(ta.className="P")},va=(e,t=(e?e.split(","):[]))=>"OS13kTrophy"==t.shift()&&(t.length=3,OS13k.Trophy(...t,localStorage[e])),U=(e,t)=>H&qa&S.o&&OS13k.PlaySeed(e,t);let V,wa,xa,H,W,ta,ya,L,X,E,pa,P,K,y,Ba,ra,oa,Ca,ka=0,ja=[],sa=-1e4,za=0,O=0,qa=0,Aa=9,Y=53,I=[],w=[],S={v:.3,m:.3,s:1,p:1,o:1,c:"#222233",d:"#332222",t:"OS13k"};function ma(e,t=0){for(const t of e.aa){const i=t[-1]=t[-1]||new Da(...t);i.N=i.Y?new Ea(i.Y,e):e}e.innerHTML="",PM.appendChild(e),e.aa.map(t=>e.appendChild(t[-1])),e.style.top=t,e.style.left=e.$&&e.$.getBoundingClientRect().right,e.aa.map(i=>{i[-1].N!=e&&ma(i[-1].N,t),t+=26})}function Fa(e,t,i){const s=(i=t?[t.C,t.D,t.M,58,t.j+"+",,,++ka,t.i]:["‚úã",,,58,,,,++ka,i])[-1]=new Da(...i);return e.aa.push(i),s.b.h=t?(s.b.F=t.C.F,Aa=t.C.x,Y=t.C.y+37,t.C.h):"for(x.fillRect(0,0,i=s=2e3,s);i--;x.globalAlpha=.1)\nx.clearRect((S(i)*1e9-t*i/9)%s,i*9%s,i%9,i%9)",s.H(s.A=X=1),Ga(s.w,1),s.w.G.focus(),N(s.N=e),s}class Ea extends HTMLElement{constructor(e,t){super(),this.className="PM",this.$=t,this.aa=e}g(){ua(),this.$&&this.$.g(),this.style.visibility="visible"}}function Ha(e){const t=I.findIndex(t=>t.B==e.B);e.b=0>t?{}:I[t],e.A=null!=e.b.h}customElements.define("m-",Ea);class Da extends HTMLElement{constructor(e="üí†",t=720,i=405,s,n="",a="",o,l,h){super(),this.Z=128&s,this.h=!(this.U=a)&&(32&s||this.Z&&null==s),this.className="P",this.D=t,this.M=i,this.u=s||26,this.B=l||n,this.i=h,this.Y=o,this.P(e,n),Ha(this),"Music Player"==n&&Ia(oa,this),"Trophy Case"==n&&Ia(y,this),"Settings"==n&&Ia(Ba,this),"Sticky Note"==n&&Ia(Ca,this),"Clock"==n&&Ia(ra,this),"Help"==n&null==this.b.da&&(P=this),1&this.u?this.b.da&&this.H():this.B==K&&(P=this)}P(e,t){this.C=e,this.innerHTML='<span style="pointer-events:none;width:45;text-shadow:1px 1px 3px#000;text-align:center;overflow:hidden">'+e,this.innerHTML+=`<div style=flex:1;padding-right:9;pointer-events:none>${this.j=OS13k.StripHTML(t)||"User Program "+this.B}</div>`+(this.Y?"‚ñ∂":"")}ca(){this.N.g(),this.className="P PA",ta!=this&&U(90,0),ta=this}H(){if(this.w)this.w.g(1,1);else if(512&this.u)Fa(this.N,void 0,this.i);else if(1024&this.u&&confirm(this.j+"?"))[...D.children].map(e=>e.L&&(this.i?e.a.b.i==this.i:null!=e.a.b.h)&&e.L()),I=I.filter(e=>null==e.h||this.i&&e.i!=this.i),N(OS13k.l(U(92,4)));else if(256&this.u)[...D.children].map(e=>e.L&&e.L()),Aa=9,Y=53;else if(!this.Y||this.A){let e=this.b.x,t=this.b.y;e||(e=Aa,t=Y,400<(Aa+=37)&&(Aa=Y=9),300<(Y+=37)&&(Y=Y=53)),this.w=new Ja(this,e,t),this.l()}}g(){this.H()}l(e=1){this.b={da:e,B:this.B,x:e|1&this.u?parseInt(this.w.style.left):0,y:parseInt(this.w.style.top),F:e|1&this.u?this.w.F:1,j:this.j,C:this.C,D:this.D,M:this.M,h:this.b.h,R:this.A?this.w.R.checked:1,V:this.w.V.checked,i:this.i},e=I.findIndex(e=>e.B==this.B),OS13k.l(0>e?I.push(this.b):I[e]=this.b)}}function z(e,t){e.a.A&&(e.a.b.h=e.G.value),e.a.l(),t||U(85),e.J&&e.J.OS13kReload?e.J.OS13kReload():e.a.A?Ka(e,e.a.b.h):La(e,e.I.style.visibility="hidden")}function Ga(e,t){e.S.style.display=(e.ia=!e.ia)?"inline":"none",t||U(e.a.U?48:16)}function Ma(e,t,i){t=OS13k.Clamp(e.a.D*t,1920,170),e.style.left=parseInt(e.style.left)+parseInt(e.style.width)-t,e.style.width=t,e.K.style.height=e.a.M*(e.F=t/e.a.D),e.a.l(),i&&U(i)}function La(e){e.I&&e.K.removeChild(e.I),e.I=e.K.appendChild(document.createElement("iframe"));const t=e.J=e.I.contentWindow,i=e.a;let s=0;e.I.style="width:100%;height:100%;background:#fff;border:none;visibility:hidden",i.A?(i.Z="<"!=i.b.h.trim()[0],Na(e),e.G.onkeydown=(t=>!t.altKey||13==t.keyCode&&Ka(e,e.G.value)),e.G.oninput=(()=>e.V.checked&&Ka(e,e.G.value)),Sa(e,i.b.h),t.onerror=((t,i,s,n,a)=>Na(e,a,a.stack&&[n,s]))):(Sa(e,document.getElementsByName(i.j)[0].innerHTML),e.G.value=i.U||document.getElementsByName(i.j)[0].innerHTML);const n=!e.a.A|X;var a=t.document;const o=i.A?i.b.h:i.U||(i.Z?a.body.innerText:a.body.innerHTML);t.OS13k=OS13k,t.OS13kWindow=e,t.zzfx=zzfx,n||(a.body.style.background="#111"),i.Z&&n&&(Sa(e,"<style>canvas{width:100%;background:#fff}</style><canvas id=c width=1920 height=1080>"),a.body.style="background:#111;overflow:hidden;margin:0;display:flex;align-items:center",a=i.A?o.replace(/(for\s*\((?!\s+of\s+)(?!\s+in\s+)[^;]*;[^;]*;|while\s*\()\s*(\S)/g,(e,t,i)=>t&&i?t+'++OS13kL>1e5&&(e=>{throw"Timed out!"})()'+(")"==i?"":",")+i:e):o,onerror=((t,i,s,n,a)=>{Na(e,a,a.stack&&[n,s])}),t.eval("OS13k=parent.OS13k;x=c.getContext`2d`;zzfx=parent.zzfx;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;"+`u=t=>{\n${a}\n};`+"OS13kU=t=>t>OS13kF-2&&u(((t=frame++/60)*60|0==frame-1)&&t>0?t+1e-6:t,OS13kL=0,OS13kF=Math.max(OS13kF+100/6,t));(OS13kA=t=>(requestAnimationFrame(OS13kA),"+(4&i.u||0==i.b.R?"":"t<1e3|parent.document.activeElement==OS13kWindow&&")+"OS13kU(t)))(frame=OS13kF=0)")),n||(t.onmousedown=(t=>(z(e,X=1),onmousedown(t)))),t.oncontextmenu=(()=>!1),e.W||(e.W=new Ta(i,e)).g(),e.style.visibility=e.I.style.visibility="visible",O=O&&--O,i.A&&(e.I.onload=(()=>s++&&z(e,1))),V&&onmouseup()}function Na(e,t,i){return e.T.value=t+(i?` (${i[1]-1+":"+i[0]})`:""),e.T.style.display=null!=t?"":"none",!0}function Sa(e,t){e.J.document.open(),e.J.onerror=((t,i,s,n,a)=>Na(e,a,a.stack&&[n,s])),!e.a.A|X&&e.J.document.write(t),e.J.document.close()}function Ka(e,t){e.a.b.h=t,e.ha.innerHTML=t.length,e.a.l(),La(e,X=1)}function Ua(e){!e.a.A|X||z(e,X=1),U(-9),e.J.focus(),e.K.webkitRequestFullScreen&&e.K.webkitRequestFullScreen(),e.K.mozRequestFullScreen&&e.K.mozRequestFullScreen()}customElements.define("p-",Da);class Ja extends HTMLElement{constructor(e,t,i){super(),D.appendChild(this),this.a=e,this.style.left=t,this.style.top=i,this.ea=1,this.ga=0,this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=T.innerHTML,this.X=this.shadowRoot.appendChild(document.createElement("div")),this.X.id="T",t=((e,t,i,s="path")=>{this.X.innerHTML+=`<style>#${e.split(" ")[0]}:hover{background:#${i}</style>`+`<div id=${e.split(" ")[0]} title=${e}>`+`<svg viewBox='0 0 10 10'style=height:100%;width:28;pointer-events:none><${s} stroke=#000 fill=none ${t} />`}),16&e.u&&t("Grow",'d="M2 5L8 5M5 8L5 2"',"0f0",t("Shrink",'d="M2 5L8 5"',"0ff")),8&e.u&&t("Full Screen","x=1 y=2 width=8 height=6","fff","rect"),e.U&&t("Help",'d="M5 8L8 2L2 2L5 8L8 2"',"0ff"),e.h&&t("Code",'d="M5 2L8 8L2 8L5 2L8 8"',"f0f"),2&e.u&&t("Reload","cx=5 cy=5 r=3","ff0","circle"),t("Close",'d="M2 2L8 8M8 2L2 8"',"f00"),this.X.prepend(this.j=document.createElement("div")),this.j.style="width:100%;overflow:hidden;cursor:grab";const s=()=>{this.j.innerHTML=`<span style='display:inline;text-shadow:1px 1px 3px#000;margin-left:9;margin-right:9;pointer-events:none'>${e.C}`,this.j.innerHTML+=e.j};s(),this.K=this.shadowRoot.appendChild(document.createElement("div")),this.K.style.background="#000",this.S=this.shadowRoot.appendChild(document.createElement("div")),this.S.style.display="none",this.G=this.S.appendChild(document.createElement("textarea")),this.G.className="U",this.G.style="padding:9;height:199;background:#000;color:#fff",e.A?this.G.value=e.b.h:this.G.readOnly=1,this.G.spellcheck=0,this.ba=this.S.appendChild(document.createElement("div")),this.ba.ka="U",this.ba.style=`background:#111;color:#fff;font-size:16;overflow:auto;${e.A?"":"display:none"}`,this.ba.innerHTML="&nbsp;Icon <input style=width:50 id=I> Name <input id=N> Folder <input id=F><br>&nbsp;Size <input style=width:50 type=number id=W>x<input style=width:50 type=number id=H>"+`Sleep <input type=checkbox id=P ${0!=e.b.R?"checked":""}>`+`Live Edit <input type=checkbox id=L ${0!=e.b.V?"checked":""}>`+"<button id=C>Copy</button><button id=D>Delete</button>"+`<span id=Z>${e.b.h&&e.b.h.length}</span> Bytes`;const n=this.shadowRoot.getElementById("I"),a=this.shadowRoot.getElementById("N"),o=this.shadowRoot.getElementById("F"),l=this.shadowRoot.getElementById("W"),h=this.shadowRoot.getElementById("H");this.T=this.S.appendChild(document.createElement("textarea")),this.T.className="U",this.T.style="padding:9;background:#000;color:#f00",this.T.readOnly=!0,this.shadowRoot.getElementById("C").onmousedown=(()=>Fa(e.N,e)),this.shadowRoot.getElementById("D").onmousedown=(()=>{this.L(),N(OS13k.l(I=I.filter(t=>t.B!=e.B)))}),this.ha=this.shadowRoot.getElementById("Z"),this.V=this.shadowRoot.getElementById("L"),this.R=this.shadowRoot.getElementById("P"),n.value=e.C,a.value=e.j,l.value=e.D,h.value=e.M,null!=e.i&&(o.value=e.i),n.oninput=a.oninput=this.V.oninput=(()=>e.l(s(this.W.P(e.P(OS13k.StripHTML(n.value),a.value))))),o.oninput=(()=>N(e.l(e.i=OS13k.StripHTML(o.value.trim())))),l.onchange=h.onchange=(()=>{e.D=l.value=OS13k.Clamp(l.value,720,99),e.M=h.value=OS13k.Clamp(h.value,2*e.D,99),Ma(this,1),this.g(1,1)}),this.R.oninput=(()=>z(this,1,e.l())),t=16&e.u?Math.min(e.D*(e.b.F||1),innerWidth-6):e.D,this.style.width=t,this.K.style.height=t*e.M/e.D,this.F=t/e.D,OS13k.Speak(e.j),La(this,O+=!H)}H(e,t,i){"C"!=e.id&&this.g(),e==this.j?(V=this,U(45),document.body.style.cursor="grabbing",D.style.pointerEvents="none",wa=t-parseInt(this.style.left),xa=i-parseInt(this.style.top)):("Full"==e.id&&Ua(this),"Reload"==e.id&&z(this),"Close"==e.id&&this.L(),"Shrink"==e.id&&Ma(this,this.F-.2,75),"Grow"==e.id&&Ma(this,this.F+.2,61),"Help"==e.id|"Code"==e.id&&Ga(this))}g(e=1,t){ua(),this.className=e?"W":"",this.X.className="T T"+(e?"A":"")+(1&this.a.u?"S":this.a.A?"U":""),this.K.style.filter=e||4&this.a.u?"":"saturate(.7)brightness(.7",e&&(e=this.getBoundingClientRect(),t&&(this.style.left=OS13k.Clamp(e.x,innerWidth-e.width,0,this.style.top=OS13k.Clamp(e.y,Math.max(44,innerHeight-e.height),44))),O||setTimeout(()=>document.activeElement!=this&&this.J&&this.J.focus(pa=this.I)),W!=this&&(W&&W.g(0),W=this,U(this.ga++?66:-8),this.style.zIndex=++za,BF.style.display=8&this.a.u?"":"none",BC.style.display=this.a.h?"":"none",BH.style.display=this.a.U?"":"none",BR.style.display=2&this.a.u?"":"none",BS.style.display=16&this.a.u?"":"none",this.W&&this.W.g(1,0),H&!(1&this.a.u)&&OS13k.l(K=this.a.B)))}L(){this.a.B==K&&(K=""),U(92),this.a.l(0),this.a.w=0,this.W.remove(),this.remove()}}customElements.define("w-",Ja);class Ta extends HTMLElement{constructor(e,t){super(),this.className="TI",this.ea=this.O=t,this.P(this.a=e),FS.before(this)}P(){this.innerHTML="<div style=pointer-events:none>"+(this.a.C||"üí†"),this.title=this.a.j}H(){this.g()}g(e=1,t=1){if(e&&this.O.g(1,t),this==L)return U(8,.5);this.className="TI "+(e?"TIA":""),e&&ya!=this&&(ya&&ya.g(0),ya=this)}}function Ia(e,t){e.a=t,e.title=t.j,e.innerHTML=t.C}customElements.define("i-",Ta);class Z extends HTMLElement{constructor(){super(),this.className="R",F.appendChild(this)}H(){var e=this.a;W&&W==e.w?e.w.L():e.H()}}customElements.define("t-",Z),onmousedown=(e=>{if(e.target==L&&e.target.O.style.visibility)return ua(),W&&W.g(),!1;if(ua(PM.style.left=0,PM.style.top=44,qa=1),V)return onmouseup(e);var t=e.originalTarget||e.path[0];let i=0;try{i=/input|textarea/.test(t.localName)}catch{i=1,t=e.target}return e.button?"button"!=t.localName&&void(2&e.button&&((e.target.g?e.target:L).g(),(t=e.target.ea?(U(8,.5),M):PM).style.left=e.x,t.style.top=e.y,t.style.visibility="visible")):(e.target.H?e.target.H(t,e.x,e.y):W&&W.g(),e.target==L||i)}),onmousemove=(e=>{V&&(V.style.left=e.x-wa),V&&(V.style.top=e.y-xa),e.target.ca&&e.target.ca()}),onmouseup=(()=>V&&(V.a.l(),U(42),V.g(1,0),document.body.style.cursor=D.style.pointerEvents=V="")),oncontextmenu=(()=>!1);var zzfx=(...e)=>OS13k.PlaySamples(zzfxG(...e)),zzfxG=(e=1,t=.05,i=220,s=0,n=0,a=.1,o=0,l=1,h=0,r=0,d=0,u=0,c=0,p=0,y=0,m=0,S=0,g=1,f=0,w=[],k=44100)=>{s=99+s*k,n*=k,a*=k,f*=k,S*=k;let b=2*Math.PI,v=OS13k.randomSeed=OS13k.Clamp(s+f+n+a+S,9*k),x=h*=500*b/k**2;t=i*=(1+2*t*Math.random()-t)*b/k;let O=(0<y?1:-1)*b/4,C=0,M=0,L=0,I=1,H=0,T=0,B=0;for(c*=k,u*=k,d*=b/k,r*=500*b/k**3,y*=b/k;L<v;w[L]=(w[L++]||0)+B)++T>100*m&&(T=0,B=C*i*Math.sin(M*y-O),B=(0<(B=o?1<o?2<o?3<o?Math.sin((B%b)**3):OS13k.Clamp(Math.tan(B),1,-1):1-(2*B/b%2+2)%2:1-4*Math.abs(Math.round(B/b)-B/b):Math.sin(B))?1:-1)*Math.abs(B)**l*e*(L<s?L/s:L<s+f?1-(L-s)/f*(1-g):L<s+f+n?g:L<v-S?(v-L-S)/a*g:0),B=S?B/2+(S>L?0:(L<v-S?1:(L-v)/S)*w[L-S|0]/2):B),C+=1+OS13k.Random(p,-p),M+=1+OS13k.Random(p,-p),i+=h+=r,I&&++I>u&&(i+=d,t+=d,I=0),c&&++H>c&&(i=t,h=x,H=1,I=I||1);return w},zzfxM=(e,t,i,s=6)=>{const n=44100*s/50|0,a={},o=[[],[]];let l,h,r,d,u,c,p=0;return i.map(i=>{t[i].map((t,i)=>{h=p;for(let p=2;p<t.length;h+=n){var s=0|t[p++];if(s){const i=0|t[u=d=0],n=[i,s];r=a[n]||((c=[...e[i]])[2]*=2**((s-12)/12),a[n]=zzfxG(...c)),r=a[n]}for(u=0>s||s%1||u,l=h;l<h+n;++l)s=r[d++]*(1-u)||0,o[0][l]=(i&&o[0][l])-s*t[1]+s,o[1][l]=(i&&o[1][l])+s*t[1]}}),p=l}),o};localStorage.OS13k&&([w,S,I,K,ka]=JSON.parse(localStorage.OS13k)),OS13k.l(),u.connect(q.destination),ca.connect(q.destination),y=new Z,oa=new Z,Ba=new Z,Ca=new Z,ra=new Z,BF.onmousedown=(()=>Ua(W)),BH.onmousedown=BC.onmousedown=(()=>Ga(W)),BS.onmousedown=(()=>W.g(1,1,Ma(W,1,61))),BR.onmousedown=(()=>z(W)),BL.onmousedown=(()=>W.L()),N(L=new Ta({C:"üíæ",j:"Load"},new Ea(aa))),OS13k.Trophy("üëã","","Welcome to OS13k!");for(const e in localStorage)va(e);onstorage=(e=>va(e.key)),onunload=(()=>speechSynthesis&&speechSynthesis.cancel()),na()
</script>