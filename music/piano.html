<style>body{background:#222;color:#fff;user-select:none;text-align:center}
</style>
<div id=B></div>
Volume <input type=range style=width:70 id=V value=100>
Length <input type=range style=width:70 id=L value=25>
Noise <input type=range style=width:70 id=N value=0>
Shape <input type=range style=width:70 id=H value=50>
<div><script>

// instruments
u = ['Organ', 'Piccolo', 'Sin', 'Seed'];

// create settings
b=e=>
{
    // clear old settings
    B.innerHTML = '';
    
    // create buttons
    for(j in u)
        B.innerHTML += `<button style='border:5px solid #${         // button
            t-j? "222" : "f00"}' onclick=b(t=${                     // color
            j})>${u[j]}</button> `;                                 // click
   
    // seed
    B.innerHTML += `Seed <input id=S oninput=t=3 value=${           // seed input
        localStorage.OS13kP ? localStorage.OS13kP : 0               // save seed
        } onchange=b(t=3,localStorage.OS13kP=event.target.value)>`; // seed changed

    // disable noise & shape if seed
    H.disabled = N.disabled = t==3;
}

// play a note
p=e=>
{
    f = eval('b'+e);  // get the button
    
    // animate color when played
    q = f.style.background;
    f.style.background = '#f00';
    f.style.transition = '';
    
    // reset transition
    f.offsetHeight;
    f.style.transition = '1s';
    f.style.background = q;
    
    f =               // frequency multiples
    [                 // instruments
        [1,2,4],      // organ
        [1,3,5],      // piccolo
        [1]           // sin
    ][t];             // get instrument

    n = O.Note(e-45-12);  // A 440 root note
    l = .1+L.value/50; // length
    v = V.value/100;   // volume
    
    // play sound
    t-3 ?                         // instrument type
        f.map(f=>zzfx
        (...[
            v/(1+Math.log2(f)),   // scale volume
            0,                    // no randomness
            f*n,,                 // frequency
            l,                    // sustain
            .05,,                 // release
            H.value/50,           // shape curve
            ,,,,,N.value/100      // noise
            
        ])) :
        [O.PlaySeed(S.value, l, v, 0, n)]; // seed
}

// create piano keys
for(b(i=t=0);i<72;O=parent.OS13k)
document.body.innerHTML +=`<div id=b${z=(2-(i/24|0))*24+i%24} onmouseover=event.buttons&&p(${z}) onmousedown=p(${                            // mouse
z}) style="display:inline-block;border:1px solid #000;background:#${  // style
    [1,3,6,8,10].includes(i%12) ?                              // b or w
    '000;position:absolute;margin-left:-9;width:17;height:70' :// black
    'fff;width:34;height:129'}"></div>${                       // white
    ++i%24? '' : '<br>'}`;                                     // next row

// keyboard control
K='zsxdcvgbhnjm,l.;/q2w3er5t6y7ui9o0p';
onkeydown=e=>
{
k=e.key.toLowerCase();     // get the lower case key
k=K.search(k=='.'?/\./:k); // find the key, fix .
k+=k>16?7:0;               // adjust for octave
k>=0&&!e.repeat&&p(k+24);  // play the note
}
</script>