<meta charset=utf-8>
<style>
*
{
font-family:arial;
user-select:none;
}
body
{
margin:0;
background:linear-gradient(#223,#322);
overflow:hidden;
}
#taskbar
{
position:absolute;
border:2px solid;
z-index:10000;
width:100%;
background:linear-gradient(#888,#333);
display:flex;
left:-2;
}
.taskbarIcon
{
width:44;
height:36;
font-size:22;
text-shadow:1px 1px 2px #000;
display:flex;
align-items:center;
justify-content:center;
}
#menu
{
visibility:hidden;
display:flex;
flex-direction:column;
background:#000;
}
.folder, #menu
{
position:absolute;
border:2px solid;
z-index:20000;
box-shadow:5px 5px 9px;
}
.icon
{
height:18;
padding:4;
white-space:nowrap;
display:flex;
}
.iconActive,
.taskbarIconActive         { background:linear-gradient(#ff8,#fff); }
.taskbarIcon:hover         { background:linear-gradient(#fff,#44f); }
.taskbarIconActive:hover   { background:linear-gradient(#ff8,#44f); }
.folder                    { background:linear-gradient(#fff,#777); }
#title
{
height:100%;
color:#0002;
font-family:impact;
font-weight:900;
display:flex;
align-items:center;
justify-content:center;
font-size:20vw;
}
</style>
<template id=template>
<style>
:host
{
box-shadow:5px 5px 9px;
border:2px solid;
background:#000;
display:flex;
flex-direction:column;
overflow:hidden;
position:absolute;
}
.titlebar
{
height:44;
font-size:26;
background:linear-gradient(#eee,#888);
display:flex;
align-items:center;
justify-content:center;
overflow:hidden;
white-space:nowrap;
}
.titlebarActive
{
background:linear-gradient(#eee,#88f);
}
#frame
{
width:100%;
height:100%;
border:none;
background:#000;
overflow:hidden;
background:#fff;
}
#name
{
width:100%;
cursor:grab;
overflow:hidden;
}
#codeDisplay
{
height:99;
resize:none;
background:#000;
color:#fff;
display:none;
border:1px solid #fff;
}
#reload,
#full,
#code         { width:40; }
#close        { width:28; }
#help:hover   { background:#0ff; }
#code:hover   { background:#0f0; }
#full:hover   { background:#fff; }
#reload:hover { background:#ff0; }
#close:hover  { background:#f00; }
div svg       { width:100%; pointer-events:none; }
</style>
<svg width=0 height=0>
<symbol id=icon-code viewBox='0 0 10 10'>
<path stroke=#000 stroke-width=.7 fill=none d='M5 2L8 8L2 8L5 2L8 8'/>
<symbol id=icon-full viewBox='0 0 10 10'>
<rect stroke=#000 stroke-width=.7 fill=none x=1 y=2 width=8 height=6 />
<symbol id=icon-reload viewBox='0 0 10 10'>
<circle stroke=#000 stroke-width=.7 fill=none cx=5 cy=5 r=3 />
<symbol id=icon-close viewBox='0 0 10 10'>
<path stroke=#000 d='M1 1L9 9M9 1L1 9'/>
</template>
<div id=desktop>
<div id=programsFolder style=position:absolute></div>
<div id=taskbar></div>
<div id=menu></div>
<div id=title>OS13k
<script src=programs.js?9></script>
<script>"use strict";let e,t,i,s,o,n,a,r,h,l=0,d=50,c=99;desktop.C=(()=>{r=new m({icon:"📁",name:"Apps"},new u(programs,0,0)),h&&h.f()}),desktop.D=(()=>{const e=document.activeElement;a!=e&&(e.b&&e.b(),a=e)}),desktop.h=(()=>{for(const e of programsFolder.children)"os13k-folder"==e.localName&&(e.style.visibility="hidden");menu.style.visibility=""}),desktop.A=(()=>{for(let e;!e;){e=1;for(const t of desktop.children)t.l&&t.l(e=0)}d=50,c=99}),desktop.B=(()=>{let e;for(const t of desktop.children)"os13k-window"==t.localName&&(!e||e.style.zIndex<t.style.zIndex)&&(e=t);e&&e.a()});class m extends HTMLElement{constructor(e,t=0){super(),this.className="taskbarIcon",this.innerHTML="<span style=pointer-events:none>"+e.icon,this.element=t,this.title=e.name+(e.i?"\nBy "+e.i:""),taskbar.appendChild(this)}f(){this.element.a(1)}b(e=1){n&&n.b(n=0),n=this,this.className="taskbarIcon"+(e?" taskbarIconActive":"")}}customElements.define("os13k-taskbar-icon",m);class u extends HTMLElement{constructor(e,t,i,s){super(),this.className="folder",this.style.left=t,this.style.top=i,this.v=s,programsFolder.appendChild(this);for(const t of e)this.appendChild(t.I=new p(t));t=this.getBoundingClientRect();for(const s of e)s.folder&&(s.I.folder=new u(s.folder,t.right-2,i,this)),i+=26}a(e){const t=""==this.style.visibility;desktop.h(),e&&t?s&&s.a():(this.v&&this.v.a(),this.style.visibility=""),e&&this.parentNode==programsFolder&&(programsFolder.style.left=0,programsFolder.style.top=38)}}customElements.define("os13k-folder",u);class p extends HTMLElement{constructor({name:e,icon:t,src:i,width:s=720,height:o=405,author:n,folder:a,multiple:r,reload:l,code:d}){super(),i=i||"",e=e||i.split(".")[0],t=t||(e[0]?e[0].toUpperCase():"");const c=i?i.split(".")[1]:"";this.o="dweet"==c,this.isShader="shader"==c,(this.j=this.o||this.isShader)&&(l=1),h||i&&(h=this),this.name=e,this.icon=t,this.src=i,this.width=s,this.height=o,this.i=n,this.multiple=r,this.reload=l,this.code=d||this.j,this.className="icon",this.innerHTML='<span style=pointer-events:none;display:flex;width:100%>&nbsp;<span style="width:28;text-shadow:1px 1px 2px #000;text-align:center">'+t+"</span>&nbsp;<span style=flex:1>"+e+"</span><span style=width:20;text-align:right>"+(a?"▶":"")}u(){o=this,this.className="icon iconActive",(this.folder?this.folder:this.offsetParent).a()}f(){this.src?(this.window&&!this.multiple||(this.window=new f(this)),this.window.a(1)):this.folder||(desktop.h(),desktop.A())}}customElements.define("os13k-icon",p);class f extends HTMLElement{constructor(e){super(),desktop.appendChild(this),this.icon=e,this.w=new m(e,this),this.style.left=d,this.style.top=c,400<(c+=46)&&(c=99),1e3<(d+=46)&&(d=50),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=template.innerHTML;const t=this.K=document.createElement("div");t.id="titlebar",this.shadowRoot.appendChild(t);var i=document.createElement("div");i.id="name",i.innerHTML='<div style=pointer-events:none>&nbsp;<span style="text-shadow:2px 2px 3px #000">'+e.icon+"</span>&nbsp;"+e.name+(e.i?" - "+e.i:""),t.appendChild(i),(i=((e,i)=>{const s=document.createElement("div");s.innerHTML=`<svg><use href=#icon-${s.id=e}>`,s.title=i,t.appendChild(s)}))("full","Full Screen"),e.code&&i("code","Show Code"),e.reload&&i("reload","Reload"),i("close","Close"),(i=document.createElement("div")).style.height=2,this.shadowRoot.appendChild(i),(i=this.G=document.createElement("div")).style.background="#000",this.shadowRoot.appendChild(i),this.style.width=Math.min(this.icon.width,innerWidth-4),i.style.width=Math.min(this.icon.width,innerWidth-4),i.style.height=Math.min(this.icon.height,innerHeight);const s=this.H=document.createElement("iframe");s.id="frame",s.style.visibility="hidden",s.src=e.src,i.appendChild(s),s.onload=(e=>{const t=(e=this.m=e.target.contentWindow).document,i=this.icon.j?t.body.innerText:t.body.innerHTML;this.g||(this.g=document.createElement("textarea"),this.g.id="codeDisplay",this.g.setAttribute("readOnly",1),this.g.value=i,this.shadowRoot.appendChild(this.g)),e.OS13k=y,e.zzfx=g,e.OS13kStart&&e.OS13kStart(),this.icon.j&&(t.body.innerHTML="<canvas id=c width=1920 height=1080 style=width:100%;background:#"+(this.icon.o?"fff":"000")+">",t.body.style="background:#111;overflow:hidden;margin:0;display:flex;align-items:center",this.icon.o&&e.eval("u=t=>{"+i+"};x=c.getContext`2d`;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&u((60*(frame++/60)-frame-1|0?frame-1:frame)/60));loop(frame=0)"),this.icon.isShader&&e.eval('g=c.getContext`webgl2`;x=y=z=w=0;onmousemove=e=>e.buttons&&(x=e.x,y=c.height-e.y);onmousedown=e=>(x=z=e.x,y=w=c.height-e.y);onmouseup=e=>z=w=0;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&(c.width=innerWidth,c.height=innerHeight,g.uniform4f(g.getUniformLocation(s,"iMouse"),x,y,z,w),OS13k.RenderShader(c,s,t/1e3)));loop(s=OS13k.CreateShader(c,`'+i+"`))")),s.style.visibility="",this.a()})}s(t,i){"name"==i.id&&(e=this),this.a()}f(e){if("full"==e.id){this.a();const e=this.G;e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()}"code"==e.id&&(this.a(),this.g.style.display=(this.J=!this.J)?"block":""),"reload"==e.id&&(this.H.style.visibility="hidden",this.m.location.reload()),"close"==e.id&&this.l(),"codeDisplay"!=e.id&&this.a()}a(e){desktop.h(),this.m&&this.m.focus(),this.b(),e&&(e=this.getBoundingClientRect(),this.style.left=y.Clamp(e.x,0,innerWidth-e.width),this.style.top=y.Clamp(e.y,38,Math.max(38,innerHeight-e.height)))}b(e=1){if(e&&s!=this){s&&s.b(0),this.style.zIndex=++l;let e="<button onclick=activeWindow.FullScreen()>Fullscreen";this.icon.code&&(e+="<button onclick=activeWindow.ShowCode()>Show Code"),this.icon.reload&&(e+="<button onclick=activeWindow.Reload()>Reload"),e+="<button onclick=activeWindow.Close()>Close",menu.innerHTML=e}e&&desktop.h(),s=e&&this,this.style.filter=e?"":"saturate(.7)brightness(.7",this.K.className="titlebar"+(e?" titlebarActive":""),this.w.b()}l(){this.icon.window=0,this.w.remove(),this.remove(),desktop.B()}}customElements.define("os13k-window",f),onmousedown=(s=>{if(e)return onclick(s);if("button"!=s.target.localName){if("menu"!=s.target.offsetParent.id&&(menu.style.visibility=""),"folder"!=s.target.offsetParent.className&&s.target!=r&&desktop.h(),s.button)return s.preventDefault();var o=s.originalTarget||s.path[0];s.target.s&&s.target.s(s,o),o=s.target.getBoundingClientRect(),t=s.x-o.x,i=s.y-o.y,e&&(document.body.style.cursor="grabbing",desktop.style.pointerEvents="none")}}),onmousemove=(s=>{e&&(e.style.left=s.x-t,e.style.top=s.y-i),o&&(o.className="icon"),s.target.u&&s.target.u(s)}),onclick=(t=>{document.body.style.cursor=desktop.style.pointerEvents="",e&&e.a(e=0),menu.style.visibility="",t.target!=r&&"os13k-icon"!=t.target.localName&&s&&s.a(),t.target.f&&t.target.f(t.originalTarget||t.path[0])}),oncontextmenu=(e=>{if(e.preventDefault(),"button"!=e.target.localName){menu.style.visibility="";var t=menu;e.target.b&&e.target!=r||(t=programsFolder,r.f()),e.target.element?e.target.element.b&&e.target.element.b():e.target.b&&e.target.b(),t.style.left=e.x,t.style.top=e.y,t.style.visibility="visible"}});const g=(e=1,t=.05,i=220,s=0,o=0,n=.1,a=0,r=1,h=0,l=0,d=0,c=0,m=0,u=0,p=0,f=0,g=0,b=2*Math.PI,w=44100,v=(e=>2*e*Math.random()-e),x=(e=>0<e?1:-1),S=(h*=500*b/w**2),k=(i*=(1+v(t))*b/w),C=x(p)*b/4,E=[],M=0,R=0,T=0,A=1,F=0,L=0,I=0,N,D)=>{for(l*=500*b/w**3,D=(s=99+s*w|0)+(o=o*w|0)+(n=n*w|0)+(g=g*w|0),p*=b/w,d*=b/w,c*=w,m*=w;T<D;E[T++]=I)++L>100*f&&(L=0,I=M*i*Math.sin(R*p-C),I=x(I=a?1<a?2<a?3<a?Math.sin((I%b)**3):Math.max(Math.min(Math.tan(I),1),-1):1-(2*I/b%2+2)%2:1-4*Math.abs(Math.round(I/b)-I/b):Math.sin(I))*Math.abs(I)**r,I*=.3*e*(T<s?T/s:T<s+o?1:T<D-g?1-(T-s-o)/n:0),I=g?I/2+(g>T?0:(T<D-g?1:(T-D)/g)*E[T-g]/2):I),M+=1+v(u),R+=1+v(u),i+=h+=l,A&&++A>c&&(i+=d,k+=d,A=0),m&&++F>m&&(i=k,h=S,F=1,A=A||1);return y.PlaySamples(E)},y=new class{constructor(){this.c=new(AudioContext||webkitAudioContext),this.c.F=this.c.createBufferSource,this.c.createBufferSource=((e=this.c.F())=>(e.start=e.start||e.noteOn,e.stop=e.stop||e.noteOff,e)),this.randomSeed=Date.now()}KeyDirection(e){let t=0,i=0;return 87!=e&&38!=e||++i,83!=e&&40!=e||--i,68!=e&&39!=e||++t,65!=e&&37!=e||--t,{x:t,y:i}}Medal(){}PlaySeed(e,t=1,i=1,s=.05){const o=()=>this.Random();this.randomSeed=e,o(o(o())),t/=2,e=o()**3*t;const n=o()**3*t,a=e+n+(t*=o()**3);return g(...[i,s,2e3*o()**2,e,n,t,5*o()|0,3*o()**2,(.5>o())*o()**3*99*(.5>o()?1:-1),(.5>o())*o()**3*99*(.5>o()?1:-1),(.5>o())*o()**2*1e3*(.5>o()?1:-1),o()**2*a,(.5>o())*o()*a,(.5>o())*o()**4,(.5>o())*o()**3*9*(.5>o()?1:-1),(.5>o())*o()**4,(.5>o())*o()**3/2])}PlaySamples(e,t=44100){t=this.c.createBuffer(1,e.length,t);const i=this.c.createBufferSource();return t.getChannelData(0).set(e),i.buffer=t,i.connect(this.c.destination),i.start(),i}Speak(e){speechSynthesis.speak(new SpeechSynthesisUtterance(e))}CreateShader(e,t){const i=(e=e.getContext("webgl2")).createShader(e.VERTEX_SHADER);e.shaderSource(i,"#version 300 es\nin vec4 p;void main(){gl_Position=p;}"),e.compileShader(i);var s=e.ARRAY_BUFFER;if(e.bindBuffer(s,e.createBuffer()),e.bufferData(s,new Int8Array([-3,1,1,-3,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.BYTE,0,0,0),s=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(s,"#version 300 es\nprecision mediump float;uniform float iTime;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;out vec4 outColor;\n"+t+"\nvoid main(){mainImage(outColor,gl_FragCoord.xy);outColor.a=1.;}"),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw e.getShaderInfoLog(s);return e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),t=e.createProgram(),e.attachShader(t,i),e.attachShader(t,s),e.linkProgram(t),e.useProgram(t),t}RenderShader(e,t,i=0){const s=e.getContext("webgl2");s.uniform3f(s.getUniformLocation(t,"iResolution"),e.width,e.height,1),s.uniform1f(s.getUniformLocation(t,"iTime"),i),s.uniform1i(s.getUniformLocation(t,"iChannel0"),0),s.viewport(0,0,e.width,e.height),s.drawArrays(s.TRIANGLE_FAN,0,3),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e)}Clamp(e,t=0,i=1){return Math.min(Math.max(e,t),i)}Percent(e,t,i){return i-t?this.Clamp((e-t)/(i-t),0,1):0}Lerp(e,t,i){return t+this.Clamp(e,0,1)*(i-t)}Random(e=1,t=0){return this.Percent(1e9*(Math.sin(++this.randomSeed)+1)%1,t,e)}};desktop.C(),setInterval(desktop.D,16);try{let e;ontouchstart=ontouchmove=ontouchend=ontouchcancel=(t=>{t.preventDefault();const i=t.touches.length;i?(t.x=t.touches[0].clientX,t.y=t.touches[0].clientY,!e&&onmousedown(t),onmousemove(t)):e&&onclick(t),e=i})}catch(e){}</script>