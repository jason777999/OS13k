Input
<p><textarea id=I></textarea>
<p>Output
<p><textarea id=O readonly></textarea>
<p></p><button id=B>Convert</button>
<script>

Convert = (instruments, patterns, sequence, BPM)=>
{
    const patternsNew = [], sequenceNew = [];

    for(s of sequence)
    {
        const sequencePatterns = []
        for(p of patterns[s])
        {
            // get pattern index, add if new
            const i = patternsNew.findIndex(a=>JSON.stringify(a)==JSON.stringify(p));
            sequencePatterns.push(i >= 0 ? i : patternsNew.push(p) - 1);
        }

        sequenceNew.push(sequencePatterns)
    }

    return [instruments, patternsNew, sequenceNew, BPM];
}

ArrayToString = e=> 
{
  if (!Array.isArray(e))
  	return e !=undefined? e : '';
    
  let o='';
  for(let i=0; i<e.length; ++i)
  	o += (i?',':'') + ArrayToString(e[i]);

  if (e.length && e[e.length-1] == undefined)
    o += ',';

  return '[' + o + ']';
}

B.onclick = e=> O.value = ArrayToString(Convert(...eval(I.value)));

</script>