<style>body{background:#111;color:#fff;user-select:none;text-align:center}</style>
<span id=B></span>
&nbsp;Seed &nbsp;<input type=number id=S style=width:99 oninput=b(t=3,localStorage.OS13kP=S.value) onfocus=b(t=3)>
&nbsp;Octave <input type=number id=D style=width:40 value=0 min=-3 max=3 onchange=D.value=OS13k.Clamp(D.value,-3,3)><br>
Volume <input type=range style=width:70 id=V value=50>
Length <input type=range style=width:70 id=L value=25>
Noise <input type=range style=width:70 id=N value=0>
Shape <input type=range style=width:70 id=H value=50>
<hr><div><script>

// play a note
p=e=>
{
    n = OS13k.Note(e - 33 + D.value*12); // root note = A 440
    l = .1 + L.value / 50;               // length
    v = V.value / 50;                    // volume
    
    // animate color when played
    f = eval('B' + e);            // get the button
    q = f.style.background;       // save old background color
    f.style.background = '#f00';  // set background to red
    f.style.transition = '';      // cancel transition
    f.innerText;                  // reset transition
    f.style.transition = l + 's'; // transition time
    f.style.background = q;       // old background color
    
    // play sound
    t-3 ? [                       // instruments
        [1, 2, 4, 8],             // organ
        [3, 5, 7, 9],             // oboe
        [1]                       // sin
    ][ t ].map(                   // get instrument
        f=>zzfx(...[              // play zzfx sound
            v/(1+Math.log2(f))/3, // scale volume
            0,                    // no randomness
            f*n,,                 // frequency
            l,,,                  // sustain
            (H.value/50)**4,      // shape curve
            ,,,,,N.value/100      // noise
        ])) :
        OS13k.PlaySeed(S.value, l, v, 0, n); // play seed
}

// create piano keys
for( t = i = 0;            // init selected sound & iterator
        i < 36;)            // 72 keys
    document.body.innerHTML +=                                 // add to html
    `<div id=B${ z = 24 - (i/12|0)*12 + i%12                   // reorder keys
    } onmouseover=event.buttons&&p(${ z                        // mouse over
    }) onmousedown=p(${ z                                      // mouse down
    }) style="display:inline-block;border:1px solid #000;background:#${ // style
    '02579'.indexOf( i%12 - 1 ) < 0 ?                          // b or w
    'fff;width:54;height:129' :                                // white
    '000;position:absolute;margin-left:-14;width:27;height:70'}"></div>${ // black
    ++i%12 ? '' : '<br>'}`;                                    // next row

// create settings
b=e=>
{
    // clear old settings
    B.innerHTML = '';

    // create buttons
    ['Piano', 'Oboe', 'Wave'].map((i,j)=>                  // instruments
        B.innerHTML += `<button style='border:5px solid #${ // button
            t-j? "111" : "f00" }' onclick=b(t=${            // color
            j })>${                                         // click
            i }</button> `);                                // text
          
    // disable noise & shape if seed
    H.disabled = N.disabled = t==3;
    
    // set seed border if selected
    S.style.border = `5px solid #${ t==3? "f00" : "111"}`
}

// load saved seed and init
b(S.value = localStorage.OS13kP|0 || 0);

// keyboard control
onkeydown=e=>
{
    k = 'zsxdcvgbhnjm,l.;/q2w3er5t6y7ui9o0p[=]'  // map key to note
        .indexOf(e.key.toLowerCase());           // find the key
        document.activeElement == S ||           // prevent input when editing seed
        e.repeat ? 0 :                           // prevent key repeats
        Math.abs(i = e.keyCode - 39) - 1 ?       // check for up & down arrows
        k < 0 || p(k > 16 ? k-5 : k) :           // set octave and play note
        D.value = OS13k.Clamp(D.value - i, -3, 3);   // octave control
}

</script>