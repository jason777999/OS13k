<h1 class="code-line" data-line-start=0 data-line-end=1 ><a id="Welcome_to_OS13k_0"></a>Welcome to OS13k!</h1>
<p class="has-line-data" data-line-start="1" data-line-end="2">OS13k is a tiny operating system designed for a JS13k community project. It includes native support for Shadertoys, Dweets, ZzFX sounds, music, trophies, fullscreen, touch control, and more.</p>
<h2 class="code-line" data-line-start=5 data-line-end=6 ><a id="Please_keep_this_project_confidential_5"></a>Please keep this project confidential!</h2>
<h1 class="code-line" data-line-start=7 data-line-end=8 ><a id="Live_DemohttpskilledbyapixelgithubioOS13k_7"></a><a href="https://killedbyapixel.github.io/OS13k">Live Demo</a></h1>
<h1 class="code-line" data-line-start=8 data-line-end=9 ><a id="Discordhttpsdiscordggn8vxUcZ_8"></a><a href="https://discord.gg/n8vxUcZ">Discord</a></h1>
<h1 class="code-line" data-line-start=9 data-line-end=10 ><a id="Trello_Boardhttpstrellocomb1PNeOZfMos13k_ask_for_an_invite_9"></a><a href="https://trello.com/b/1PNeOZfM/os13k">Trello Board</a> (ask for an invite)</h1>
<h2 class="code-line" data-line-start=11 data-line-end=12 ><a id="The_Plan_11"></a>The Plan</h2>
<ul>
<li class="has-line-data" data-line-start="12" data-line-end="13">The idea is to build a tiny OS to host a variety of games, music, and apps that fits in 13 kilobytes</li>
<li class="has-line-data" data-line-start="13" data-line-end="14">The core of OS13k is around 7k zipped, and by using it‚Äôs shared features we can pack a lot into 13k</li>
<li class="has-line-data" data-line-start="14" data-line-end="15">Programs should be in the 100-500 byte range, what matters most is how well it zips with everything else</li>
<li class="has-line-data" data-line-start="15" data-line-end="16">We plan to fit 10-20 programs <a href="http://js13kgames.com/entries/26-games-in-1">(probably not 26!)</a> üòÖ</li>
<li class="has-line-data" data-line-start="16" data-line-end="17"><strong>A very important rule for JS13k is that all content must be new, so no old stuff!</strong></li>
<li class="has-line-data" data-line-start="17" data-line-end="18">You can start with an old project but polish it up a lot, minify it and make it work with OS13k</li>
<li class="has-line-data" data-line-start="18" data-line-end="19">We will need to curate the best and perhaps smallest content for what actually lands in the JS13k build</li>
<li class="has-line-data" data-line-start="19" data-line-end="20">Anything left out of the JS13k build will still be available in the full GitHub version</li>
<li class="has-line-data" data-line-start="20" data-line-end="22">We make this repo public on day 1 of JS13k and open source everything, haven‚Äôt decided on license yet</li>
</ul>
<h3 class="code-line" data-line-start=22 data-line-end=23 ><a id="You_can_learn_more_about_JS13k_herehttpsjs13kgamescom_22"></a><a href="https://js13kgames.com/">You can learn more about JS13k here</a></h3>
<h2 class="code-line" data-line-start=24 data-line-end=25 ><a id="Programming_Info_24"></a>Programming Info</h2>
<ul>
<li class="has-line-data" data-line-start="25" data-line-end="26">OS13k stores it‚Äôs list of programs in programs.js</li>
<li class="has-line-data" data-line-start="26" data-line-end="27">For fast iteration when developing, the first program in the list opens automatically</li>
<li class="has-line-data" data-line-start="27" data-line-end="29">Though you can use images and other files, for JS13k we will need each program in one html file</li>
</ul>
<p class="has-line-data" data-line-start="29" data-line-end="30">Add an icon config to programs.js to register your program, and send me pull request, examples‚Ä¶</p>
<ul>
<li class="has-line-data" data-line-start="30" data-line-end="31">{src:‚Äòsystem/test.html‚Äô, name:‚ÄòHello!‚Äô, icon:‚Äò‚úåÔ∏èüòÑ‚Äô, reload:1, code:1, sticky:1}</li>
<li class="has-line-data" data-line-start="31" data-line-end="32">{src:‚Äòdweets/underwaterCavern.dweet.js‚Äô, icon:‚Äòüåä‚Äô, author:‚ÄòPavel‚Äô}</li>
<li class="has-line-data" data-line-start="32" data-line-end="33">{src:‚Äòtoys/infiniteYinYangs.shader.txt‚Äô, icon:‚Äò‚òØ‚Äô, help:‚ÄòPut instructions here.‚Äô}</li>
<li class="has-line-data" data-line-start="33" data-line-end="35">{src:‚Äòhelp.html‚Äô}</li>
</ul>
<h3 class="code-line" data-line-start=35 data-line-end=36 ><a id="Programs_35"></a>Programs</h3>
<ul>
<li class="has-line-data" data-line-start="36" data-line-end="37">OS13k can open any html file and it will work the same as if opened directly</li>
<li class="has-line-data" data-line-start="37" data-line-end="38">Chrome is recommended for development, but Firefox is also supported</li>
<li class="has-line-data" data-line-start="38" data-line-end="39"><a href="https://discourse.mozilla.org/t/firefox-68-local-files-now-treated-as-cross-origin-1558299/42493/9">Some browsers like Firefox may not work locally if it treats local files as cross-origin</a></li>
<li class="has-line-data" data-line-start="39" data-line-end="40">To force a page to refresh you can add ?(version) to the src link‚Ä¶ {src:‚ÄòHelp.html?1‚Äô}</li>
<li class="has-line-data" data-line-start="40" data-line-end="41">Try to keep your program paused or light on cpu when it does not have focus, !document.hasFocus()</li>
<li class="has-line-data" data-line-start="41" data-line-end="42">Dweets and Shadertoys are automatically paused when not focused (unless sleep:0 is set)</li>
<li class="has-line-data" data-line-start="42" data-line-end="43">Prefix all local storage keys with OS13kYourProgramName to prevent collisions during JS13k</li>
<li class="has-line-data" data-line-start="43" data-line-end="44">OS13k works well on mobile devices, so we could have a separate entry for the JS13k mobile category</li>
<li class="has-line-data" data-line-start="44" data-line-end="46">We recommend <a href="http://brackets.io/">Brackets</a> for development, but you can use whatever you want</li>
</ul>
<h3 class="code-line" data-line-start=46 data-line-end=47 ><a id="Minification_Tips_46"></a>Minification Tips</h3>
<ul>
<li class="has-line-data" data-line-start="47" data-line-end="48">The goal is to fit as much as possible into 13 kilobytes so everything must be small and clean</li>
<li class="has-line-data" data-line-start="48" data-line-end="49">For inclusion in the JS13k build, programs need be around 100-500 bytes when minified</li>
<li class="has-line-data" data-line-start="49" data-line-end="50"><em>Always remember, this will be zipped! Don‚Äôt over golf your code.</em></li>
<li class="has-line-data" data-line-start="50" data-line-end="51">There is very little overhead for common functions calls and strings</li>
<li class="has-line-data" data-line-start="51" data-line-end="52">Don‚Äôt worry to much about html tags, they will appear often and compress well</li>
<li class="has-line-data" data-line-start="52" data-line-end="53">Try to limit your use of non repeated text strings, those compresses the worst, use emojis where possible</li>
<li class="has-line-data" data-line-start="53" data-line-end="54">Don‚Äôt compress your code in any way, let zip do the work for you</li>
<li class="has-line-data" data-line-start="54" data-line-end="55">Dweets and Shadertoys are great for making programs with reduced setup cost</li>
<li class="has-line-data" data-line-start="55" data-line-end="56">You do not need charset=utf-8, it will be applied automatically</li>
<li class="has-line-data" data-line-start="56" data-line-end="57">For the OS13k core system we am using <a href="https://closure-compiler.appspot.com/home">Google Closer</a> and <a href="https://xem.github.io/terser-online">Terser</a></li>
<li class="has-line-data" data-line-start="57" data-line-end="59">We will pack everything together into one giant html file before zipping to save space</li>
</ul>
<h3 class="code-line" data-line-start=59 data-line-end=60 ><a id="Games_59"></a>Games</h3>
<ul>
<li class="has-line-data" data-line-start="60" data-line-end="61"><em>JS13k is a game development competition, so we need to focus on games and fun apps</em></li>
<li class="has-line-data" data-line-start="61" data-line-end="62">Don‚Äôt put music in your games, music will be handled by music specific programs</li>
<li class="has-line-data" data-line-start="62" data-line-end="63">Use local storage to save your game‚Äôs data (prefix keys with OS13kYourProgramName)</li>
<li class="has-line-data" data-line-start="63" data-line-end="64">Use JS13k features like trophies, seeded sound effects, and speech to enrich your games</li>
<li class="has-line-data" data-line-start="64" data-line-end="65">To add sounds with little space, use seeded sounds with a tiny function call OS13k.PlaySeed(seed)</li>
<li class="has-line-data" data-line-start="65" data-line-end="67">Dweets and Shaders are the smallest way to make games, check out Lava Rush for a shader example</li>
</ul>
<h3 class="code-line" data-line-start=67 data-line-end=68 ><a id="Apps_67"></a>Apps</h3>
<ul>
<li class="has-line-data" data-line-start="68" data-line-end="69">We will include some non-game apps that are small and fun to use</li>
<li class="has-line-data" data-line-start="69" data-line-end="70">Keep text short and essential, try using emojis instead</li>
<li class="has-line-data" data-line-start="70" data-line-end="71">Apps where the user creates something are ideal</li>
<li class="has-line-data" data-line-start="71" data-line-end="72">Design your app well and let players have fun figuring out how to use it</li>
<li class="has-line-data" data-line-start="72" data-line-end="74"><em>Apps can play sounds and have trophies too!</em></li>
</ul>
<h3 class="code-line" data-line-start=74 data-line-end=75 ><a id="Music_74"></a>Music</h3>
<ul>
<li class="has-line-data" data-line-start="75" data-line-end="76"><a href="https://github.com/keithclark/ZzFXM">Keith Clark created a system to play tracker songs with ZzFX sound effects</a></li>
<li class="has-line-data" data-line-start="76" data-line-end="77">We will include this in the OS as a core feature soon, something like OS13k.PlayMusic(musicData)</li>
<li class="has-line-data" data-line-start="77" data-line-end="78">We need music generators, synth instruments, and maybe even mini albums</li>
<li class="has-line-data" data-line-start="78" data-line-end="79">The idea is that players can listen to music while messing with games and apps</li>
<li class="has-line-data" data-line-start="79" data-line-end="80">The music tools can even work in conjunction with each other (step sequencer drum kit + piano)</li>
<li class="has-line-data" data-line-start="80" data-line-end="82">Music programs should continue playing if the frame loses focus, but maybe with reduced graphics to lower the load</li>
</ul>
<h3 class="code-line" data-line-start=82 data-line-end=83 ><a id="Dweets_and_Shadertoys_82"></a>Dweets and Shadertoys</h3>
<ul>
<li class="has-line-data" data-line-start="83" data-line-end="84">Programs with the extension .dweet.js or .shader.txt or will automatically load as Dweets or Shadertoys!</li>
<li class="has-line-data" data-line-start="84" data-line-end="85">Dweets and Shadertoys are automatically paused when they don‚Äôt have focus</li>
<li class="has-line-data" data-line-start="85" data-line-end="86">They also automatically have the show code option by default unless explictly disabled</li>
<li class="has-line-data" data-line-start="86" data-line-end="87">Dweets do not need to be 140 characters, there is no size limit</li>
<li class="has-line-data" data-line-start="87" data-line-end="88">Dweets can do anything that other programs can do including calling OS13k functions and ZzFX</li>
<li class="has-line-data" data-line-start="88" data-line-end="89">Shaders support iTime, iFrame, iMouse, iResolution, and iChannel0</li>
<li class="has-line-data" data-line-start="89" data-line-end="91">iChannel0 is an image of the previous frame, this can be used to make effects or even store game logic</li>
</ul>
<h3 class="code-line" data-line-start=91 data-line-end=92 ><a id="System_Calls_91"></a>System Calls</h3>
<ul>
<li class="has-line-data" data-line-start="92" data-line-end="93">use the OS13k object to access the OS13k system</li>
<li class="has-line-data" data-line-start="93" data-line-end="94">OS13k is set after load, so if you need it on load use parent.OS13k</li>
<li class="has-line-data" data-line-start="94" data-line-end="95">zzfx also becomes available after your program loads and can be called directly</li>
<li class="has-line-data" data-line-start="95" data-line-end="96">Use the OS13k object to access OS13k features</li>
<li class="has-line-data" data-line-start="96" data-line-end="97">OS13k.CreateShader(canvas, shaderCode) - Create a shadertoy compatible webgl shader</li>
<li class="has-line-data" data-line-start="97" data-line-end="98">OS13k.RenderShader(canvas, shaderProgram, time=0, frame=0) - Render a shader</li>
<li class="has-line-data" data-line-start="98" data-line-end="99">OS13k.KeyDirection(key) - Get {x, y} position from a key code for WASD and arrow keys</li>
<li class="has-line-data" data-line-start="99" data-line-end="100">OS13k.PlaySamples(samples, sampleRate=44100) - Play audio samples</li>
<li class="has-line-data" data-line-start="100" data-line-end="101">OS13k.PlaySeed(seed, lengthScale=1, volume=1, randomness=.05) - Play a zzfx sound from seed</li>
<li class="has-line-data" data-line-start="101" data-line-end="102">OS13k.Speak(text, rate=1, pitch=1, volume=1, language=‚Äòen‚Äô) - Play speech of the text</li>
<li class="has-line-data" data-line-start="102" data-line-end="103">OS13k.KillHTML(string) - Stops HTML in string by setting all ‚Äò&lt;‚Äô to ‚Äò‚Äô</li>
<li class="has-line-data" data-line-start="103" data-line-end="105">OS13k.Glitch(string, count) - Applies corruption to a string</li>
</ul>
<h3 class="code-line" data-line-start=105 data-line-end=106 ><a id="Math_Library_105"></a>Math Library</h3>
<ul>
<li class="has-line-data" data-line-start="106" data-line-end="107">Some basic math functions are provided to help reduce code duplication</li>
<li class="has-line-data" data-line-start="107" data-line-end="108">OS13k.Random(max=1, min=0) - Get a seeded random value clamped between min and max</li>
<li class="has-line-data" data-line-start="108" data-line-end="109">OS13k.randomSeed - You must set the seed before calling OS13k.Random</li>
<li class="has-line-data" data-line-start="109" data-line-end="110">OS13k.Clamp(a, min=0, max=1) - Clamp value between min and max</li>
<li class="has-line-data" data-line-start="110" data-line-end="111">OS13k.Percent(v, a, b) - Get clamped percent between a and b</li>
<li class="has-line-data" data-line-start="111" data-line-end="113">OS13k.Lerp(p, a, b) - Lerp clamped percent between a and b</li>
</ul>
<h3 class="code-line" data-line-start=113 data-line-end=114 ><a id="ZzFX_113"></a>ZzFX</h3>
<ul>
<li class="has-line-data" data-line-start="114" data-line-end="115">ZzFX is a super tiny open source JavaScript sound effect synth, but don‚Äôt let it‚Äôs size fool you!</li>
<li class="has-line-data" data-line-start="115" data-line-end="116">Here is the sound designer for ZzFX with a link to the public repo <a href="https://zzfx.3d2k.com/">https://zzfx.3d2k.com/</a></li>
<li class="has-line-data" data-line-start="116" data-line-end="117">ZzFx sounds can played directly by calling zzfx, volume is controlled by the system</li>
<li class="has-line-data" data-line-start="117" data-line-end="118">A seeded ZzFX sound player is available to save space with much smaller sound calls</li>
<li class="has-line-data" data-line-start="118" data-line-end="119">OS13k.PlaySeed(seed, lengthScale=1, volume=1, randomness=.05)</li>
<li class="has-line-data" data-line-start="119" data-line-end="120">Example OS13k.PlaySeed(1006), or make a function PlaySound=sound=&gt;OS13k.PlaySeed([1006,5023,7][sound])</li>
<li class="has-line-data" data-line-start="120" data-line-end="122"><em>We will create a tool for browsing sound seeds soon</em></li>
</ul>
<h3 class="code-line" data-line-start=122 data-line-end=123 ><a id="Program_Settings_and_Defaults_122"></a>Program Settings and Defaults</h3>
<ul>
<li class="has-line-data" data-line-start="123" data-line-end="124">name - Display name (if absent will build nice name from camel case src filename)</li>
<li class="has-line-data" data-line-start="124" data-line-end="125">src - Source filename</li>
<li class="has-line-data" data-line-start="125" data-line-end="126">icon - Can contain html tags, fits about 2 emojis</li>
<li class="has-line-data" data-line-start="126" data-line-end="127">don‚Äôt close html tags, they will automatically be closed</li>
<li class="has-line-data" data-line-start="127" data-line-end="128">width (720) and height (405) - Size of window (default is 16:9 aspect)</li>
<li class="has-line-data" data-line-start="128" data-line-end="129">help (optional) - Help message, shows an icon on the window‚Äôs titlebar (try to keep it short)</li>
<li class="has-line-data" data-line-start="129" data-line-end="130">author (optional) - Name of creator</li>
<li class="has-line-data" data-line-start="130" data-line-end="131">reload (1) - Shows the reload option</li>
<li class="has-line-data" data-line-start="131" data-line-end="132">code (0) - Shows code option, defaults to true for dweets/shaders, help is shown instead if it exists</li>
<li class="has-line-data" data-line-start="132" data-line-end="133">full (1) - Enables full screen option</li>
<li class="has-line-data" data-line-start="133" data-line-end="134">sleep (1) - Dims window and pauses dweets/shaders when not focused</li>
<li class="has-line-data" data-line-start="134" data-line-end="136">sticky (0) - Will automatically open of program on restart if it was open</li>
</ul>
<h1 class="code-line" data-line-start=136 data-line-end=137 ><a id="Trophies_136"></a>Trophies</h1>
<ul>
<li class="has-line-data" data-line-start="137" data-line-end="138">Trophies are perhaps the most important part of OS13k and have many uses</li>
<li class="has-line-data" data-line-start="138" data-line-end="139">Apps can register trophies for their games, the OS tracks which are unlocked</li>
<li class="has-line-data" data-line-start="139" data-line-end="140">To unlock trophies use OS13k.Trophy(gameName, trophyName, icon, message)</li>
<li class="has-line-data" data-line-start="140" data-line-end="141">You can pass in a value for message like a high score for example</li>
<li class="has-line-data" data-line-start="141" data-line-end="142">‚ÄúOS13kTrophy,gameName,trophyName,icon‚Äù is the unique local storage key for each trophy</li>
<li class="has-line-data" data-line-start="142" data-line-end="143"><em>HTML tags and ‚Äò,‚Äô can not used in trophy data, it will apper garbled</em></li>
<li class="has-line-data" data-line-start="143" data-line-end="144">When a new trophy is unlocked or the message is changed a popup will automatically appear</li>
<li class="has-line-data" data-line-start="144" data-line-end="145">Total trophy count is shown in the taskbar and the trophy case shows all unlocked trophies</li>
<li class="has-line-data" data-line-start="145" data-line-end="146"><em>You can use tophies to unlock stuff!</em> Use OS13k.GetTrophy to check if player has a trophy</li>
<li class="has-line-data" data-line-start="146" data-line-end="147"><em>Keep your trophy names and messages short! Experiment with fun ideas and icons</em></li>
<li class="has-line-data" data-line-start="147" data-line-end="148">Trophies can be tested and cleared with the System/Test tool</li>
<li class="has-line-data" data-line-start="148" data-line-end="150">You can even add unnamed trophies with just an icon and message</li>
</ul>
<h3 class="code-line" data-line-start=150 data-line-end=151 ><a id="Trophy_Functions_150"></a>Trophy Functions</h3>
<ul>
<li class="has-line-data" data-line-start="151" data-line-end="152">OS13k.Trophy(game=‚Äô‚Äô, name=‚Äô‚Äô, icon=‚Äô‚Äô, message=‚Äô‚Äô) - Unlock a trophy</li>
<li class="has-line-data" data-line-start="152" data-line-end="153">OS13k.GetTrophy(game=0, name=0, icon=0) - Get most recent matching trophy, 0 if no trophy</li>
<li class="has-line-data" data-line-start="153" data-line-end="155">OS13k.Trophies() - Get full list of trophy objects</li>
</ul>
<h3 class="code-line" data-line-start=155 data-line-end=156 ><a id="Any_JS13k_game_can_use_trophies_even_if_not_part_of_OS13k_155"></a>Any JS13k game can use trophies, even if not part of OS13k!</h3>
<ul>
<li class="has-line-data" data-line-start="156" data-line-end="157">To add a trophies to any JS13k game, just save a special key to localStorage!</li>
<li class="has-line-data" data-line-start="157" data-line-end="158">The simplest way to add a single trophy is localStorage[‚ÄòOS13kTrophy,GameName‚Äô]=‚Äô‚Äô</li>
<li class="has-line-data" data-line-start="158" data-line-end="159">For more control use localStorage[‚ÄòOS13kTrophy,GameName,TrophyName,Icon‚Äô] = Message</li>
<li class="has-line-data" data-line-start="159" data-line-end="160">You can change the message to update the trophy, like a highscore for example</li>
<li class="has-line-data" data-line-start="160" data-line-end="161">OS13k automatically checks localStorage and display popups for new trophies</li>
<li class="has-line-data" data-line-start="161" data-line-end="162">This is possible because all JS13k games share the same local storage! Pretty cool right?</li>
<li class="has-line-data" data-line-start="162" data-line-end="164"><em>Don‚Äôt abuse the trophy system, lets agree to around 5 trophies per game</em></li>
</ul>
<h3 class="code-line" data-line-start=164 data-line-end=165 ><a id="Resources_164"></a>Resources</h3>
<ul>
<li class="has-line-data" data-line-start="165" data-line-end="166"><a href="https://www.dwitter.net/">Dwitter</a> - Many ideas for tiny programs we can repurpose</li>
<li class="has-line-data" data-line-start="166" data-line-end="167"><a href="http://dweetabase.3d2k.com/">The Dweetabase</a> - An offline searable database of every dweet</li>
<li class="has-line-data" data-line-start="167" data-line-end="168"><a href="https://www.shadertoy.com/">Shadertoy</a> - There are many amazing tiny sized shaders <a href="https://www.shadertoy.com/results?query=2TC">(check out the 2TC tag)</a></li>
<li class="has-line-data" data-line-start="168" data-line-end="169"><a href="https://js1k.com/">JS1k</a> - Another great resource though these programs may be a bit to large</li>
<li class="has-line-data" data-line-start="169" data-line-end="170"><a href="https://js13kgames.com/">JS13k</a> - This is the contest we are entering</li>
<li class="has-line-data" data-line-start="170" data-line-end="171"><a href="https://emojipedia.org/">Emojipedia</a> - Good reference for emojis</li>
</ul>