<meta charset=utf-8>
<style>
*
{
font-family:arial;
user-select:none;
white-space:nowrap;
}
body
{
margin:0;
background:linear-gradient(#223,#322);
overflow:hidden;
}
#taskbar
{
position:absolute;
border:2px solid;
z-index:10000;
width:100%;
background:linear-gradient(#888,#333);
display:flex;
align-items:center;
left:-2;
}
.taskbarIcon
{
font-size:22;
width:44;
height:40;
text-shadow:1px 1px 2px #000;
display:flex;
align-items:center;
justify-content:center;
}
#tray
{
font-size:22;
display:flex;
align-items:center;
justify-content:center;
border:1px solid;
margin:2;
padding:2;
background:linear-gradient(#000,#333);
color:#fff;
}
#menu
{
visibility:hidden;
display:flex;
flex-direction:column;
background:#000;
}
.folder, #menu
{
position:absolute;
border:2px solid;
z-index:20000;
box-shadow:5px 5px 9px;
}
.icon
{
font-size:18;
height:18;
padding:4;
display:flex;
align-items:center;
}
.iconActive,
.taskbarIconActive         { background:linear-gradient(#ff8,#fff); }
.taskbarIcon:hover         { background:linear-gradient(#fff,#44f); }
.taskbarIconActive:hover   { background:linear-gradient(#ff8,#44f); }
.folder                    { background:linear-gradient(#fff,#777); }
#title
{
height:100%;
color:#0002;
font-family:impact;
font-weight:900;
display:flex;
align-items:center;
justify-content:center;
font-size:20vw;
}
</style>
<template id=template>
<style>
:host
{
box-shadow:5px 5px 9px;
border:2px solid;
background:#000;
display:flex;
flex-direction:column;
overflow:hidden;
position:absolute;
}
.titlebar
{
height:44;
font-size:26;
background:linear-gradient(#eee,#888);
display:flex;
align-items:center;
justify-content:center;
overflow:hidden;
white-space:nowrap;
}
.titlebarActive
{
background:linear-gradient(#eee,#88f);
}
#frame
{
width:100%;
height:100%;
border:none;
background:#000;
overflow:hidden;
background:#fff;
}
#name
{
width:100%;
cursor:grab;
overflow:hidden;
}
#codeDisplay
{
height:99;
resize:none;
background:#000;
color:#fff;
display:none;
border:1px solid #fff;
outline:none;
}
#reload,
#full,
#code         { width:40; }
#close        { width:28; }
#help:hover   { background:#0ff; }
#code:hover   { background:#0f0; }
#full:hover   { background:#fff; }
#reload:hover { background:#ff0; }
#close:hover  { background:#f00; }
div svg       { width:100%; pointer-events:none; }
</style>
<svg width=0 height=0>
<symbol id=icon-code viewBox='0 0 10 10'>
<path stroke=#000 stroke-width=.7 fill=none d='M5 2L8 8L2 8L5 2L8 8'/>
<symbol id=icon-full viewBox='0 0 10 10'>
<rect stroke=#000 stroke-width=.7 fill=none x=1 y=2 width=8 height=6 />
<symbol id=icon-reload viewBox='0 0 10 10'>
<circle stroke=#000 stroke-width=.7 fill=none cx=5 cy=5 r=3 />
<symbol id=icon-close viewBox='0 0 10 10'>
<path stroke=#000 d='M1 1L9 9M9 1L1 9'/>
</template>
<div id=desktop>
<div id=programsFolder style=position:absolute></div>
<div id=taskbar>
<div id=traySpace style=flex:1></div>
<div id=tray>&nbsp;&nbsp;
<div id=trayMedals></div>üèÜ&nbsp;
<div id=trayTime></div>
<div id=trayVolume title='Toggle Mute'>&nbsp;üîä&nbsp;</div>
</div>
</div>
<div id=menu>
<button id=buttonFullScreen>Fullscreen
<button id=buttonShowCode>Show Code
<button id=buttonReload>Reload
<button id=buttonClose>Close
</div>
<div id=title>OS13k
<script src=programs.js?11></script>
<script>"use strict";let e,t,i,n,s,o,a,r,l,h=0,c=50,d=99;const m=()=>{for(const e of programsFolder.children)"os13k-folder"==e.localName&&(e.style.visibility="hidden");menu.style.visibility=""};class u extends HTMLElement{constructor(e,t=0){super(),this.className="taskbarIcon",this.innerHTML="<span style=pointer-events:none>"+e.icon,this.element=t,this.title=e.name+(e.l?" - Dweet":e.isShader?" - Shader":"")+(e.i?"\nBy "+e.i:""),traySpace.before(this)}f(){this.element.a(1)}b(e=1){o&&o.b(o=0),o=this,this.className="taskbarIcon"+(e?" taskbarIconActive":"")}}customElements.define("os13k-taskbar-icon",u);class p extends HTMLElement{constructor(e,t,i,n){super(),this.className="folder",this.style.left=t,this.style.top=i,this.u=n,programsFolder.appendChild(this);for(const t of e)this.appendChild(t.C=new g(t));t=this.getBoundingClientRect();for(const n of e)n.folder&&(n.C.folder=new p(n.folder,t.right-2,i,this)),i+=26}a(e){const t=""==this.style.visibility;m(),e&&t?n&&n.a():(this.u&&this.u.a(),this.style.visibility=""),e&&this.parentNode==programsFolder&&(programsFolder.style.left=0,programsFolder.style.top=42)}}customElements.define("os13k-folder",p);class g extends HTMLElement{constructor({name:e,icon:t,src:i,width:n=720,height:s=405,author:o,folder:a,reload:r,code:h}){super(),i=i||"",e=e||i.split(".")[0],t=t||(e[0]?e[0].toUpperCase():"");const c=i?i.split(".")[1]:"";this.l="dweet"==c,this.isShader="shader"==c,(this.j=this.l||this.isShader)&&(r=1),l||i&&(l=this),this.name=e,this.icon=t,this.src=i,this.width=n,this.height=s,this.i=o,this.reload=r,this.code=h||this.j,this.className="icon",this.innerHTML='<span style=pointer-events:none;display:flex;width:100%>&nbsp;<span style="width:28;text-shadow:1px 1px 2px #000;text-align:center">'+t+"</span>&nbsp;<span style=flex:1>"+e+"</span><span style=width:20;text-align:right>"+(a?"‚ñ∂":"")}s(){s=this,this.className="icon iconActive",(this.folder?this.folder:this.offsetParent).a()}f(){if(this.src)this.window||(this.window=new w(this)),this.window.a(1);else if(!this.folder){m();for(let e;!e;){e=1;for(const t of desktop.children)t.h&&t.h(e=0)}c=50,d=99}}}function f(e){e.a(),(e=e.A).webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()}function y(e){e.a(),e.g.style.display=(e.D=!e.D)?"block":""}function b(e){e.B.style.visibility="hidden",e.m.location.reload()}customElements.define("os13k-icon",g);class w extends HTMLElement{constructor(e){super(),desktop.appendChild(this),this.icon=e,this.v=new u(e,this),this.style.left=c,this.style.top=d,400<(d+=46)&&(d=99),1e3<(c+=46)&&(c=50),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=template.innerHTML;const t=this.F=document.createElement("div");t.id="titlebar",this.shadowRoot.appendChild(t);var i=document.createElement("div");i.id="name",i.innerHTML='<div style=pointer-events:none>&nbsp;<span style="text-shadow:2px 2px 3px #000">'+e.icon+"</span>&nbsp;"+e.name+(e.i?" - "+e.i:""),t.appendChild(i),(i=((e,i)=>{const n=document.createElement("div");n.innerHTML=`<svg><use href=#icon-${n.id=e}>`,n.title=i,t.appendChild(n)}))("full","Full Screen"),e.code&&i("code","Show Code"),e.reload&&i("reload","Reload"),i("close","Close"),(i=document.createElement("div")).style.height=2,this.shadowRoot.appendChild(i),(i=this.A=document.createElement("div")).style.background="#000",this.shadowRoot.appendChild(i),this.style.width=Math.min(this.icon.width,innerWidth-4),i.style.width=Math.min(this.icon.width,innerWidth-4),i.style.height=Math.min(this.icon.height,innerHeight);const n=this.B=document.createElement("iframe");n.id="frame",n.style.visibility="hidden",n.src=e.src,i.appendChild(n),n.onload=(e=>{const t=(e=this.m=e.target.contentWindow).document,i=this.icon.j?t.body.innerText:t.body.innerHTML;this.g||(this.g=document.createElement("textarea"),this.g.id="codeDisplay",this.g.setAttribute("readOnly",1),this.g.value=i,this.shadowRoot.appendChild(this.g)),e.OS13k=S,e.zzfx=v,e.OS13kStart&&e.OS13kStart(),this.icon.j&&(t.body.innerHTML="<canvas id=c width=1920 height=1080 style=width:100%;background:#"+(this.icon.l?"fff":"000")+">",t.body.style="background:#111;overflow:hidden;margin:0;display:flex;align-items:center",this.icon.l&&e.eval("u=t=>{"+i+"};x=c.getContext`2d`;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&u((60*(frame++/60)-frame-1|0?frame-1:frame)/60));loop(frame=0)"),this.icon.isShader&&e.eval('g=c.getContext`webgl2`;x=y=z=w=0;onmousemove=e=>e.buttons&&(x=e.x,y=c.height-e.y);onmousedown=e=>(x=z=e.x,y=w=c.height-e.y);onmouseup=e=>z=w=0;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&(c.width=innerWidth,c.height=innerHeight,g.uniform4f(g.getUniformLocation(s,"iMouse"),x,y,z,w),OS13k.RenderShader(c,s,t/1e3)));loop(s=OS13k.CreateShader(c,`'+i+"`))")),n.style.visibility="",this.a()})}o(t,i){"name"==i.id&&(e=this),this.a()}f(e){"full"==e.id&&f(this),"code"==e.id&&y(this),"reload"==e.id&&b(this),"close"==e.id&&this.h(),"codeDisplay"!=e.id&&this.a()}a(e){m(),this.m&&this.m.focus(),this.b(),e&&(e=this.getBoundingClientRect(),this.style.left=S.Clamp(e.x,0,innerWidth-e.width),this.style.top=S.Clamp(e.y,42,Math.max(42,innerHeight-e.height)))}b(e=1){e&&n!=this&&(n&&n.b(0),this.style.zIndex=++h,buttonShowCode.style.display=this.icon.code?"":"none",buttonReload.style.display=this.icon.reload?"":"none"),e&&m(),n=e&&this,this.style.filter=e?"":"saturate(.7)brightness(.7",this.F.className="titlebar"+(e?" titlebarActive":""),this.v.b()}h(){this.icon.window=0,this.v.remove(),this.remove();{let e;for(const t of desktop.children)"os13k-window"==t.localName&&(!e||e.style.zIndex<t.style.zIndex)&&(e=t);e&&e.a()}}}customElements.define("os13k-window",w),onmousedown=(n=>{if(e)return onclick(n);if("button"!=n.target.localName){if("menu"!=n.target.offsetParent.id&&(menu.style.visibility=""),"folder"!=n.target.offsetParent.className&&n.target!=r&&m(),n.button)return 2==n.button;var s=n.originalTarget||n.path[0];n.target.o&&n.target.o(n,s),e&&(document.body.style.cursor="grabbing",desktop.style.pointerEvents="none",s=n.target.getBoundingClientRect(),t=n.x-s.x,i=n.y-s.y)}}),onmousemove=(n=>{e&&(e.style.left=n.x-t,e.style.top=n.y-i),s&&(s.className="icon"),n.target.s&&n.target.s()}),onclick=(t=>{document.body.style.cursor=desktop.style.pointerEvents="",e=0,menu.style.visibility="";const i=t.originalTarget||t.path[0];t.target!=r&&"os13k-icon"!=t.target.localName&&n&&"codeDisplay"!=i.id&&n.a(),t.target.f&&t.target.f(i)}),oncontextmenu=(e=>{if("button"!=e.target.localName){menu.style.visibility="";var t=menu;return e.target.b&&e.target!=r||(t=programsFolder,r.f()),e.target.element?e.target.element.b&&e.target.element.b():e.target.b&&e.target.b(),t.style.left=e.x,t.style.top=e.y,t.style.visibility="visible",!1}});const v=(e=1,t=.05,i=220,n=0,s=0,o=.1,a=0,r=1,l=0,h=0,c=0,d=0,m=0,u=0,p=0,g=0,f=0,y=2*Math.PI,b=44100,w=(e=>2*e*Math.random()-e),v=(e=>0<e?1:-1),x=(l*=500*y/b**2),C=(i*=(1+w(t))*y/b),M=v(p)*y/4,T=[],E=0,k=0,R=0,A=1,L=0,F=0,N=0,H,I)=>{for(h*=500*y/b**3,I=(n=99+n*b|0)+(s=s*b|0)+(o=o*b|0)+(f=f*b|0),p*=y/b,c*=y/b,d*=b,m*=b;R<I;T[R++]=N)++F>100*g&&(F=0,N=E*i*Math.sin(k*p-M),N=v(N=a?1<a?2<a?3<a?Math.sin((N%y)**3):Math.max(Math.min(Math.tan(N),1),-1):1-(2*N/y%2+2)%2:1-4*Math.abs(Math.round(N/y)-N/y):Math.sin(N))*Math.abs(N)**r,N*=e*(R<n?R/n:R<n+s?1:R<I-f?1-(R-n-s)/o:0),N=f?N/2+(f>R?0:(R<I-f?1:(R-I)/f)*T[R-f]/2):N),E+=1+w(u),k+=1+w(u),i+=l+=h,A&&++A>d&&(i+=c,C+=c,A=0),m&&++L>m&&(i=C,l=x,L=1,A=A||1);return S.PlaySamples(T)},S=new class{constructor(){this.c=new(AudioContext||webkitAudioContext),this.c.w=this.c.createBufferSource,this.c.createBufferSource=((e=this.c.w())=>(e.start=e.start||e.noteOn,e.stop=e.stop||e.noteOff,e));const e=this.gain=this.c.createGain();e.connect(this.c.destination),e.gain.value=.3}KeyDirection(e){let t=0,i=0;return 87!=e&&38!=e||++i,83!=e&&40!=e||--i,68!=e&&39!=e||++t,65!=e&&37!=e||--t,{x:t,y:i}}Medal(){}PlaySeed(e,t=1,i=1,n=.05){const s=()=>this.Random();this.randomSeed=e,t/=2,e=s()**3*t;const o=s()**3*t,a=e+o+(t*=s()**3);return v(...[i,n,2e3*s()**2,e,o,t,5*s()|0,3*s()**2,(.5>s())*s()**3*99*(.5>s()?1:-1),(.5>s())*s()**3*99*(.5>s()?1:-1),(.5>s())*s()**2*1e3*(.5>s()?1:-1),s()**2*a,(.5>s())*s()*a,(.5>s())*s()**4,(.5>s())*s()**3*9*(.5>s()?1:-1),(.5>s())*s()**4,(.5>s())*s()**3/2])}PlaySamples(e,t=44100){t=this.c.createBuffer(1,e.length,t);const i=this.c.createBufferSource();return t.getChannelData(0).set(e),i.buffer=t,i.connect(this.gain),i.start(),i}Speak(e){speechSynthesis.speak(new SpeechSynthesisUtterance(e))}CreateShader(e,t){const i=(e=e.getContext("webgl2")).createShader(e.VERTEX_SHADER);e.shaderSource(i,"#version 300 es\nin vec4 p;void main(){gl_Position=p;}"),e.compileShader(i);var n=e.ARRAY_BUFFER;if(e.bindBuffer(n,e.createBuffer()),e.bufferData(n,new Int8Array([-3,1,1,-3,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.BYTE,0,0,0),n=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(n,"#version 300 es\nprecision mediump float;uniform float iTime;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;out vec4 outColor;\n"+t+"\nvoid main(){mainImage(outColor,gl_FragCoord.xy);outColor.a=1.;}"),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw e.getShaderInfoLog(n);return e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),t=e.createProgram(),e.attachShader(t,i),e.attachShader(t,n),e.linkProgram(t),e.useProgram(t),t}RenderShader(e,t,i=0){const n=e.getContext("webgl2");n.uniform3f(n.getUniformLocation(t,"iResolution"),e.width,e.height,1),n.uniform1f(n.getUniformLocation(t,"iTime"),i),n.uniform1i(n.getUniformLocation(t,"iChannel0"),0),n.viewport(0,0,e.width,e.height),n.drawArrays(n.TRIANGLE_FAN,0,3),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)}Clamp(e,t=0,i=1){return Math.min(Math.max(e,t),i)}Percent(e,t,i){return i-t?this.Clamp((e-t)/(i-t),0,1):0}Lerp(e,t,i){return t+this.Clamp(e,0,1)*(i-t)}Random(e=1,t=0){return this.Percent(1e9*(Math.sin(++this.randomSeed)+1)%1,t,e)}};r=new u({icon:"üìÅ",name:"Apps"},new p(programs,0,0)),l&&l.f(),trayVolume.onclick=(()=>{const e=S.gain.gain.value;S.gain.gain.value=e?0:.3,trayVolume.innerHTML="&nbsp;"+(e?"üîá":"üîä")+"&nbsp;"}),buttonFullScreen.onclick=(()=>f(n)),buttonShowCode.onclick=(()=>y(n)),buttonReload.onclick=(()=>b(n)),buttonClose.onclick=(()=>n.h()),setInterval(()=>{var e=document.activeElement;a!=e&&(e.b&&e.b(),a=e),trayMedals.innerHTML=0,e=new Date,trayTime.innerHTML=e.getHours()%12+(9>=e.getMinutes()?":0":":")+e.getMinutes()},16);try{let e;ontouchstart=ontouchmove=ontouchend=ontouchcancel=(t=>{const i=t.touches.length;return i?(t.x=t.touches[0].clientX,t.y=t.touches[0].clientY,!e&&onmousedown(t),onmousemove(t)):e&&onclick(t),e=i,!1})}catch(e){}</script>