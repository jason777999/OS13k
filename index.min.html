<meta charset=utf-8> <style>body{margin:0;background:linear-gradient(#223,#322);overflow:hidden;font-family:arial;user-select:none;white-space:nowrap}#taskbar{position:absolute;border:2px solid;z-index:10000;width:100%;background:linear-gradient(#888,#333);left:-2;box-shadow:0 1px 9px}.taskbarIcon{font-size:22;width:44;height:40;text-shadow:1px 1px 2px #000}#tray{font-size:22;border:1px solid;margin:2;padding:2;background:linear-gradient(#000,#333);color:#fff;border-radius:7px;padding-left:9;padding-right:9}.trayIcon{padding-left:5;padding-right:5}.trayIcon:hover{background:#fff3}#menu{visibility:hidden;display:flex;flex-direction:column;background:#000}.folder,#menu{position:absolute;border:2px solid;z-index:20000;box-shadow:5px 5px 9px}.trophyPopup{position:relative;border:2px solid;z-index:10001;box-shadow:5px 5px 9px;width:250;padding:8;font-size:26;text-align:center;background:linear-gradient(#eee,#888);white-space:normal;margin:9;border-radius:9px}.icon{font-size:18;height:18;padding:4}.iconActive,.taskbarIconActive{background:linear-gradient(#ff8,#fff)}.taskbarIcon:hover{background:linear-gradient(#fff,#44f)}.taskbarIconActive:hover{background:linear-gradient(#ff8,#44f)}.folder{background:linear-gradient(#fff,#777)}#title{width:100%;height:100%;color:#0002;font-family:impact;font-weight:900;font-size:20vw}.flexCenter,.taskbarIcon,#taskbar,.icon,#tray,#title{display:flex;align-items:center;justify-content:center}</style> <template id=template> <style>:host{box-shadow:5px 5px 9px;border:2px solid;background:#000;display:flex;flex-direction:column;overflow:hidden;position:absolute}.titlebar{height:44;font-size:26;background:linear-gradient(#eee,#888);display:flex;align-items:center;justify-content:center;overflow:hidden;white-space:nowrap}.titlebarActive{background:linear-gradient(#eee,#88f)}#frame{width:100%;height:100%;border:0;background:#000;overflow:hidden;background:#fff}#name{width:100%;cursor:grab;overflow:hidden}.icon{text-shadow:2px 2px 3px #000;margin-left:9;margin-right:9}.titleBarElement,.icon{pointer-events:none;display:inline}#codeDisplay{height:99;resize:none;background:#000;color:#fff;display:none;border:1px solid #fff;outline:0}#reload,#full,#code{width:40}#close{width:28}#help:hover{background:#0ff}#code:hover{background:#0f0}#full:hover{background:#fff}#reload:hover{background:#ff0}#close:hover{background:#f00}div svg{width:100%;pointer-events:none}</style> <svg width=0 height=0> <symbol id=icon-code viewBox='0 0 10 10'> <path stroke=#000 stroke-width=.7 fill=none d='M5 2L8 8L2 8L5 2L8 8'/> <symbol id=icon-full viewBox='0 0 10 10'> <rect stroke=#000 stroke-width=.7 fill=none x=1 y=2 width=8 height=6 /> <symbol id=icon-reload viewBox='0 0 10 10'> <circle stroke=#000 stroke-width=.7 fill=none cx=5 cy=5 r=3 /> <symbol id=icon-close viewBox='0 0 10 10'> <path stroke=#000 d='M1 1L9 9M9 1L1 9'/> </template> <div id=desktop> <div id=taskbar> <div id=traySpace style=flex:1></div> <div id=tray> <div id=trayTrophy class=trayIcon title='Trophy Case'></div> <div id=trayVolume class=trayIcon title='Toggle Mute'></div> <div id=trayTime class=trayIcon></div> </div> </div> <div id=trophyPopups style=float:right;position:relative></div> <div id=programsFolder style=position:absolute></div> <div id=title style=position:absolute>OS13k <div id=menu> <button id=buttonFullScreen onclick=activeWindow.FullScreen()>Fullscreen <button id=buttonShowCode onclick=activeWindow.ShowCode()>Show Code <button id=buttonReload onclick=activeWindow.Reload()>Reload <button id=buttonClose onclick=activeWindow.Close()>Close <script src=programs.js?15></script>
<script>"use strict";let e,t,i,n,o,s,r,a,l,h,d=0,c=50,m=99,u=[];const p=()=>{requestAnimationFrame(p);var e=document.activeElement;if(r!=e&&(e.b&&e.b(),r=e),!document.fullscreenElement){var t=e=0;for(var i of[...trophyPopups.children]){let n=parseInt(i.style.top)+e-8;42>n&&(t||(i.style.opacity=(i.style.opacity||3)-.01)||(e+=(t=i.getBoundingClientRect()).height,trophyPopups.removeChild(i)),t=n=42),i.style.top=n}}trayTrophy.innerHTML=u.length+" 🏆",i=new Date,trayTime.innerHTML=i.getHours()%12+(9>=i.getMinutes()?":0":":")+i.getMinutes(),trayTime.title=i},g=()=>{for(const e of programsFolder.children)"os13k-folder"==e.localName&&(e.style.visibility="hidden");menu.style.visibility=""},y=()=>{x.gain.value=x.gain.value?0:.3,trayVolume.innerHTML=x.gain.value?"🔊":"🔇"},f=()=>{h.window?h.window.i():h.c(c=50,m=99)};class v extends HTMLElement{constructor(e,t=0){super(),this.className="taskbarIcon",this.innerHTML="<div style=pointer-events:none>"+e.icon,this.element=t,this.title=e.name+(e.o?" - Dweet":e.isShader?" - Shader":"")+(e.j?"\nBy "+e.j:""),traySpace.before(this)}c(){this.element.a(1)}b(e=1){s&&s.b(s=0),s=this,this.className="taskbarIcon"+(e?" taskbarIconActive":"")}}customElements.define("os13k-taskbar-icon",v);class w extends HTMLElement{constructor(e,t,i,n){super(),this.className="folder",this.style.left=t,this.style.top=i,this.B=n,programsFolder.appendChild(this);for(const t of e)this.appendChild(t.G=new b(t));t=this.getBoundingClientRect();for(const n of e)n.folder&&(n.G.folder=new w(n.folder,t.right-2,i,this)),i+=26}a(e){const t=!this.style.visibility;g(),e&&t?n&&n.a():(this.B&&this.B.a(),this.style.visibility=""),e&&this.parentNode==programsFolder&&(programsFolder.style.left=0,programsFolder.style.top=42)}}customElements.define("os13k-folder",w);class b extends HTMLElement{constructor({name:e,icon:t,src:i,width:n=720,height:o=405,author:s,folder:r,reload:a,code:d}){super(),i=i||"",e=e||i.split(".")[0],t=t||(e[0]?e[0].toUpperCase():"");const c=i?i.split(".")[1]:"";this.o="dweet"==c,this.isShader="shader"==c,(this.l=this.o||this.isShader)&&(a=1),l||i&&(l=this),this.name=e,this.icon=t,this.src=i,this.width=n,this.height=o,this.j=s,this.reload=a,this.code=d||this.l,this.className="icon",(n=document.createElement("div")).style="pointer-events:none;width:40;text-shadow:1px 1px 2px #000;text-align:center",n.innerHTML=t,this.appendChild(n),(t=document.createElement("div")).style="pointer-events:none;flex:1",t.innerHTML=e,this.appendChild(t),r&&((e=document.createElement("div")).className="iconFolder",e.style="pointer-events:none",e.innerHTML="▶",this.appendChild(e)),"trophies"==i.substr(0,8)&&(h=this)}w(){o=this,this.className="icon iconActive",(this.folder?this.folder:this.offsetParent).a()}c(){if(this.src)this.window||(this.window=new S(this)),this.window.a(1);else if(!this.folder){g();for(const e of[...desktop.children])e.i&&e.i();c=50,m=99}}}customElements.define("os13k-icon",b);class S extends HTMLElement{constructor(e){super(),desktop.appendChild(this),this.icon=e,this.C=new v(e,this),this.style.left=c,this.style.top=m,400<(m+=46)&&(m=99),1e3<(c+=46)&&(c=50),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=template.innerHTML,this.h=document.createElement("div"),this.h.id="titlebar",this.shadowRoot.appendChild(this.h),this.f=document.createElement("div"),this.f.id="name",this.h.appendChild(this.f);var t=document.createElement("div");t.className="icon",t.innerHTML=e.icon,this.f.appendChild(t),(t=document.createElement("div")).className="titleBarElement",t.innerHTML=e.name,this.f.appendChild(t),e.j&&((t=document.createElement("div")).className="titleBarElement",t.innerHTML=e.j,this.f.appendChild(t)),(t=((e,t)=>{const i=document.createElement("div");i.innerHTML=`<svg><use href=#icon-${i.id=e}>`,i.title=t,this.h.appendChild(i)}))("full","Full Screen"),e.code&&t("code","Show Code"),e.reload&&t("reload","Reload"),t("close","Close"),(t=document.createElement("div")).style.height=2,this.shadowRoot.appendChild(t),(t=this.u=document.createElement("div")).style.background="#000",this.shadowRoot.appendChild(t),this.style.width=Math.min(this.icon.width,innerWidth-4),t.style.width=Math.min(this.icon.width,innerWidth-4),t.style.height=Math.min(this.icon.height,innerHeight);const i=this.F=document.createElement("iframe");i.id="frame",i.style.visibility="hidden",i.src=e.src,t.appendChild(i),i.onload=(e=>{let t,n;e=this.m=e.target.contentWindow;try{t=e.document,n=this.icon.l?t.body.innerText:t.body.innerHTML,this.g=document.createElement("textarea"),this.g.id="codeDisplay",this.g.setAttribute("readOnly",1),this.g.value=n,this.shadowRoot.appendChild(this.g)}catch(e){}t&&(e.OS13k=M,e.zzfx=C,e.OS13kStart&&e.OS13kStart()),t&&this.icon.l&&(t.body.innerHTML="<canvas id=c width=1920 height=1080 style=width:100%;background:#"+(this.icon.o?"fff":"000")+">",t.body.style="background:#111;overflow:hidden;margin:0;display:flex;align-items:center",this.icon.o&&e.eval("u=t=>{"+n+"};x=c.getContext`2d`;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&u((60*(frame++/60)-frame-1|0?frame-1:frame)/60));loop(frame=0)"),this.icon.isShader&&e.eval('g=c.getContext`webgl2`;x=y=z=w=0;onmousemove=e=>e.buttons&&(x=e.x,y=c.height-e.y);onmousedown=e=>(x=z=e.x,y=w=c.height-e.y);onmouseup=e=>z=w=0;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&(c.width=innerWidth,c.height=innerHeight,g.uniform4f(g.getUniformLocation(s,"iMouse"),x,y,z,w),OS13k.RenderShader(c,s,t/1e3)));loop(s=OS13k.CreateShader(c,`'+n+"`))")),i.style.visibility="",this.a()})}v(t,i){"name"==i.id&&(e=this),this.a()}c(e){"full"==e.id&&this.s(),"code"==e.id&&(this.a(),this.g.style.display=(this.H=!this.H)?"block":""),"reload"==e.id&&(this.F.style.visibility="hidden",this.m.location.reload()),"close"==e.id&&this.i(),"codeDisplay"!=e.id&&this.a()}a(e){g(),this.m&&this.m.focus(),this.b(),e&&(e=this.getBoundingClientRect(),this.style.left=M.Clamp(e.x,0,innerWidth-e.width),this.style.top=M.Clamp(e.y,42,Math.max(42,innerHeight-e.height)))}b(e=1){e&&(n!=this&&(n&&n.b(0),this.style.zIndex=++d,buttonShowCode.style.display=this.icon.code?"":"none",buttonReload.style.display=this.icon.reload?"":"none"),g()),n=e&&this,this.style.filter=e?"":"saturate(.7)brightness(.7",this.h.className="titlebar"+(e?" titlebarActive":""),this.C.b()}s(){this.a();const e=this.u;e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()}i(){this.icon.window=0,this.C.remove(),this.remove();{let e;for(const t of desktop.children)"os13k-window"==t.localName&&(!e||e.style.zIndex<t.style.zIndex)&&(e=t);e&&e.a()}}}customElements.define("os13k-window",S),onmousedown=(n=>{if(document.activeElement.blur(),e)return onclick(n);if("button"!=n.target.localName){if("menu"!=n.target.offsetParent.id&&(menu.style.visibility=""),"folder"!=n.target.offsetParent.className&&n.target!=a&&g(),n.button)return 2==n.button;var o=n.originalTarget||n.path[0];n.target.v&&n.target.v(n,o),e&&(document.body.style.cursor=e.f.style.cursor="grabbing",e.u.style.pointerEvents="none",o=n.target.getBoundingClientRect(),t=n.x-o.x,i=n.y-o.y)}}),onmousemove=(n=>{e&&(e.style.left=n.x-t,e.style.top=n.y-i),o&&(o.className="icon"),n.target.w&&n.target.w()}),onclick=(t=>{document.body.style.cursor="",e&&(e.f.style.cursor="grab",e.u.style.pointerEvents=""),e=0,menu.style.visibility="";const i=t.originalTarget||t.path[0];t.target!=a&&"os13k-icon"!=t.target.localName&&n&&"codeDisplay"!=i.id&&n.a(),t.target.c&&t.target.c(i)}),oncontextmenu=(e=>{menu.style.visibility="";let t=menu;return e.target.b&&e.target!=a||(t=programsFolder,a.c()),e.target.element?e.target.element.b&&e.target.element.b():e.target.b&&e.target.b(),t.style.left=e.x,t.style.top=e.y,t.style.visibility="visible",!1}),ondblclick=(e=>{const t=e.target.element||e.target;("name"==(e.originalTarget||e.path[0]).id||e.target.element)&&t.s&&t.s()});const T=new(AudioContext||webkitAudioContext);T.D=T.createBufferSource,T.createBufferSource=((e=T.D())=>(e.start=e.start||e.noteOn,e.stop=e.stop||e.noteOff,e));const x=T.createGain();x.connect(T.destination),y(x.gain.value=0);const C=(e=1,t=.05,i=220,n=0,o=0,s=.1,r=0,a=1,l=0,h=0,d=0,c=0,m=0,u=0,p=0,g=0,y=0,f=2*Math.PI,v=44100,w=(e=>2*e*Math.random()-e),b=(e=>0<e?1:-1),S=(l*=500*f/v**2),T=(i*=(1+w(t))*f/v),x=b(p)*f/4,C=[],E=0,R=0,L=0,k=1,H=0,A=0,N=0,F,P)=>{for(h*=500*f/v**3,P=(n=99+n*v|0)+(o=o*v|0)+(s=s*v|0)+(y=y*v|0),p*=f/v,d*=f/v,c*=v,m*=v;L<P;C[L++]=N)++A>100*g&&(A=0,N=E*i*Math.sin(R*p-x),N=b(N=r?1<r?2<r?3<r?Math.sin((N%f)**3):Math.max(Math.min(Math.tan(N),1),-1):1-(2*N/f%2+2)%2:1-4*Math.abs(Math.round(N/f)-N/f):Math.sin(N))*Math.abs(N)**a,N*=e*(L<n?L/n:L<n+o?1:L<P-y?1-(L-n-o)/s:0),N=y?N/2+(y>L?0:(L<P-y?1:(L-P)/y)*C[L-y]/2):N),E+=1+w(u),R+=1+w(u),i+=l+=h,k&&++k>c&&(i+=d,T+=d,k=0),m&&++H>m&&(i=T,l=S,H=1,k=k||1);return M.PlaySamples(C)},M=new class{Trophy(e,t="",i="",n=""){if(e){var o=e+","+t+","+i,s=u.findIndex(e=>e[0]==o);0>s?u.push([o,n]):u[s]=[o,n],localStorage["OS13kTrophy,"+o]=n,localStorage.A=JSON.stringify(u),i=this.StripHTML(i),t=this.StripHTML(t),e=this.StripHTML(e),n=this.StripHTML(n),t||(t=e,e=""),i=i.length?[...i][0]:"🏆",(s=document.createElement("div")).className="trophyPopup",s.innerHTML='<div class=flexCenter><div style="font-size:50;padding:9;text-shadow:3px 3px 8px #000">'+i+"</div><div style=width:100%;overflow:hidden><b>"+t+"</b><br><i>"+e+"</i></div></div><div style=font-size:20;padding:8>"+n,s.style.top=innerHeight,trophyPopups.appendChild(s),h.window&&h.window.m.OS13kStart()}}GetTrophies(){return u}KeyDirection(e){let t=0,i=0;return 87!=e&&38!=e||++i,83!=e&&40!=e||--i,68!=e&&39!=e||++t,65!=e&&37!=e||--t,{x:t,y:i}}PlaySeed(e,t=1,i=1,n=.05){const o=()=>this.Random();this.randomSeed=e,t/=2,e=o()**3*t;const s=o()**3*t,r=e+s+(t*=o()**3);return C(...[i,n,2e3*o()**2,e,s,t,5*o()|0,3*o()**2,(.5>o())*o()**3*99*(.5>o()?1:-1),(.5>o())*o()**3*99*(.5>o()?1:-1),(.5>o())*o()**2*1e3*(.5>o()?1:-1),o()**2*r,(.5>o())*o()*r,(.5>o())*o()**4,(.5>o())*o()**3*9*(.5>o()?1:-1),(.5>o())*o()**4,(.5>o())*o()**3/2])}PlaySamples(e,t=44100){t=T.createBuffer(1,e.length,t);const i=T.createBufferSource();return t.getChannelData(0).set(e),i.buffer=t,i.connect(x),i.start(),i}GetNote(e=440,t){return e*2**(t/12)}Speak(e){speechSynthesis.speak(new SpeechSynthesisUtterance(e))}CreateShader(e,t){const i=(e=e.getContext("webgl2")).createShader(e.VERTEX_SHADER);e.shaderSource(i,"#version 300 es\nin vec4 p;void main(){gl_Position=p;}"),e.compileShader(i);var n=e.ARRAY_BUFFER;if(e.bindBuffer(n,e.createBuffer()),e.bufferData(n,new Int8Array([-3,1,1,-3,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.BYTE,0,0,0),n=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(n,"#version 300 es\nprecision mediump float;uniform float iTime;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;out vec4 outColor;\n"+t+"\nvoid main(){mainImage(outColor,gl_FragCoord.xy);outColor.a=1.;}"),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw e.getShaderInfoLog(n);return e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),t=e.createProgram(),e.attachShader(t,i),e.attachShader(t,n),e.linkProgram(t),e.useProgram(t),t}RenderShader(e,t,i=0){const n=e.getContext("webgl2");n.uniform3f(n.getUniformLocation(t,"iResolution"),e.width,e.height,1),n.uniform1f(n.getUniformLocation(t,"iTime"),i),n.uniform1i(n.getUniformLocation(t,"iChannel0"),0),n.viewport(0,0,e.width,e.height),n.drawArrays(n.TRIANGLE_FAN,0,3),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)}StripHTML(e){return e.replace(/(<([^>]+)>)/gi,"")}Clamp(e,t=0,i=1){return Math.min(Math.max(e,t),i)}Percent(e,t,i){return i-t?this.Clamp((e-t)/(i-t),0,1):0}Lerp(e,t,i){return t+this.Clamp(e,0,1)*(i-t)}Random(e=1,t=0){return this.randomSeed^=(this.randomSeed||-1)<<13,this.randomSeed^=this.randomSeed>>17,this.randomSeed^=this.randomSeed<<5,this.Percent(Math.abs(this.randomSeed)%1e9/1e9,t,e)}};(()=>{trayTrophy.onmousedown=f,trayVolume.onmousedown=y,a=new v({icon:"💾",name:"Apps"},new w(programs,0,0)),l&&l.c(),u=localStorage.A?JSON.parse(localStorage.A):[];for(let t=localStorage.length;t--;){var e=localStorage.key(t);const i=e.split(",");if("OS13kTrophy"==i.shift()){const t=u.findIndex(e=>e[0]==i.join());e=localStorage[e],(0>t||u[t][1]!=e)&&M.Trophy(...i,e)}}})(),p()</script>