<template name=Help>
<h2><i>Welcome to OS13k!</i></h2>
<p>OS13k is a tiny operating system designed for JS13k.</p>
<p>It has native support for ZzFX, music, trophies, and dweets. Check the GitHub for more info.</p>
<p>‚úåÔ∏èüòÑ ‚ù§Ô∏è OS13k Team
</template>

<template name=Settings>
<style>body{background:#111;color:#fff;user-select:none;text-align:center}</style>
Volume <input type=range id=V oninput=s() style=width:99>&nbsp;&nbsp;
Music <input type=range id=M oninput=s() style=width:99><br><br>
System Sounds <input type=checkbox id=Y oninput=s()>&nbsp;&nbsp;
Speech <input type=checkbox id=S oninput=s()>&nbsp;&nbsp;
Popups <input type=checkbox id=P oninput=s()>
<br><br>Background
<input id=C type=color oninput=s()>&nbsp;&nbsp;
<input id=D type=color oninput=s()>&nbsp;&nbsp;
<input id=T oninput=s()><br><br>Filters
<span id=F><script>s=e=>parent.OS13k.SaveSettings(V.value/100,M.value/100,S.checked,P.checked,Y.checked,D.value,C.value,T.value,t,F.innerHTML="",[["Default",""],["Gray","grayscale("],["Game Boy","sepia()hue-rotate(40deg)contrast(.8)brightness(.8"],["Ocean","invert()sepia()invert("],["Sepia","sepia("],["Fruity","saturate(9"]].map(e=>F.innerHTML+=`<button style='border:5px solid${e[1]==t?"#f00":"#111"}'onmousedown=s(t='${e[1]}')>`+e[0])),s(i=parent.OS13k.Settings(),V.value=100*i.v,M.value=100*i.m,S.checked=i.s,P.checked=i.p,Y.checked=i.o,C.value=i.d,D.value=i.c,T.value=i.t,t=i.f)</script>
</template>

<template name="Trophy Case">
<style>body{background:#232}</style>&nbsp;<script>OS13kReload=()=>{for(t of(this.document.body.innerHTML="",parent.OS13k.Trophies()))this.document.body.innerHTML+=`<div style='display:inline-block;font-family:arial;padding:9;overflow:hidden;text-align:center;background:linear-gradient(#eee,#888);width:120;height:120;margin:9;font-size:18;box-shadow:5px 5px 9px;border:2px solid;border-radius:29px'title='${i=t[0]||"üèÜ"} ${n=t[2]}\n${g=t[1]}\n${m=t[3]}'onmousedown='parent.OS13k.Speak(\`${n}\`,1,1,1,"ja",1)'><div style='padding:3;white-space:nowrap;font-size:28;text-shadow:2px 2px 4px'>${i}</div><div><b>${n}</b><br><i>${g}</i><br><div style=font-size:14>${m}</div></div></div>`},OS13kReload()</script>
</template>

<template name="Sticky Note">
<style>*{background:#ff8;font-family:cursive;font-size:23}</style>&nbsp;<script>b=document.body;b.setAttribute("contenteditable",true);b.spellcheck=false;b.innerHTML=localStorage.OS13kN||'';b.oninput=e=>localStorage.OS13kN=b.innerHTML;OS13kReload=e=>b.innerHTML=localStorage.OS13kN='';b.focus();</script>
</template>

<template name=Clock>
D=Date(L=(t,e,l,o=-6)=>x.fillRect(-e/2,o,e,l,x.rotate(-a+(a=Math.PI*(2*t-1)))));if(c.title!=D){document.hasFocus()&&OS13k.PlaySeed(6,.1,1,.01);c.title=D;c.style.background='#111';c.width=198;x.translate(99,99);D=D.slice(16,24).split`:`;for(a=i=0;61>i++;L(i/60,2,i%5?3:8,88))x.fillStyle='#fff';L(D[0]%12/12+D[1]/720,6,59);L(D[1]/60,3,85);x.fillStyle='#f00';L(D[2]/60,2,99)}
</template>

<template name=Timer>
<style>body{background:#111;color:#fff;user-select:none;text-align:center}*{font-size:28}input{margin:9}</style><input type=number style=width:79;text-align:right min=0 value=2 id=M>m<input type=number style=width:79;text-align:right min=0 value=0 id=S>s<br><input id=N style=width:199 placeholder=Reminder><button id=A onmousedown=setInterval(U,1e3,A.disabled=M.disabled=S.disabled=P=1) style=width:99>Start</button><script>U=a=>{(t=Math.max(0,60*M.value+1*S.value-1))||(zzfx(...[2,.8,999,,,,1,2,,,,,1,,,.1,.2]),--P%10||(parent.document.hasFocus()||!P)&&OS13k.Popup("<div style=font-size:40>‚åõ</div><b>"+OS13k.StripHTML(N.value),N.value)),M.value=t/60|0,S.value=t%60|0}</script>
</template>

<template name=Camera>
<video style=width:100%;height:100% id=V autoplay src onerror="navigator.mediaDevices.getUserMedia({audio:1,video:{width:R=640,height:480}}).then(s=>S=V.srcObject=s)"muted></video><a id=A download style=display:none><canvas id=c  width=640 height=480></a><div style=position:absolute;top:3;left:3><button onclick=A.click(c.getContext`2d`.drawImage(V,0,0),A.href=c.toDataURL`image/jpeg`)>üì∑</button><button onclick="this.innerHTML=(R=!R)?(M.stop(),A.click(A.href=window.URL.createObjectURL(new Blob(B,X))),'üé•'):(B=[],M=new MediaRecorder(S,X={type:'video/webm'}),M.ondataavailable=e=>B.push(e.data),M.start(9),'üõë')">üé•
<script>document.body.style.margin=0</script>
</template>

<template name=Console>
<iframe style=display:none id=F></iframe><input style=width:100% id=I placeholder="Enter JS Code" onkeydown="if(event.keyCode==13){try{o=F.contentWindow.eval(I.value)}catch(e){o=e}O.innerText=`JS> ${I.value}\n${o}\n\n`+O.innerText;I.value=''}" autocomplete=off><p id=O>
<script>document.body.style='background:#000;font-family:monospace;color:#fff;white-space:nowrap';I.focus();F.contentWindow.OS13k=parent.OS13k;F.contentWindow.zzfx=parent.zzfx</script>
</template>

<template name="Music Player">
<style>body{background:#111;color:#fff;user-select:none;text-align:center;overflow-x:hidden;white-space:nowrap}</style><div id=N style=font-size:27;font-family:arial>&nbsp;</div><div id=F style=height:9></div><br><button onmousedown=P()>Play</button>
<button onmousedown=X&&X.stop(X=0)>Stop</button>
<button onmousedown=A()>Load</button>
<button onmousedown=R()>Delete</button><br><br>Volume <input type=range id=V>
Loop <input type=checkbox id=O><br><canvas id=C style=width:350;height:29;image-rendering:-moz-crisp-edges;image-rendering:pixelated></canvas><br><select id=S size=9 style=width:350;background:#000;color:#fff><script>OS13k=parent.OS13k,X=E=T=0,Q=-1,U=e=>{Q<0||(l=L[Q],T=0,Q=-1,(X=OS13k.PlayMusic(l.d))||alert`‚ö†Ô∏è Error!`),C.getContext`2d`.drawImage(OS13k.GetAnalyser(),0,0,C.width=32,C.height=32),F.innerText=X?(X.gain.gain.value=V.value/100,d=X.buffer.duration,T+=.05,X.loop=O.checked?T%=d:T>d&&X.stop(X=0),W(T)+"/"+W(d)):(N.innerText="OS13k Music Player","")},B=e=>{for(e in i=S.selectedIndex,S.innerHTML="",Z=0,L=[],localStorage)I(e);L.sort((e,n)=>e.n.localeCompare(n.n)).map(e=>S.innerHTML+=`<option>${e.n}</option>`),S.selectedIndex=OS13k.Clamp(E?L.findIndex(e=>e.k==E):i,S.length-1,E=0),localStorage.OS13kM=JSON.stringify(K)},I=e=>{if(p=e.split`,`,f=p.shift(),"OS13kMusic"==f.substring(0,10)){n=p[0]?p[0]:"Untitled","U"==f.substring(10,11)?Z=Math.max(Z,f.substring(11)):K.indexOf(e)<0&&(OS13k.Popup("üéµ New Music<br><b>"+n,n),K.push(e));try{(d=J(localStorage[e]))&&L.push({d:d,k:e,n:n})}catch(e){console.log(e)}}},P=e=>{X&&X.stop(X=0),(Q=S.selectedIndex)<0||(N.innerText=L[Q].n,F.innerText="Loading...")},A=e=>{try{parent.zzfxM(...J(d=prompt`ZzFXM Data`)),B(localStorage[E=`OS13kMusicU${Z+1},`+prompt`Name`.replace(/,/g,"")]=d)}catch(e){alert`‚ö†Ô∏è Error!`,console.log(e)}},R=e=>confirm(`‚ö†Ô∏è Delete ${L[S.selectedIndex].n}?`)&&B(localStorage[L[S.selectedIndex].k]=0),J=k=>k.replace(/null|[[\],\d\.-]/g,"")||eval(k.replace(/null/g,void 0)),W=e=>(e/60|0)+((e=e%60|0)<=9?":0":":")+e,localStorage["OS13kMusic,OS13k Test"]=JSON.stringify([[[,0,219,,,,,1.1,,-.1,-50,-.05,-.01,1],[2,0,84,,,.1,,.7,,,,.5,,6.7,1,.05]],[[[0,-1,1,0,5.5,0],[1,1,8,8.3,3,0]]],[0,0,0,0],4]),K=localStorage.OS13kM?JSON.parse(localStorage.OS13kM):[],B(onunload=e=>X&&X.stop()),setInterval(U,50)</script>
</template>

<template name=Visualizer>
for(x.fillRect(0,0,2e3,2e3),x.fillStyle="#0003",t?x.lineWidth=9:h=[],x.strokeStyle="#fff",i=32;i--;x.beginPath(x.strokeStyle=`hsl(${-99-9*i} 99%${9+m/2}%)`,x.stroke()))for(m=199*OS13k.GetAnalyserData(i),j=5;j--;)x.arc(960,540,256+(j+1&2?1:-1)*m,a=2*((2&j)/2-8.5+i)*Math.PI/32,a);x.drawImage(c,-40,-20,2e3,1120)
</template>

<meta charset=utf-8><style>body{opacity:0;margin:0;overflow:hidden;font-family:arial;font-size:22;user-select:none;white-space:nowrap;background:#000}#menu{display:flex;flex-direction:column;background:#000}.programMenu{background:linear-gradient(#fff,#888)}#menu,.programMenu{visibility:hidden;position:absolute;z-index:20000;box-shadow:5px 5px 9px;border:2px solid}.program{font-size:18;height:18;padding:4}.activeWindow{border:3px solid#aaa}#taskbar{position:absolute;z-index:10000;width:100%;background:linear-gradient(#888,#333);box-shadow:0px 1px 9px;border:2px solid;left:-2}.taskbarIcon{width:50;height:40;text-shadow:1px 1px 3px#000;overflow:hidden}.programActive,.taskbarIconActive{background:linear-gradient(#ff8,#fff)}.taskbarIcon:hover{background:linear-gradient(#fff,#44f)}#tray{margin:2;padding-left:9;padding-right:9;color:#fff;background:linear-gradient(#000,#333);border:1px solid;border-radius:6px;text-shadow:1px 1px 3px#000}.trayIcon{padding:2}.trayIcon:hover{background:#fff3}.popup{position:relative;z-index:10000;width:200;padding:8;pointer-events:none;white-space:normal;text-align:center;background:linear-gradient(#eee,#888);box-shadow:9px 9px 19px;border:2px solid;border-radius:9px}.trophyIcon{padding:9;font-size:40;text-shadow:2px 2px 4px;white-space:nowrap}#background{position:absolute;width:100%;height:100%;color:#0002;font-family:impact;font-size:30vw;font-weight:900;position:absolute}.program,#taskbar,.taskbarIcon,#background,#tray{display:flex;align-items:center;justify-content:center}</style><template id=T><style>:host{visibility:hidden;position:absolute;background:#000;box-shadow:5px 5px 9px;border:3px solid#222;border-radius:6px;overflow:hidden}input,button,span{margin:4}textarea{padding:9}span{white-space:nowrap}.titlebar{height:34;font-size:24;display:flex;align-items:center;white-space:nowrap;background:linear-gradient(#ccc,#444);border-bottom:3px solid}.titlebarActive{background:linear-gradient(#eee,#88f)}.titlebarActiveUser{background:linear-gradient(#eee,#8f8)}.titlebarActiveSticky{background:linear-gradient(#eee,#f88)}.titlebarSticky{background:linear-gradient(#ccc,#844)}#name{width:100%;overflow:hidden;cursor:grab}#icon{display:inline;text-shadow:1px 1px 3px#000;margin-left:9;margin-right:9;pointer-events:none}#frame{width:100%;height:100%;background:#fff;border:none;visibility:hidden}#codeDisplay{display:none}#codeText{height:199;background:#000;color:#fff}#errorText{background:#000;color:#f00}#codeOptions{background:#111;color:#fff;font-size:16;overflow:auto}#codeText,#errorText,#codeOptions{width:100%;resize:none;outline:0;border-top:2px solid}</style></template><div id=background></div><div id=desktop><div id=taskbar><div id=taskbarSpace style=flex:1></div><div id=tray></div></div><div id=popups style=float:right></div><div id=programsMenu style=position:absolute></div><div id=menu> <button id=buttonFullScreen>Full Screen <button id=buttonCode>Code <button id=buttonHelp>Help <button id=buttonResetSize>Reset Size <button id=buttonReload>Reload <button id=buttonClose>Close<script>

"use strict";const ba=[[,"‚ùå",,,128,"Close All"],[,"<b><span style=color:#0f0>?",380,300,1,"Help","Check here to see help when available.\nSome programs have a option to show code instead.\n\nHave fun! ‚úåÔ∏èüòÑ"],[,"‚öôÔ∏è",,,,"System",,[[,"üèÜ",,,25,"Trophy Case"],[,"‚úèÔ∏è",300,263,3,"Sticky Note","Ctrl+B - Bold\nCtrl+I - Italic\nCtrl+U - Underline\nReload to clear"],["dweet","üï∞Ô∏è",198,198,37,"Clock"],[,"üéöÔ∏è",470,190,1,"Settings"]]],[,"üõ†Ô∏è",,,,"Apps",,[[,"üéµ",400,330,1,"Music Player"],["dweet","üëÅÔ∏è",,,60,"Visualizer"],[,"‚åõ",400,139,3,"Timer"],[,"üì∏",640,480,,"Camera"],[,"<span style=color:#0f0;background:#000;font-family:monospace>JS>",,,,"Console"]]]];function ca(e,i,n=44100){const s=t.createBuffer(e.length,e[0].length,n);return n=t.createBufferSource(),e.map((e,t)=>s.getChannelData(t).set(e)),n.buffer=s,n.connect(n.gain=t.createGain()).connect(i?da:v),i&&(1<i?n.gain:n).connect(ea),n.start(),n}class fa{Clamp(e,t=1,i=0){return e<i?i:e>t?t:e}Percent(e,t,i){return i-t?this.Clamp((e-t)/(i-t)):0}Lerp(e,t,i){return t+this.Clamp(e)*(i-t)}Hash(e){return[...e].reduce((e,t)=>t.charCodeAt()+31*e|0,0)}Random(e=1,t=0){return this.randomSeed^=this.randomSeed<<13||1,this.randomSeed^=this.randomSeed>>17,this.Lerp(Math.abs(this.randomSeed^=this.randomSeed<<5)%1e9/1e9,t,e)}Trophy(e,t,i,n){var s=e=>this.StripHTML(e||"",32).replace(/[,`]/g,"");e=s(e),t=s(t),i=s(i),n=s(n);const a=e+","+t+","+i;if(!(0<=(s=x.findIndex(e=>e[4]==a))&&x[s][3]==n)){var o=[e,t,i,n,a];0>s?x.unshift(o):x[s]=o,localStorage["OS13kTrophy,"+a]=n,i||(i=t,t=""),this.Popup(`<div class=trophyIcon>${e||"üèÜ"}</div><div><b>${i}</b><br><i>${t}</i></div>`+n,i+". "+t,"ja"),this.i(A.a.window&&B(A.a.window))}}GetTrophy(e,t){const i=x.find(i=>i[1]==e&i[2]==t);return i?i[3]:0}Trophies(){return x}PlaySeed(e,t=1,i=1,n=.05,s,a){return this.PlaySamples(this.SeedSamples(...arguments),a)}SeedSamples(e,t=1,i=1,n=.05,s){return zzfxG(...this.SeedParameters(...arguments))}SeedParameters(e,t=1,i=1,n=.05,s){if(parseFloat(e=(e+"").trim())!=e){if("zzfx(...["==e.slice(0,9))return e.slice(9).split(",").map((e,t)=>t?1==t?n:2==t&&s?s:e.length?parseFloat(e):void 0:i);e=this.Hash(e)}this.randomSeed=e;const a=(e=(()=>this.Random()))()**3/4*t,o=e()**3/4*t,r=e()**3/4*t,h=a+o+r+(t*=e()**3/4),l=2e3*e()**2;return[i,n,s||l,a,r,t,5*e()|0,3*e()**2,(.5>e()?e():0)**3*(.5>e()&&e()?99:-99),(.5>e()?e():0)**3*(.5>e()&&e()?99:-99),(.5>e()?e():0)**2*(.5>e()&&e()?1e3:-1e3),e()**2*h,(.5>e()?e():0)*h,(.5>e()?e():0)**4,(.5>e()?e():0)**3*(.5>e()&&e()?9:-9),(.5>e()?e():0)**4,(.5>e()?e():0)**3/2,1-(.5>e()?e():0),o]}PlaySamples(e,t,i=44100){return ca([e],t,i)}PlayMusic(e){try{return ca(ha(...e),1)}catch(e){console.log(e)}}GetAnalyser(){return D}GetAnalyserData(e){return ia[e]?ia[e]:0}Note(e=0,t=440,i=12){return t*2**(e/i)}Speak(e,t=1,i=1,n=1,s="en",a){(e=new SpeechSynthesisUtterance(e)).volume=n*v.gain.value*3,e.pitch=i,e.rate=t,e.lang=s,a&&speechSynthesis&&speechSynthesis.cancel(),settings.s&F&&speechSynthesis&&speechSynthesis.speak(e)}CreateShader(e,t){if(e=e.getContext("webgl2")){var i=e.createShader(35633);e.shaderSource(i,"#version 300 es\nin vec4 c;void main(){gl_Position=c;}"),e.compileShader(i);var n=e.createShader(35632);if(e.shaderSource(n,"#version 300 es\nprecision mediump float;uniform float iTime;uniform int iFrame;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;out vec4 OS13kcolor;\n"+`${t}`+"\nvoid main(){mainImage(OS13kcolor,gl_FragCoord.xy);OS13kcolor.a=1.;}"),e.compileShader(n),!e.getShaderParameter(n,35713))throw e.getShaderInfoLog(n);return e.bindBuffer(34962,e.createBuffer()),e.bufferData(34962,new Int8Array([-3,1,1,-3,1,1]),35044),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,5120,0,0,0),e.bindTexture(3553,e.createTexture()),e.texParameteri(3553,10241,9729),e.pixelStorei(37440,1),t=e.createProgram(),e.attachShader(t,i),e.attachShader(t,n),e.linkProgram(t),e.useProgram(t),t}}RenderShader(e,t,i,n,s,a,o,r){const h=e.getContext("webgl2");h&&(h.uniform3f(h.getUniformLocation(t,"iResolution"),e.width,e.height,1),h.uniform1f(h.getUniformLocation(t,"iTime"),i),h.uniform1f(h.getUniformLocation(t,"iFrame"),n),h.uniform1i(h.getUniformLocation(t,"iChannel0"),0),h.uniform4f(h.getUniformLocation(t,"iMouse"),s,a,o,r),h.viewport(0,0,e.width,e.height),h.drawArrays(6,0,3),h.texImage2D(3553,0,6408,6408,5121,e))}StripHTML(e,t){return(e+"").substring(0,t||e.length).replace(/<.*>/g,"")}Popup(e,t,i){const n=popups.appendChild(document.createElement("div"));n.className="popup",n.innerHTML=e,n.speak=t,n.ba=i,n.style.visibility="hidden"}Input(e){let t;e.document.OS13kInput&&((t={...e.document.OS13kInput}).x=t.y=0,t.keydown[87]|t.keydown[38]&&++t.y,t.keydown[83]|t.keydown[40]&&--t.y,t.keydown[68]|t.keydown[39]&&++t.x,t.keydown[65]|t.keydown[37]&&--t.x);const i=e.document.OS13kInput={x:0,y:0,keypress:[],mousepress:[],keydown:e.document.OS13kInput?e.document.OS13kInput.keydown:[],mousedown:e.document.OS13kInput?e.document.OS13kInput.mousedown:[],mousex:e.document.OS13kInput?e.document.OS13kInput.mousex:0,mousey:e.document.OS13kInput?e.document.OS13kInput.mousey:0,ca:0};return e.onkeydown=(e=>e.repeat||(i.keydown[e.keyCode]=i.keypress[e.keyCode]=1)),e.onkeyup=(e=>i.keydown[e.keyCode]=0),e.onmousedown=(e=>(i.mousedown[e.button]=i.mousepress[e.button]=1,1!=e.button)),e.onmouseup=(e=>i.mousedown[e.button]=0),e.onmousemove=(e=>(i.mousex=e.x,i.mousey=e.y)),e.onblur=(()=>(i.keydown=[],i.mousedown=[])),e.onwheel=(e=>i.ca=e.deltaY),t||i}i(){F&&(localStorage.OS13k=JSON.stringify([x,settings,G,I,ja])),v.gain.value=settings.v,da.gain.value=settings.m,settings.s&&settings.v||speechSynthesis&&speechSynthesis.cancel(),background.style.background=`linear-gradient(${settings.c},${settings.d})`,background.innerText=settings.t,background.style.filter=desktop.style.filter=settings.f}SaveSettings(e,t,i,n,s,a,o,r,h){this.i(settings={v:v.gain.value=e,m:da.gain.value=t,s:i,p:n,o:s,c:a,d:o,t:r,f:h})}Settings(){return settings}}var OS13k=new fa;const t=new AudioContext,v=t.createGain(),da=t.createGain(),ea=t.createAnalyser(),K=()=>{const e=[],t=i=>i.map(i=>i[7]?t(i[7]):e.push(i));t(ba),J&&J.F.lastChild&&(J.F.removeChild(J.F.lastChild),ba.pop()),ka(ba,[,"üòÄ",,,,"User Programs"],"",e),la(J.F)},ka=(e,t,i,n)=>{const s=[[,"üìå",,,256,"New User Program",,,,i],[,"‚ö†Ô∏è",,,512,i?`Delete User Folder ${i}`:"Delete User Programs",,,,i]],a=[];i||G.map(e=>null!=e.code&&e.g&&!a.includes(e.g)&&ka(s,[,"üìÅ",,,,e.g],e.g,n,a.push(e.g))),G.map(e=>null!=e.code&&e.g==i&&s.push(n.find(t=>t[8]==e.id)||[,e.icon,e.width,e.height,58,e.name,,,e.id,e.g])),t[7]=s,e.push(t)},ma=e=>{requestAnimationFrame(ma),L|F||OS13k.i(na.prepend(D=document.createElement("canvas")),D.style="width:16;height:16;margin:2;pointer-events:none;display:none",self==top&&M&&M.u(M=0),F=1);var t=document.activeElement,i=t.shadowRoot&&t.shadowRoot.activeElement==t.A?t.A:0;if(i&&oa!=i&&t.b(pa=1),oa=i,document.body.style.opacity=OS13k.Clamp(.02*!L+1*document.body.style.opacity),A.innerHTML=x.length+"üèÜ",P.title=Date(),P.innerHTML=P.title.replace(/.* (\d+):(\d+).*/,(e,t,i)=>(t%12||12)+":"+i),!(!F|!pa)){t=new Uint8Array(ea.fftSize=512),i=D.getContext("2d"),ea.getByteFrequencyData(t),D.width=D.height=32;for(let n=0;32>n;){const s=(t[n+3]/255)**3*(1+Math.log10(44100*(n+3)/1024));i.fillStyle=`hsl(${-99-59*s} 99%50%)`,i.fillRect(n,31,1,-7*s),ia[n++]=OS13k.Clamp(s/5),qa=s?e:qa}D.style.display=1e4>e-qa?"":"none";var n=0;[...popups.children].map((e,t)=>{if(e.speak&&OS13k.Speak(e.speak,1,1,1,e.ba),e.speak=0,settings.p){if(!document.fullscreenElement){let i=e.style.visibility?innerHeight:parseInt(e.style.top)+n-9;e.style.visibility="",44>i&&(i=44,!t&&0>(e.style.opacity=(e.style.opacity||3)-.01)&&(n+=e.getBoundingClientRect().height,popups.removeChild(e))),e.style.top=i}}else popups.removeChild(e)})}},sa=()=>{[...programsMenu.children].map(e=>e.style.visibility=menu.style.visibility=""),ra&&(ra.className="program")},ta=(e,t=(e?e.split(","):[]))=>"OS13kTrophy"==t.shift()&&(t.length=3,OS13k.Trophy(...t,localStorage[e])),Q=(e,t)=>F&pa&settings.o&&OS13k.PlaySeed(e,t);let R,ua,va,F,S,ra,wa,J,U,D,oa,M,I,A,ya,P,na,za,ja=0,ia=[],qa=-1e4,xa=0,L=0,pa=0,V=9,W=53,G=[],x=[],settings={v:.3,m:.3,s:1,p:1,o:1,c:"#222233",d:"#332222",t:"OS13k",f:""};function la(e,t=0){for(const t of e.S){const i=t[-1]=t[-1]||new Aa(...t);i.D=i.N?new Ba(i.N,e):e}e.innerHTML="",programsMenu.appendChild(e),e.S.map(t=>e.appendChild(t[-1])),e.style.top=t,e.style.left=e.R?e.R.getBoundingClientRect().right-2:programsMenu.style.left=0,e.S.map(i=>{i[-1].D!=e&&la(i[-1].D,t),t+=26})}function Ca(e,t,i){const n=(i=t?[,t.icon,t.width,t.height,58,t.name+"+",,,++ja,t.g]:[,"‚úã",,,58,,,,++ja,i])[-1]=new Aa(...i);return e.S.push(i),n.info.code=t?(n.info.scale=t.info.scale,V=t.info.x,W=t.info.y+37,t.info.code):"// Auto detects HTML, Dweet, or Shadertoy! You can drop files here too. ‚úåÔ∏èüòÑ\nfor(x.fillRect(0,0,i=s=2e3,s);i--;x.globalAlpha=.1)\nx.clearRect((S(i)*1e9-t*i/9)%s,i*9%s,i%9,i%9)",n.u(n.h=U=1),Da(n.window,1),n.window.j.focus(),K(n.D=e),n}class Ba extends HTMLElement{constructor(e,t){super(),this.className="programMenu",this.R=t,this.S=e}b(){sa(),this.R&&this.R.b(),this.style.visibility="visible"}}function Ea(e){const t=G.findIndex(t=>t.id==e.id);e.info=0>t?{}:G[t],e.h=null!=e.info.code}customElements.define("m-",Ba);class Aa extends HTMLElement{constructor(e="",t="üí†",i=720,n=405,s,a="",o="",r,h,l){super(),this.P="dweet"==e,this.isShader="shader"==e,this.className="program",this.src=e,this.width=i,this.height=n,this.N=r,this.id=h||a,this.g=l,this.G(t,a),this.code=!(this.O=o)&&(32&s||this.P|this.isShader&&null==s),this.flags=s=s||26,this.sticky=1&s,this.reload=2&s,this.V=4&s,this.W=8&s,this.resize=16&s,Ea(this),"Music Player"==a&&X(na,this),"Trophy Case"==a&&X(A,this),"Settings"==a&&X(ya,this),"Sticky Note"==a&&X(za,this),"Clock"==a&&X(P,this),"Help"==a&null==this.info.open&&(M=this),this.sticky?this.info.open&&this.u():this.id==I&&(M=this)}G(e,t){this.icon=e,this.innerHTML='<span style="pointer-events:none;width:45;text-shadow:1px 1px 3px#000;text-align:center;overflow:hidden">'+e,this.innerHTML+=`<div style=flex:1;padding-right:9;pointer-events:none>${this.name=OS13k.StripHTML(t)||"User Program "+this.id}</div>`+(this.N?"‚ñ∂":"")}U(){this.D.b(),this.className="program programActive",ra!=this&&Q(90,0),ra=this}u(){if(this.window)this.window.b(1,1);else if(256&this.flags)Ca(this.D,void 0,this.g);else if(512&this.flags&&confirm(this.name+"?"))[...desktop.children].map(e=>e.C&&(this.g?e.a.info.g==this.g:null!=e.a.info.code)&&e.C()),G=G.filter(e=>null==e.code||this.g&&e.g!=this.g),K(OS13k.i(Q(92,4)));else if(128&this.flags)[...desktop.children].map(e=>e.C&&e.C()),V=9,W=53,OS13k.Trophy("‚òï","OS13k","Coffee Is For Closers","Closed All");else if(!this.N||this.h){let e=this.info.x,t=this.info.y;e||(e=V,t=W,400<(V+=37)&&(V=W=9),300<(W+=37)&&(W=W=53)),this.window=new Fa(this,e,t),this.i()}}b(){this.u()}i(e=1){this.info={open:e,id:this.id,x:e|this.sticky?parseInt(this.window.style.left):0,y:parseInt(this.window.style.top),scale:e|this.sticky?this.window.scale:1,name:this.name,icon:this.icon,width:this.width,height:this.height,code:this.info.code,H:this.h?this.window.H.checked:1,J:this.window.J.checked,g:this.g},e=G.findIndex(e=>e.id==this.id),OS13k.i(0>e?G.push(this.info):G[e]=this.info)}}function B(e,t){e.a.h&&(e.a.info.code=e.j.value),e.a.i(),t||Q(85),e.l&&e.l.OS13kReload?e.l.OS13kReload():e.a.h?Ga(e,e.a.info.code):Ha(e,e.A.style.visibility="")}function Da(e,t){e.I.style.display=(e.aa=!e.aa)?"inline":"",t||Q(e.a.O?48:16)}function Ia(e,t,i){t=OS13k.Clamp(e.a.width*t,1920,170),e.style.left=parseInt(e.style.left)+parseInt(e.style.width)-t,e.style.width=t,e.B.style.height=e.a.height*(e.scale=t/e.a.width),e.a.i(),i&&Q(i)}function Ha(e){const t=()=>{n.h&&("<"!=n.info.code.trim()[0]?n.P=!(n.isShader=0<=n.info.code.search(/void\s+mainImage/)):n.P=n.isShader=0);var t=n.P|n.isShader;const a=!e.a.h|U;e.Y.disabled=!t|!a,n.h&&(i.onerror=((t,i,n,s,a)=>Na(e,a,a.stack&&[s,n])));const o=i.document,r=n.h?n.info.code:n.O||(t?o.body.innerText:o.body.innerHTML);n.h||(e.j.value=r),i.OS13k=OS13k,i.OS13kWindow=e,i.zzfx=Oa,i.zzfxG=zzfxG,a||(o.body.style.background="#111"),t&&a&&(Pa(e,`<style>canvas{width:100%;background:${n.isShader?"#000":"#fff"}}</style><canvas id=c width=1920 height=1080>`),o.body.style="background:#111;overflow:hidden;margin:0;display:flex;align-items:center",t=n.h&&!n.isShader?r.replace(/(for\s*\((?!\s+of\s+)(?!\s+in\s+)[^;]*;[^;]*;|while\s*\()\s*(\S)/g,(e,t,i)=>t&&i?t+'++OS13kL>1e5&&(e=>{throw"Timed out!"})()'+(")"==i?"":",")+i:e):r,onerror=((t,i,n,s,a)=>{throw Na(e,a,a.stack&&[s,n]),a}),i.eval("OS13k=parent.OS13k;x=c.getContext"+(n.isShader?`('webgl2'${n.h?",{preserveDrawingBuffer:true}":""});`+"X=Y=Z=W=0;onmousemove=e=>e.buttons&&(X=e.x,Y=c.height-e.y);onmousedown=e=>(X=Z=e.x,Y=W=c.height-e.y);onmouseup=e=>Z=W=0;"+`s=OS13k.CreateShader(c,\`${t}\`);`+"OS13kU=t=>OS13k.RenderShader(c,s,t/1e3,frame++,X,Y,Z,W,c.width=innerWidth,c.height=innerHeight)":"('2d');zzfx=parent.zzfx;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;"+`u=t=>{\n${t}\n};`+"OS13kU=t=>t>OS13kF-2&&u(((t=frame++/60)*60|0==frame-1)&&t>0?t+1e-6:t,OS13kL=0,OS13kF=Math.max(OS13kF+100/6,t))")+";(OS13kA=t=>(requestAnimationFrame(OS13kA),"+(n.V||0==n.info.H?"":"t<1e3|parent.document.activeElement==OS13kWindow&&")+"OS13kU(t)))(frame=OS13kF=0)")),a||(i.onmousedown=(t=>(B(e,U=1),onmousedown(t)))),i.ea=i.da=i.oncontextmenu=(()=>!1),e.K||(e.K=new Qa(n,e)).b(),e.style.visibility=e.A.style.visibility="visible",L=L&&--L,n.h&&(e.A.onload=(()=>s++&&B(e,1))),R&&onmouseup()};e.A&&e.B.removeChild(e.A),e.A=e.B.appendChild(document.createElement("iframe"));const i=e.l=e.A.contentWindow,n=e.a;let s=0;e.A.id="frame",n.h?(Na(e),e.j.onkeydown=(t=>!t.altKey||13==t.keyCode&&Ga(e,e.j.value)),e.j.oninput=(()=>e.J.checked&&Ga(e,e.j.value)),t(Pa(e,n.info.code))):t(Pa(e,document.getElementsByName(n.name)[0].innerHTML))}function Na(e,t,i){return e.M.value=t+(i?` (${i[1]-1+":"+i[0]})`:""),e.M.style.display=null!=t?"":"none",!0}function Pa(e,t){e.l.document.open(),e.l.onerror=((t,i,n,s,a)=>Na(e,a,a.stack&&[s,n])),!e.a.h|U&&e.l.document.write(t),e.l.document.close()}function Ga(e,t,i){i&&(e.j.value=t),e.a.info.code=t,e.$.innerHTML=t.length,e.a.i(),Ha(e,U=1)}function Ra(e){!e.a.h|U||B(e,U=1),Q(-9),e.l.focus(),e.B.webkitRequestFullScreen&&e.B.webkitRequestFullScreen(),e.B.mozRequestFullScreen&&e.B.mozRequestFullScreen()}customElements.define("p-",Aa);class Fa extends HTMLElement{constructor(e,t,i){super(),desktop.appendChild(this),this.a=e,this.style.left=t,this.style.top=i,this.X=1,this.Z=0,this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=T.innerHTML,this.L=this.shadowRoot.appendChild(document.createElement("div")),this.L.id="titlebar",t=((e,t,i,n="path")=>{this.L.innerHTML+=`<style>#${e.split(" ")[0]}:hover{background:#${i}</style>`+`<div id=${e.split(" ")[0]} title=${e}>`+`<svg viewBox='0 0 10 10'style=height:100%;width:28;pointer-events:none><${n} stroke=#000 fill=none ${t} />`}),e.resize&&t("Grow",'d="M2 5L8 5M5 8L5 2"',"0f0",t("Shrink",'d="M2 5L8 5"',"0ff")),e.W&&t("Full Screen","x=1 y=2 width=8 height=6","fff","rect"),e.O&&t("Help",'d="M5 8L8 2L2 2L5 8L8 2"',"0ff"),e.code&&t("Code",'d="M5 2L8 8L2 8L5 2L8 8"',"f0f"),e.reload&&t("Reload","cx=5 cy=5 r=3","ff0","circle"),t("Close",'d="M2 2L8 8M8 2L2 8"',"f00"),this.L.prepend(this.name=document.createElement("div")),this.name.id="name";const n=()=>{this.name.innerHTML=`<span id=icon>${e.icon}`,this.name.innerHTML+=e.name};n(),this.B=this.shadowRoot.appendChild(document.createElement("div")),this.B.style.background="#000",this.I=this.shadowRoot.appendChild(document.createElement("div")),this.I.id="codeDisplay",this.j=this.I.appendChild(document.createElement("textarea")),this.j.id="codeText",e.h?this.j.value=e.info.code:this.j.readOnly=1,this.j.spellcheck=0,this.T=this.I.appendChild(document.createElement("div")),this.T.id="codeOptions",this.T.style.display=e.h?"":"none",this.T.innerHTML="&nbsp;<button id=S>üì∑</button>Icon <input style=width:50 id=I> Name <input id=N> Folder <input id=F><br>&nbsp;Size <input style=width:50 type=number id=W>x<input style=width:50 type=number id=H>"+`Sleep <input type=checkbox id=P ${0!=e.info.H?"checked":""}>`+`Live Edit <input type=checkbox id=L ${0!=e.info.J?"checked":""}>`+"<button id=G>Save</button><button id=C>Copy</button><button id=D>Delete</button>"+`<span id=Z>${e.info.code&&e.info.code.length}</span> Bytes`+"<a id=A><canvas id=V style=display:none>";const s=this.shadowRoot.getElementById("I"),a=this.shadowRoot.getElementById("N"),o=this.shadowRoot.getElementById("F"),r=this.shadowRoot.getElementById("W"),h=this.shadowRoot.getElementById("H"),l=this.shadowRoot.getElementById("A"),d=this.shadowRoot.getElementById("V"),c=d.getContext("2d");this.M=this.I.appendChild(document.createElement("textarea")),this.M.id="errorText",this.M.readOnly=!0,this.shadowRoot.getElementById("C").onmousedown=(()=>Ca(e.D,e)),this.shadowRoot.getElementById("D").onmousedown=(()=>{this.C(),K(OS13k.i(G=G.filter(t=>t.id!=e.id)))}),this.shadowRoot.getElementById("G").onmousedown=(()=>l.click(Q(6),l.href=URL.createObjectURL(new Blob([this.j.value],{type:"text/plain"})),l.download="OS13k_File_"+e.name)),this.Y=this.shadowRoot.getElementById("S"),this.Y.onmousedown=(()=>{try{l.click(Q(6),c.fillRect(0,0,d.width=this.l.c.width,d.height=this.l.c.height,c.fillStyle="#fff"),c.drawImage(this.l.c,0,0),l.href=d.toDataURL("image/jpeg"),l.download="OS13k_Image_"+e.name)}catch(e){}}),this.$=this.shadowRoot.getElementById("Z"),this.J=this.shadowRoot.getElementById("L"),this.H=this.shadowRoot.getElementById("P"),s.value=e.icon,a.value=e.name,r.value=e.width,h.value=e.height,null!=e.g&&(o.value=e.g),s.oninput=a.oninput=this.J.oninput=(()=>e.i(n(this.K.G(e.G(OS13k.StripHTML(s.value),a.value))))),o.oninput=(()=>K(e.i(e.g=OS13k.StripHTML(o.value.trim())))),r.onchange=h.onchange=(()=>{e.width=r.value=OS13k.Clamp(r.value,720,99),e.height=h.value=OS13k.Clamp(h.value,2*e.width,99),Ia(this,1),this.b(1,1)}),this.H.oninput=(()=>B(this,1,e.i())),t=e.resize?Math.min(e.width*(e.info.scale||1),innerWidth-6):e.width,this.style.width=t,this.B.style.height=t*e.height/e.width,this.scale=t/e.width,OS13k.Speak(e.name),Ha(this,L+=!F)}u(e,t,i){"C"!=e.id&&this.b(),e==this.name?(R=this,Q(45),document.body.style.cursor="grabbing",desktop.style.pointerEvents="none",ua=t-parseInt(this.style.left),va=i-parseInt(this.style.top)):("Full"==e.id&&Ra(this),"Reload"==e.id&&B(this),"Close"==e.id&&this.C(),"Shrink"==e.id&&Ia(this,this.scale-.2,75),"Grow"==e.id&&Ia(this,this.scale+.2,61),"Help"==e.id|"Code"==e.id&&Da(this))}b(e=1,t){sa(),this.className=e?"activeWindow":"",this.L.className="titlebar titlebar"+(e?"Active":"")+(this.a.sticky?"Sticky":this.a.h?"User":""),this.B.style.filter=e||this.a.V?"":"saturate(.7)brightness(.7",e&&(e=this.getBoundingClientRect(),t&&(this.style.left=OS13k.Clamp(e.x,innerWidth-e.width,0,this.style.top=OS13k.Clamp(e.y,Math.max(44,innerHeight-e.height),44))),L||setTimeout(()=>document.activeElement!=this&&this.l&&this.l.focus(oa=this.A)),S!=this&&(S&&S.b(0),S=this,Q(this.Z++?66:-8),this.style.zIndex=++xa,buttonFullScreen.style.display=this.a.W?"":"none",buttonCode.style.display=this.a.code?"":"none",buttonHelp.style.display=this.a.O?"":"none",buttonReload.style.display=this.a.reload?"":"none",buttonResetSize.style.display=this.a.resize?"":"none",this.K&&this.K.b(1,0),F&!this.a.sticky&&OS13k.i(I=this.a.id)))}C(){this.a.id==I&&(I=""),Q(92),this.a.i(0),this.a.window=0,this.K.remove(),this.remove()}}customElements.define("w-",Fa);class Qa extends HTMLElement{constructor(e,t){super(),this.className="taskbarIcon",this.X=this.F=t,this.G(this.a=e),taskbarSpace.before(this)}G(){this.innerHTML="<div style=pointer-events:none>"+(this.a.icon||"üí†"),this.title=this.a.name}u(){this.b()}b(e=1,t=1){if(e&&this.F.b(1,t),this==J)return Q(8,.5);this.className="taskbarIcon "+(e?"taskbarIconActive":""),e&&wa!=this&&(wa&&wa.b(0),wa=this)}}function X(e,t){e.a=t,e.title=t.name,e.innerHTML=t.icon}customElements.define("i-",Qa);class Y extends HTMLElement{constructor(){super(),this.className="trayIcon",tray.appendChild(this)}u(){var e=this.a;S&&S==e.window?e.window.C():e.u()}}customElements.define("t-",Y),onmousedown=(e=>{if(e.target==J&&e.target.F.style.visibility)return sa(),S&&S.b(),!1;if(sa(programsMenu.style.left=0,programsMenu.style.top=44,pa=1),R)return onmouseup(e);var t=e.originalTarget||e.path[0];let i=0;try{i=/input|textarea/.test(t.localName)}catch{i=1,t=e.target}return e.button?"button"!=t.localName&&void(2&e.button&&((e.target.b?e.target:J).b(),(t=e.target.X?(Q(8,.5),menu):programsMenu).style.left=e.x,t.style.top=e.y,t.style.visibility="visible")):(e.target.u?e.target.u(t,e.x,e.y):S&&S.b(),e.target==J||i)}),onmousemove=(e=>{R&&(R.style.left=e.x-ua),R&&(R.style.top=e.y-va),e.target.U&&e.target.U()}),onmouseup=(()=>R&&(R.a.i(),Q(42),R.b(1,0),document.body.style.cursor=desktop.style.pointerEvents=R="")),oncontextmenu=(()=>!1),ondrop=(e=>{const t=new FileReader;return t.onload=(t=>e.target.b(1,0,Ga(e.target,t.target.result,1))),e.dataTransfer.files.length&&e.target.a.h&&t.readAsText(e.dataTransfer.files[0],"utf-8"),!1}),ondragover=(()=>!1);var Oa=(...e)=>OS13k.PlaySamples(zzfxG(...e)),zzfxG=(e=1,t=.05,i=220,n=0,s=0,a=.1,o=0,r=1,h=0,l=0,d=0,c=0,u=0,m=0,p=0,y=0,g=0,f=1,S=0,w=[],k=44100)=>{n=99+n*k,s*=k,a*=k,S*=k,g*=k;let b=2*Math.PI,v=OS13k.randomSeed=OS13k.Clamp(n+S+s+a+g,9*k),x=h*=500*b/k**2;t=i*=(1+2*t*Math.random()-t)*b/k;let C=(0<p?1:-1)*b/4,O=0,M=0,I=0,R=1,L=0,T=0,B=0;for(u*=k,c*=k,d*=b/k,l*=500*b/k**3,p*=b/k;I<v;w[I]=(w[I++]||0)+B)++T>100*y&&(T=0,B=O*i*Math.sin(M*p-C),B=(0<(B=o?1<o?2<o?3<o?Math.sin((B%b)**3):OS13k.Clamp(Math.tan(B),1,-1):1-(2*B/b%2+2)%2:1-4*Math.abs(Math.round(B/b)-B/b):Math.sin(B))?1:-1)*Math.abs(B)**r*e*(I<n?I/n:I<n+S?1-(I-n)/S*(1-f):I<n+S+s?f:I<v-g?(v-I-g)/a*f:0),B=g?B/2+(g>I?0:(I<v-g?1:(I-v)/g)*w[I-g|0]/2):B),O+=1+OS13k.Random(m,-m),M+=1+OS13k.Random(m,-m),i+=h+=l,R&&++R>c&&(i+=d,t+=d,R=0),u&&++L>u&&(i=t,h=x,L=1,R=R||1);return w},ha=(e,t,i,n=6)=>{const s=44100*n/50|0,a={},o=[[],[]];let r,h,l,d,c,u,m=0;return i.map(i=>{t[i].map((t,i)=>{h=m;for(let m=2;m<t.length;h+=s){var n=0|t[m++];if(n){const i=0|t[c=d=0],s=[i,n];l=a[s]||((u=[...e[i]])[2]*=2**((n-12)/12),a[s]=zzfxG(...u)),l=a[s]}for(c=0>n||n%1||c,r=h;r<h+s;++r)n=l[d++]*(1-c)||0,o[0][r]=(i&&o[0][r])-n*t[1]+n,o[1][r]=(i&&o[1][r])+n*t[1]}}),m=r}),o};localStorage.OS13k&&([x,settings,G,I,ja]=JSON.parse(localStorage.OS13k)),OS13k.i(),v.connect(t.destination),da.connect(t.destination),A=new Y,na=new Y,ya=new Y,za=new Y,P=new Y,buttonFullScreen.onmousedown=(()=>Ra(S)),buttonHelp.onmousedown=buttonCode.onmousedown=(()=>Da(S)),buttonResetSize.onmousedown=(()=>S.b(1,1,Ia(S,1,61))),buttonReload.onmousedown=(()=>B(S)),buttonClose.onmousedown=(()=>S.C()),K(J=new Qa({icon:"üíæ",name:"Load Program"},new Ba(ba))),OS13k.Trophy("üëã","","Welcome to OS13k!");for(const e in localStorage)ta(e);onstorage=(e=>ta(e.key)),onunload=(()=>speechSynthesis&&speechSynthesis.cancel()),ma()
</script>