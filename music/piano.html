<style>body{background:#111;color:#fff;user-select:none;text-align:center}</style>
<span id=B></span>
&nbsp;Seed &nbsp;<input type=number id=S style=width:99 oninput=b(t=3,localStorage.OS13kP=S.value) onfocus=b(t=3)>
&nbsp;Octave <input type=number id=D style=width:40 value=0 min=-3 max=3 onchange=D.value=O.Clamp(D.value,-3,3)><br>
Volume <input type=range style=width:70 id=V value=50>
Length <input type=range style=width:70 id=L value=25>
Noise <input type=range style=width:70 id=N value=0>
Shape <input type=range style=width:70 id=H value=50>
<hr>
<div><script>

// instruments
u = ['Organ', 'Flute', 'Sin'];

// create settings
b=e=>
{
    // clear old settings
    B.innerHTML = '';
    
    // create buttons
    for(j in u)
        B.innerHTML += `<button style='border:5px solid #${ // button
            t-j? "111" : "f00" }' onclick=b(t=${            // color
            j })>${                                         // click
            u[j] }</button> `;                              // text
   
    // disable noise & shape if seed
    H.disabled = N.disabled = t==3;
    
    // set seed border if selected
    S.style.border = `5px solid #${ t==3? "f00" : "111"}`
}

// play a note
p=e=>
{
    n = O.Note(e - 33 + D.value*12); // root note = A 440
    l = .1 + L.value / 50;           // length
    v = V.value / 50;                // volume
    
    // animate color when played
    f = eval('b' + e);            // get the button
    q = f.style.background;       // save old background color
    f.style.background = '#f00';  // set background to red
    f.style.transition = '';      // cancel transition
    f.offsetHeight;               // reset transition
    f.style.transition = l + 's'; // transition time
    f.style.background = q;       // old background color
    
    f = [             // instruments
        [1, 2, 4, 8], // organ
        [1, 3, 5],    // flute
        [1]           // sin
    ][ t ];           // get instrument
    
    // play sound
    t-3 ?                         // seed or instrument
        f.map(f=>zzfx(...[        // play zzfx sound
            v/(1+Math.log2(f))/3, // scale volume
            0,                    // no randomness
            f*n,,                 // frequency
            l,                    // sustain
            .05,,                 // release
            (H.value/50)**4,      // shape curve
            ,,,,,N.value/99       // noise
        ])) :
        [O.PlaySeed(S.value, l, v, 0, n)]; // play seed
}

// create piano keys
for(b(t=i=0);         // selected sound, iterator
    i<72;             // 72 keys
    O=parent.OS13k)   // get OS13k
document.body.innerHTML +=                                     // add to html
`<div id=b${ z = 48 - (i/24|0)*24 + i%24                       // reorder keys
} onmouseover=event.buttons&&p(${                              // mouse over
z}) onmousedown=p(${                                           // mouse down
z}) style="display:inline-block;border:1px solid #000;background:#${     // style
    '02579'.indexOf( i%12 - 1 ) < 0 ?                          // b or w
    'fff;width:34;height:129' :                                // black
    '000;position:absolute;margin-left:-9;width:17;height:70'}"></div>${ // white
    ++i%24 ? '' : '<br>'}`;                                    // next row

// keyboard control
K='zsxdcvgbhnjm,l.;/q2w3er5t6y7ui9o0p[=]';
onkeydown=e=>
{
k = K.indexOf(e.key.toLowerCase());   // find the key
k += k>16 ? 7 : 0;                    // adjust for octave
document.activeElement == S ||        // prevent input when editing seed
e.repeat ? 0 :                        // prevent key repeats
Math.abs(i = e.keyCode - 39) == 1 ?   // check for up down arrows
D.value = O.Clamp(D.value-i, -3, 3) : // octave control
k >= 0 &&                             // key was found
    p(k);                             // play the note
}

// load saved seed
S.value = localStorage.OS13kP|0 || 0;

</script>