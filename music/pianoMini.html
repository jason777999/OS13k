<style>body{background:#111;color:#fff;user-select:none;text-align:center}</style><span id=B></span><input type=radio name=I checked onmousedown=R(0)>🎹 <input type=radio name=I onmousedown=R(1)>🎷 <input type=radio name=I onmousedown=R(2)>🎻 <input type=radio name=I onmousedown=R(3) id=E>🌱 <input style=width:99 oninput=R(3) onfocus=R(E.checked=3) id=S placeholder=Seed><p>🔊 <input type=range style=width:199 id=V><script>

// globals
// B = instrument button container
// S = seed
// O = octave
// Y = key
// V = Gain
// N = noise
// H = shape
// C = crush
// T = instrument type
// A = active sounds

//////////////////////////////////////////////////////////////
// sound

// build cached samples
R = e=>
{
    T=e;
    onblur(D = []);                       // cancel all sounds and init sample cache
    for(i=6;--i;                          // loop for each octave
        T-3 ?                             // check if instrument
        [                                 // instruments
            [...`1248`],                  // organ
            [...`3579`],                  // oboe
            [...`123`]                    // string
        ][ T ].map(e=>                    // get instrument
            parent.zzfxG(...[             // generate zzfx samples
                1/(1+Math.log2(e)),       // scale volume
                0,                        // no randomness
                e*f,,                     // frequency
                2,                        // sustain
                .5,,,,,,,,,,,,            // release
                .7,                       // sustain volume
                .1,                       // decay
                D[i]                      // add to buffer
            ]))
        :
        D[i] = OS13k.SeedSamples(         // get seed samples
            S.value, 1, 9, 0, f)          // seed parameters
    )
        f = parent.OS13k.Note(i*12-45),   // root frequency C
        D[i] = [];                        // clear samples
}

// play note
P = e=> e < 0 || A[e] ||         // is note valid and not playing
(
    // play cached sound
    (A[e] =                     // set sound                 
        OS13k.PlaySamples(      // play samples
            D[2 + e/12|0], 2)). // get octave
                detune.value =  // set frequency
                    e%12*100,   // get note offset

    A[e].gain.gain.value = V.value / 50 // set volume
);

// cancel note
X = e=> A[e] &&                                                     // is note playing
(                                    
    A[e].gain.gain.linearRampToValueAtTime(V.value / 99, t = A[e].context.currentTime + .02), // set gain to 1
    A[e].gain.gain.linearRampToValueAtTime(A[e] = 0, t + .1)        // ramp gain to 0 and remove sound
);

//////////////////////////////////////////////////////////////
// init

A = []
onunload = onblur = e=> A.map((e,i)=> X(i));
R(T = 0);

//////////////////////////////////////////////////////////////
// keyboard controls

// play note on key down
onkeydown = e=>
    document.activeElement == S || // not when editing seed
    P(
    (k = 'ZSXDCVGBHNJM,L.;/Q2W3ER5T6Y7UI9O0P[=]' // map key to note
    .indexOf(e.key?.toUpperCase()),              // find the key and check for invalid key
    k - 5 * (k > 16))                            // remap second row of keys
); 

// release note on key up
onkeyup = e=> X(
    (k = 'ZSXDCVGBHNJM,L.;/Q2W3ER5T6Y7UI9O0P[=]' // map key to note
    .indexOf(e.key?.toUpperCase()),              // find the key and check for invalid key
    k - 5 * (k > 16))                            // remap second row of keys

);

</script>