<body style=margin:0><svg id="b" viewBox="0 0 6 6" height=320 width=320 />
<style>rect{cursor:pointer;transition:x .15s,y .25s;}</style>
<script>
/**
 * SWATCH - reorder the swatches
 * based off the game "i love hue"
 **/
// TODO - fix level progression state
// TODO - add win state / level transition (in title bar?)
// TODO - add selected state for rectangle
// TODO - add fixed state for rectangle
// TODO - OS13K BONUS - persistant storage for level progress?

// C=cells, L=level, V=moves, W=did win flag, I=has init flag, P=swap array, RGB=12 whole levels of data 
let [D,R,M,C,L,V,W,I,P,RGB,Z]=[
  document,
  'rect',
  'map',
  [...Array(36)].map(_=>({})),
  0,
  0,
  0,
  0,
  [],
  ['e81cf2013d24e98a6c4fe0613ace249f','512fffcaff227728e908ea975ee38a65','40337fe5b7a00c583f68809e0dd36865'],
  [,.5,200,.12,.01,.09,4,6,-52.5]
];
// zzfx func is available from the os
zzfx=(!typeof zzfx)||(()=>{});
// index to X location
X=i=>i%6;
// index to Y location
Y=i=>i/6|0;
// set attributes
SA=(a,b)=>{for(o in b)a.setAttribute(o,b[o])};
// is sorted test
IS=a=>a.every((c,i,b)=>!i||b[i-1].i<=c.i);
// bilinear interpolation
blerp=(x,y,Q,R,S,T)=>(1-y)*((1-x)*Q+x*R)+y*((1-x)*S+x*T);
// swap indexs
SI=(a,b)=>[a.i,b.i]=[b.i,a.i];
// random sort
sort=_=>Math.random()-.5;
// shuffle with fixed positions
shuffle=a=>(b=C.filter(c=>!c.f)[M](c=>c.i).sort(sort),C[M](c=>c.f||(c.i=b.pop())));
// hex to dec conversion
hexdec=a=>a.match(/\w{2}/g)[M](b=>parseInt(b,16));
// get level rgb data
GL=a=>RGB[M](b=>hexdec(b.slice(a*2,a*2+8)));
// set title
ST=_=>D.title=`Lvl:${L+1} Moves:${V++}`;
// set level data, fill sells, init the level
level=N=>{let r=GL(N);C[M]((a,j)=>(a.i=j,a.f=[0,5,30,35].includes(j),a.c=`rgb(${r[M](c=>blerp(X(j)/5,Y(j)/5,...c))})`));init(C);}
// update title then update all rectangles then update x & y
draw=_=>(ST(),C[M]((c,i)=>SA(D.querySelectorAll(R)[i],{i:c.i,x:X(c.i),y:Y(c.i)})));
// init game level function
init=A=>{
  // reset swap array, clear existing elements, reset moves counter
  P=[];b.innerHTML='';V=0;
  // for every cell, create a svg rect, set the attributes, add onclick handler, append rect to svg 
  A[M](c=>{let r=D.createElementNS('http://www.w3.org/2000/svg',R);SA(r,{height:1,width:1,x:X(c.i),y:Y(c.i),fill:c.c});r.onclick=e=>EH(c);b.appendChild(r);});
  // wait 2 seconds, shuffle array elements, call draw function , set is init
  setTimeout(_=>{shuffle(C);draw();I=1;},2e3);
}

// click event handler
EH=c=>{
  if (c.f||!I) return;
  zzfx(Z);
  if (P.push(c)==2) {
    SI(...P);
    P=[];
    draw();
    zzfx(...Z);
  }
  // if sorted, start next level
  IS(C)&&level(++L);
}



level(L)
</script>
