<body style=margin:0>
  <div id=a><a><svg id="b" viewBox="0 0 6 6" height=320 width=320></svg></div>
  <style>rect { cursor: pointer; transition: x .15s ease-out, y .25s ease-out; }</style>
  <script>
  
  /**
   * SWATCH - reorder the swatches
   * based off the game "i love hue"
   **/

  // TODO - add win state (in title bar?)
  // TODO - add level progression
  // TODO - fix swapping algorithm
  // TODO - minify code
  // TODO - add selected state for rectangle
  // TODO - add fixed state for rectangle
  // TODO - add sound effects
  // TODO - persistant storage for level progress?

  // L = level, V = moves, W = did win flag, I = has init flag
  let [D,R,M,L,V,W,I]=[document,'rect','map',0,0,0,0];
  // 12 whole levels word of data 
  let RGB=['e81cf2013d24e98a6c4fe0613ace249f','512fffcaff227728e908ea975ee38a65','40337fe5b7a00c583f68809e0dd36865'];
  // set attributes
  sas=(e,o)=>{for(O in o)e.setAttribute(O,o[O])};
  // is sorted test
  isSorted=a=>a.every((c,i,a)=>!i||a[i-1].i<=c.i);
  // bilinear interpolation
  blerp=(x,y,Q,R,S,T)=>(1-y)*((1-x)*Q+x*R)+y*((1-x)*S+x*T);
  // swap indexs
  si=(a,b)=>[a.i,b.i]=[b.i,a.i];
  // shuffle with fixed positions
  shuffle=q=>(q.sort(a=>Math.random()-.5),q[M]((k,i)=>(k.f&&si(q[k.i],q[i]))),q);
  // hex to dec
  hexdec=n=>n.match(/\w{2}/g)[M](m=>parseInt(m,16));
  // get level rgb data
  getLevel=n=>RGB[M](_=>hexdec(_.slice(n*2,n*2+8)));
  // set title
  setTitle=a=>D.title=`Lvl:${L} Moves:${V++}`;

  level=N=>{
    
    let rgb=getLevel(N),
        x=i=>i%6,
        y=i=>~~(i/6),
        swap=[];

    let cells = [...Array(36)][M]((d,i) => {
      let f = [0,5,30,35].includes(i);
      let p = x(i)/5;
      let q = y(i)/5;
      let c = `rgb(${rgb[M](c=>blerp(p,q,...c))})`;
      return { i, p, q, c, f };
    });

    handleClick=c=>{
      console.log(c);
      if (c.f||!I) return;
      if (swap.push(c)==2) {
        si(...swap);
        swap = [];
        draw();
      }
      // TODO test if sorted
    }

    init=A=>{
      // clear existing elements 
      b.innerHTML='';
      // reset moves counter
      V=0;
      // for ever cell
      A[M](c=>{
        // create a svg rect
        let r=D.createElementNS('http://www.w3.org/2000/svg',R);
        // set the attributes
        sas(r,{height:1,width:1,x:x(c.i),y:y(c.i),fill:c.c});
        // add onclick handler
        r.onclick=e=>handleClick(c);
        // append rect to svg 
        b.appendChild(r);
      });
      // wait 2 seconds
      setTimeout(()=>{
        // shuffle array elements
        shuffle(cells);
        // call draw function 
        draw();
        // set is init
        I=1;
      }, 2e3);
    }

    // get dom element then update x & y
    draw=a=>(setTitle(),cells[M]((c,i)=>sas(D.querySelectorAll(R)[i],{x:x(c.i),y:y(c.i)})));

    // init the level
    init(cells);
  }

  level(L);

  </script>