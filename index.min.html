<head>
<title>OS13k - A tiny pseudo operating system for JS13k</title>
<meta charset=utf-8>
<style>
*    { font-family:arial; user-select:none;}
body { margin:0; overflow:hidden; background:linear-gradient(#223,#322); }
.desktop
{
}
.taskbar
{
position:absolute;
display:flex;
align-items:center;
width:100%;
height:44;
background:linear-gradient(#777,#222);
border:2px solid;
}
.icon
{
margin:2;
width:44;
height:35;
font-size:22;
border:2px solid;
display:flex;
align-items:center;
justify-content:center;
text-shadow:1px 1px 2px #000;
border-radius:9px;
box-shadow:0px 0px 3px;
background:linear-gradient(#eee,#444);
}
.iconSelected { background:linear-gradient(#ff8,#fff); }
.title
{
font-size:300;
font-family:impact;
color:#0002;
height:100%;
display:flex;
align-items:center;
justify-content:center;
pointer-events:none;
}
</style>
<template id=templateIcon>
<style>
:host
{
position:absolute;
display:flex;
align-items:center;
flex-direction:column;
pointer-events:auto;
}
.icon
{
width:64;
height:64;
font-size:42;
background:linear-gradient(#fff,#777);
border-radius:9px;
box-shadow:4px 4px 5px;
overflow:hidden;
white-space:nowrap;
pointer-events:none;
display:flex;
align-items:center;
justify-content:center;
text-shadow:2px 2px 4px #000;
}
.name
{
position:absolute;
top:70;
text-align:center;
font-size:17;
color:#fff;
text-shadow:2px 2px 5px #000;
}
.iconSelected { background:linear-gradient(#99f,#fff); }
</style>
</template>
<template id=templateWindow>
<style>
:host
{
position:absolute;
display:flex;
flex-direction:column;
box-shadow:9px 9px 9px;
background:#000;
border:2px solid;
overflow:hidden;
display:block;
}
.titleBar
{
height:44;
font-size:30;
display:flex;
align-items:center;
justify-content:center;
white-space:nowrap;
overflow:hidden;
background:linear-gradient(#999,#444);
}
.frame
{
position:relative;
width:100%;
height:100%;
border:none;
background:#fff;
overflow:hidden;
}
.name         
{
width:100%; 
cursor:grab; 
display:flex; 
align-items:center; 
overflow:hidden;
}
.titleBarSelected { background:linear-gradient(#eee,#88f); }
.folder       { background:#222; }
#full,#reload { width:40; }
.close        { width:28; }
.full:hover   { background:#fff; }
.reload:hover { background:#ff0; }
.close:hover  { background:#f00; }
div svg 
{
width: 100%;
pointer-events: none;
}
</style>    
<svg width=0 height=0>
<symbol id=iconFull viewBox='0 0 10 10'>
<rect stroke=#000 stroke-width=.7 fill=none x=1 y=2 width=8 height=6 />
</symbol>
<symbol id=iconReload viewBox='0 0 10 10'>
<circle stroke=#000 stroke-width=.7 fill=none cx=5 cy=5 r=3 />
</symbol>
<symbol id=iconClose viewBox='0 0 10 10'>
<path stroke=#000 d='M1 1L9 9M9 1L1 9' />
</symbol>
</svg>
</template>
</head>
<body>
<div id=taskbar class=taskbar></div>
<div id=desktop class=desktop></div>
<div class=title>OS13k</div>
<script src=desktop.js?1></script>
<script>
"use strict";const e=[{name:"Help",icon:"<span style=color:#0f0>?</span>",src:"help.html?10",width:380,height:360},{name:"Code Info",icon:"üë®‚Äçüíª",src:"codeInfo.html?5"},{name:"System",icon:"‚öôÔ∏è",f:[{name:"Test",icon:"üòÑ",src:"system/test.html?5"}]},{name:"Games",icon:"üéÆ",f:[{name:"Lava Rush",icon:"üåã",c:"Jeremy Burns",src:"games/lavaRush.html?4",width:640,height:400},{name:"Sn1ke",icon:"üëÄ",src:"games/sn1ke.html",c:"Codegolf Team",width:450,height:330},{name:"Tetris",icon:"üÜÉ",c:"Veubeke",src:"games/tetris.html",width:340,height:430},{name:"Queen's Gambit",icon:"<span style=color:#f0f>‚ôõ</span>",src:"games/queensGambit.html?1",width:1290,height:720,i:1},{name:"Free Cell",icon:"‚ô†Ô∏è",src:"games/freeCell.html",width:800,height:1e3},{name:"Digit Dilemma",icon:"<span style=font-family:monospace>‚òª</span>",src:"games/digitDilemma.html?2"},{name:"Hue Jumper",icon:"üå≤",src:"games/hueJumper.html",i:1}]},{name:"Music",icon:"üé∂",f:[{name:"Min Bytes",icon:"<span style=color:#f00>ùìú</span>",width:500,height:500,src:"music/minBytes.html?4"}]},{name:"Utilities",icon:"üîß",f:[{name:"Photo Booth",icon:"üì∏",src:"utilities/photoBooth.html",width:1380,height:600},{name:"Unicode Toys",icon:"ùñÄ",c:"Xem",src:"utilities/unicodeToys.html",width:500,height:800},{name:"Mini Shadertoy",icon:"ùì¢",src:"utilities/miniShadertoy.html",width:340,height:400}]},{name:"Toys",icon:"ü§ñ",f:[{name:"ZzFX Soundboard",icon:"ùêôùêô",src:"toys/zzfxSoundBoard.html"},{name:"Yin Yangs",icon:"‚òØÔ∏è",src:"toys/infiniteYinYangs.shader.txt"},{name:"Vogel Spiral",icon:"üåÄ",src:"toys/vogelSpiral.shader.txt?2"},{name:"Meta OS13k",icon:"ùêéùêí",src:"index.html"},{name:"ZzArt Landscape",icon:"ùì©",src:"toys/zzart.shader.txt"}]},{name:"Dweets",icon:"<b>III</b>",f:[{name:"Black Hole",icon:"üåå",src:"dweets/blackHole.dweet.js"},{name:"Mandelbrot Nebula",icon:"üåü",src:"dweets/mandelbrotNebula.dweet.js"},{name:"Bogus Roads",icon:"üõ£Ô∏è",src:"dweets/bogusRoads.dweet.js"},{name:"Automatic Breakout",icon:"‚óè",src:"dweets/breakout.dweet.js"},{name:"Underwater Cavern",icon:"üåä",c:"Pavel",src:"dweets/underwaterCavern.dweet.js"},{name:"City Traffic",icon:"üöå",c:"Tomxor",src:"dweets/cityTraffic.dweet.js"},{name:"Train Set",icon:"üöÇ",c:"jylikangas",src:"dweets/trainSet.dweet.js"}]}];desktop.a=(()=>{i&&i.b(i=0),t&&t.b(t=0),s&&s.b(s=0),this.focus()}),desktop.g=(()=>desktop.a());let t;class n extends HTMLElement{constructor({x:e,y:t,name:n,icon:i,src:s,width:o=720,height:a=405,c:r,f:h,u:d,i:c}){super(),s=s||"",n=n||s.split(".")[0],i=i||(n[0]?n[0].toUpperCase():""),this.name=n,this.icon=i,this.src=s,this.style.left=e,this.style.top=t,this.v=o,this.H=a,this.c=r,this.f=h,this.u=d,this.i=c,e=s?s.split(".")[1]:"",this.l="dweet"==e,this.isShader="shader"==e,(this.l||this.isShader)&&(this.i=1),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=templateIcon.innerHTML,(e=this.C=document.createElement("div")).className="icon",e.innerHTML=i,this.shadowRoot.appendChild(e),(i=document.createElement("div")).className="name",i.innerHTML=n,this.shadowRoot.appendChild(i)}j(){let e=this.window;e||(e=new l(this),this.u||(this.window=e),desktop.appendChild(e)),e.a()}g(){const e=this.parentElement&&this.parentElement.offsetParent;e.a?e.a():desktop.a(),this.b()}b(e=1){t&&t.b(t=0),t=this,this.C.className="icon"+(e?" iconSelected":"")}}customElements.define("os13k-icon",n);let i,s,o,a,r,h=0,d=99,c=200;class l extends HTMLElement{constructor(e){super(),this.icon=e,this.m=new m(this,e),taskbar.appendChild(this.m),this.style.left=d,this.style.top=c,400<(c+=46)&&(c=200),1e3<(d+=46)&&(d=99),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=templateWindow.innerHTML;var t=this.G=document.createElement("div");t.className="titleBar",t.style.maxWidth=e.v,this.shadowRoot.appendChild(t);var i=document.createElement("div");if(i.className=i.id="name",i.innerHTML="<div style=pointer-events:none>&nbsp;<span style='text-shadow:2px 2px 3px #000'>"+e.icon+"</span>&nbsp;"+e.name+"&nbsp;"+(e.c?"("+e.c+")":""),t.appendChild(i),e.f||((i=document.createElement("div")).className=i.id="full",i.title="Full Screen",i.innerHTML="<svg><use href=#iconFull>",t.appendChild(i)),e.i&&((i=document.createElement("div")).className=i.id="reload",i.title="Reload",i.innerHTML="<svg><use href=#iconReload>",t.appendChild(i)),(i=document.createElement("div")).className=i.id="close",i.title="Close",i.innerHTML="<svg><use href=#iconClose>",t.appendChild(i),(t=document.createElement("div")).style.height=2,this.shadowRoot.appendChild(t),(t=document.createElement("div")).className="frame folder",t.style.width=e.v,t.style.height=e.H,this.B=t,this.shadowRoot.appendChild(t),this.icon=e,e.f){let s=i=30;for(const o of e.f)o.x=i,o.y=s,693<(i+=99)&&(i=24.75,s+=130),t.appendChild(new n(o));this.a()}else if(e.src){const n=this.D=document.createElement("iframe");n.className="frame",n.sandbox.add("allow-scripts"),n.sandbox.add("allow-same-origin"),n.sandbox.add("allow-popups"),n.sandbox.add("allow-modals"),n.sandbox.add("allow-pointer-lock"),n.style.display="none",n.src=e.src,t.style.background="#000",t.appendChild(n),n.onload=(e=>{if((e=this.s=e.target.contentWindow).OS13k=f,e.zzfx=p,e.OS13kStart&&e.OS13kStart(),e.oncontextmenu=(e=>e.preventDefault()),this.icon.l||this.icon.isShader){const t=e.document,n=t.body.innerText;t.body.innerHTML="<canvas id=c width=1920 height=1080 style="+`width:100%;background:#${this.icon.l?"fff":"000"}>`,t.body.style="background:#000;overflow:hidden;margin:0;display:flex;align-items:center",this.icon.l&&e.eval("u=t=>{"+n+"};x=c.getContext`2d`;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&u((60*(frame++/60)-frame-1|0?frame-1:frame)/60));loop(frame=0)"),this.icon.isShader&&e.eval("g=c.getContext`webgl2`;x=y=z=w=0;onmousemove=e=>e.buttons&&(x=e.x,y=c.height-e.y);onmousedown=e=>(z=e.x,w=c.height-e.y);onmouseup=e=>z=w=0;loop=t=>requestAnimationFrame(loop,document.hasFocus()&&(c.width=innerWidth,c.height=innerHeight,g.uniform4f(g.getUniformLocation(s,`iMouse`),x,y,z,w),OS13k.RenderShader(c,s,t/1e3)));loop(s=OS13k.CreateShader(c,`"+n+"`))")}n.style.display="",this.a()})}}g(e){if("close"==e&&this.o(),"reload"==e&&(this.D.style.display="none",this.s.location.reload()),"full"==e){const e=this.B;e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()}"name"==e&&(o=this),"close"!=e&&this.a()}o(){this.icon.window=0,this.m.remove(),this.remove()}a(){this.s?this.s.focus():desktop.a(),this.b()}b(e=1){e&&(this.style.zIndex=++h,this.style.display="",i&&i!=this&&i.b(0)),this.G.className="titleBar"+(e?" titleBarSelected":""),i=e?this:0,t&&t.b(t=0),this.m.b(1)}}customElements.define("os13k-window",l);class m extends HTMLElement{constructor(e,t){super(),this.window=e,this.className="icon",this.innerHTML="<div style=pointer-events:none>"+t.icon,this.title=t.name}g(){if(this.window.a(),this.window==desktop){const e=[];for(const t of desktop.children)t.o&&e.push(t);for(const t of e)t.o();d=99,c=200}}j(){if(this.window!=desktop){const e=this.window.getBoundingClientRect();this.window.style.left=innerWidth/2-e.width/2,this.window.style.top=innerHeight/2-e.height/2}}b(e=1){s&&s.b(s=0),s=this,this.className="icon"+(e?" iconSelected":"")}}customElements.define("os13k-taskbar-icon",m),onmousedown=(e=>{if(o)return onmouseup(e);e.preventDefault();var t=e.target.getBoundingClientRect();a=e.x-t.left,r=e.y-t.top,e.target.g?(t=e.originalTarget||e.path[0],e.target.g(t.id),t!=e.target&&t.g&&t.g()):desktop.g(),o&&(document.body.style.cursor="grabbing",desktop.style.pointerEvents="none")}),onmouseup=(()=>{desktop.style.pointerEvents="",document.body.style.cursor="",o=0}),onmousemove=(e=>{if(o){const t=o.getBoundingClientRect(),n=f.Clamp(e.y-r,46,innerHeight-48);o.style.left=f.Clamp(e.x-a,130-t.width,innerWidth-99),o.style.top=n}}),ondblclick=(e=>{(e=e.originalTarget||e.path[0]).j&&e.j()}),oncontextmenu=(e=>e.preventDefault());let u=.3;const p=(e=1,t=.05,n=220,i=0,s=0,o=.1,a=0,r=1,h=0,d=0,c=0,l=0,m=0,p=0,w=0,g=0,y=0,S=2*Math.PI,b=44100,C=(e=>2*e*Math.random()-e),v=(e=>0<e?1:-1),x=(h*=500*S/b**2),T=(n*=(1+C(t))*S/b),k=v(w)*S/4,M=[],E=0,R=0,B=0,L=1,A=0,H=0,N=0,D,I)=>{for(d*=500*S/b**3,I=(i=99+i*b|0)+(s=s*b|0)+(o=o*b|0)+(y=y*b|0),w*=S/b,c*=S/b,l*=b,m*=b;B<I;M[B++]=N)++H>100*g&&(H=0,N=E*n*Math.sin(R*w-k),N=v(N=a?1<a?2<a?3<a?Math.sin((N%S)**3):Math.max(Math.min(Math.tan(N),1),-1):1-(2*N/S%2+2)%2:1-4*Math.abs(Math.round(N/S)-N/S):Math.sin(N))*Math.abs(N)**r,N*=e*u*(B<i?B/i:B<i+s?1:B<I-y?1-(B-i-s)/o:0),N=y?N/2+(y>B?0:(B<I-y?1:(B-I)/y)*M[B-y]/2):N),E+=1+C(p),R+=1+C(p),n+=h+=d,L&&++L>l&&(n+=c,T+=c,L=0),m&&++A>m&&(n=T,h=x,A=1,L=L||1);return f.PlaySamples(M)},f=new class{constructor(){this.randomSeed=Date.now();{taskbar.appendChild(this.m=new m(desktop,{icon:"‚ùå",name:"Close All"}));let t=30,i=1;for(const s of e){s.x=t,s.y=80,t+=99;const e=new n(s);desktop.appendChild(e),i&&e.j(i=0)}}setInterval(this.w,16)}w(){const e=document.activeElement;this.F!=e&&("os13k-window"==e.localName&&e.a(),this.F=e)}KeyDirection(e){let t=0,n=0;return 87!=e&&38!=e||(n+=1),83!=e&&40!=e||--n,68!=e&&39!=e||(t+=1),65!=e&&37!=e||--t,{x:t,y:n}}Medal(){}PlaySeedSound(e,t=1,n=1,i=.05){this.randomSeed=e;const s=(e=(()=>this.Random()))()**3*t/2,o=e()**3*t/2,a=s+o+(t=e()**3*t/2);return p(...[n,i,2e3*e()**2,s,o,t,5*e()|0,3*e()**2,.5>e()?0:e()**3*(.5>e()?-99:99),.5>e()?0:e()**3*(.5>e()?-99:99),.5>e()?0:e()**2*(.5>e()?-1e3:1e3),e()**2*a,.5>e()?0:e()*a,.5>e()?0:e()**4,.5>e()?0:e()**3*(.5>e()?-9:9),.5>e()?0:e()**4,.5>e()?0:e()**3/2])}PlaySamples(e,t=44100){this.h||(this.h=new(AudioContext||webkitAudioContext),this.h.A=this.h.createBufferSource,this.h.createBufferSource=((e=this.h.A())=>(e.start=e.start||e.noteOn,e.stop=e.stop||e.noteOff,e))),t=this.h.createBuffer(1,e.length,t);const n=this.h.createBufferSource();return t.getChannelData(0).set(e),n.buffer=t,n.connect(this.h.destination),n.start(),n}SetVolume(e){u=e}Speak(e){speechSynthesis.speak(new SpeechSynthesisUtterance(e))}CreateShader(e,t){const n=(e=e.getContext("webgl2")).createShader(e.VERTEX_SHADER);e.shaderSource(n,"#version 300 es\nin vec4 p;void main(){gl_Position=p;}"),e.compileShader(n);var i=e.ARRAY_BUFFER;if(e.bindBuffer(i,e.createBuffer()),e.bufferData(i,new Int8Array([-3,1,1,-3,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.BYTE,0,0,0),i=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(i,"#version 300 es\nprecision mediump float;uniform float iTime;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;const float pi="+Math.PI+";const float e="+Math.E+";out vec4 outColor;\n"+t+"\nvoid main(){mainImage(outColor,gl_FragCoord.xy);outColor.a=1.;}"),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw e.getShaderInfoLog(i);return e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),t=e.createProgram(),e.attachShader(t,n),e.attachShader(t,i),e.linkProgram(t),e.useProgram(t),t}RenderShader(e,t,n=0){const i=e.getContext("webgl2");i.uniform3f(i.getUniformLocation(t,"iResolution"),e.width,e.height,1),i.uniform1f(i.getUniformLocation(t,"iTime"),n),i.uniform1i(i.getUniformLocation(t,"iChannel0"),0),i.viewport(0,0,e.width,e.height),i.drawArrays(i.TRIANGLE_FAN,0,3),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}Clamp(e,t=0,n=1){return Math.min(Math.max(e,t),n)}Percent(e,t,n){return n-t?this.Clamp((e-t)/(n-t),0,1):0}Lerp(e,t,n){return t+this.Clamp(e,0,1)*(n-t)}Random(e=1,t=0){return this.randomSeed^=this.randomSeed<<13,this.randomSeed^=this.randomSeed>>17,this.randomSeed^=this.randomSeed<<5,this.Percent(Math.abs(this.randomSeed)%1e9/1e9,t,e)}}
</script>
