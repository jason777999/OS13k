<meta charset=utf-8><style>body{opacity:0;margin:0;overflow:hidden;font-family:arial;font-size:22;user-select:none;white-space:nowrap;background:#000}#menu{display:flex;flex-direction:column;background:#000}.programMenu{background:linear-gradient(#fff,#777)}#menu,.programMenu{visibility:hidden;position:absolute;z-index:20000;box-shadow:5px 5px 9px;border:2px solid}.program{font-size:18;height:18;padding:4}.activeWindow{border:3px solid#aaa}#taskbar{position:absolute;z-index:10000;width:100%;background:linear-gradient(#888,#333);box-shadow:0px 1px 9px;border:2px solid;left:-2}.taskbarIcon{width:50;height:40;text-shadow:1px 1px 3px#000}.programActive,.taskbarIconActive{background:linear-gradient(#ff8,#fff)}.taskbarIcon:hover{background:linear-gradient(#fff,#44f)}#tray{margin:2;padding-left:9;padding-right:9;color:#fff;background:linear-gradient(#000,#333);border:1px solid;border-radius:6px;text-shadow:1px 1px 3px#000}.trayIcon{padding:2}.trayIcon:hover{background:#fff3}.popup{position:relative;z-index:10000;width:200;padding:8;pointer-events:none;white-space:normal;text-align:center;background:linear-gradient(#eee,#888);box-shadow:9px 9px 19px;border:2px solid;border-radius:9px}.trophyIcon{padding:9;font-size:40;text-shadow:2px 2px 4px;white-space:nowrap}#background{position:absolute;width:100%;height:100%;color:#0002;font-family:impact;font-size:30vw;font-weight:900;position:absolute}.program,#taskbar,.taskbarIcon,#background,#tray{display:flex;align-items:center;justify-content:center}</style><template id=T><style>:host{visibility:hidden;position:absolute;background:#000;box-shadow:5px 5px 9px;border:3px solid#222;border-radius:6px;overflow:hidden}input,button,span{margin:4}textarea{padding:9}span{white-space:nowrap}.titlebar{height:34;font-size:24;display:flex;align-items:center;white-space:nowrap;background:linear-gradient(#ccc,#444);border-bottom:3px solid}.titlebarActive{background:linear-gradient(#eee,#88f)}.titlebarActiveUser{background:linear-gradient(#eee,#8f8)}.titlebarActiveSticky{background:linear-gradient(#eee,#f88)}.titlebarSticky{background:linear-gradient(#ccc,#844)}#name{width:100%;overflow:hidden;cursor:grab}#icon{display:inline;text-shadow:1px 1px 3px#000;margin-left:9;margin-right:9;pointer-events:none}#frame{width:100%;height:100%;background:#fff;border:none;visibility:hidden}#codeDisplay{display:none}#codeText{height:199;background:#000;color:#fff}#errorText{background:#000;color:#f00}#codeOptions{background:#111;color:#fff;font-size:16;white-space:normal}#codeText,#errorText,#codeOptions{width:100%;resize:none;outline:0;border-top:2px solid}#Full:hover{background:#fff}#Help:hover{background:#0ff}#Code:hover{background:#f0f}#Shrink:hover{background:#0ff}#Grow:hover{background:#0f0}#Reload:hover{background:#ff0}#Close:hover{background:#f00}</style></template><div id=background></div><div id=desktop><div id=taskbar><div id=taskbarSpace style=flex:1></div><div id=tray></div></div><div id=popups style=float:right></div><div id=programsMenu style=position:absolute></div><div id=menu> <button id=buttonFullScreen>Full Screen <button id=buttonCode>Code <button id=buttonHelp>Help <button id=buttonResetSize>Reset Size <button id=buttonReload>Reload <button id=buttonClose>Close<script>'use strict';const sticky=1,reload=2,awake=4,full=8,resize=16,code=32,closeAll=128,newUserProgram=256,deleteUserPrograms=512,defaultFlags=full|reload|resize,defaultWidth=720,defaultHeight=405,programStubs=[[,"‚ùå",,,closeAll,"Close All"],["help.html","<b><span style=color:#0f0>?",380,400,sticky,,"Check here to see help when available.\nSome programs have a option to show code instead.\n\nHave fun! ‚úåÔ∏èüòÑ"],[,"‚öôÔ∏è",,,,"System",,[["system/settings.html","üéöÔ∏è",470,190,sticky],["system/trophyCase.html","üèÜ",,,full|resize|sticky],["system/clock.dweet.js","üï∞Ô∏è",198,198,sticky|code|awake],[,"üìÅ",,,,"Test",,[["system/systemTest.html",,600,370,defaultFlags|code],["index.html","‚úåÔ∏èüòÑ",,,,"Meta OS13k"]]]]],[,"üõ†Ô∏è",,,,"Apps",,[["apps/stickyNote.html","‚úçÔ∏è",300,263,sticky|reload,,"Ctrl+B - Bold\nCtrl+I - Italic\nCtrl+U - Underline\nReload to clear"],["apps/timer.html","‚åõ",400,139,sticky|reload]]],[,"üéÆ",,,,"Games",,[["games/bogusSlopes.dweet.js","üèÇüèª"]]],[,"üé∂",,,,"Music",,[["music/musicPlayer.html","üéµ",400,330,sticky],["music/piano.html","üéπ",520,510,reload],["music/visualizer.dweet.js","üëÅÔ∏è",,,awake|full|resize|code]]]];class _OS13k{Clamp(e,t=0,o=1){return Math.min(Math.max(e,t),o)}Percent(e,t,o){return o-t?this.Clamp((e-t)/(o-t),0,1):0}Lerp(e,t,o){return t+this.Clamp(e,0,1)*(o-t)}Hash(e){return[...e].reduce((e,t)=>t.charCodeAt()+31*e|0,0)}Random(e=1,t=0){return this.randomSeed^=this.randomSeed<<13||1,this.randomSeed^=this.randomSeed>>17,this.Percent(Math.abs(this.randomSeed^=this.randomSeed<<5)%1e9/1e9,t,e)}Trophy(e="",t="",o="",s=""){const i=e=>this.StripHTML(e,maxWordLength).replace(/[,`]/g,"");e=i(e),t=i(t),o=i(o),s=i(s);const r=e+`,${t},`+o,a=trophies.findIndex(e=>e[4]==r);if(a>=0&&trophies[a][3]==s)return;const n=[e,o,t,s,r];a<0?trophies.unshift(n):trophies[a]=n,localStorage["OS13kTrophy,"+r]=s,o||(o=e,e=""),this.Popup(`<div class=trophyIcon>${t||"üèÜ"}</div><div><b>${o}</b><br><i>${e}</i></div>`+s,o,"ja"),this.Save(trophyTrayIcon.program.window&&trophyTrayIcon.program.window.Reload())}GetTrophy(e,t){return rophies.find(o=>o[0]==e&o[1]==t)}Trophies(){return trophies}ClearTrophies(){trophies=[]}PlaySeed(e,t=1,o=1,s=.05,i,r){return this.PlaySamples(this.SeedSamples(...arguments),r)}SeedSamples(e,t=1,o=1,s=.05,i){return zzfxG(...this.SeedParameters(...arguments))}SeedParameters(e,t=1,o=1,s=.05,i){if(parseFloat(e=(e+"").trim())!=e){if("zzfx(...["==e.slice(0,9))return e.slice(9).split(",").map((e,t)=>t?1==t?s:2==t&&i?i:e.length?parseFloat(e):void 0:o);e=this.Hash(e)}this.randomSeed=e,t=this.Clamp(t,0,5);const r=()=>this.Random(),a=()=>r()<.5?r():0,n=e=>a()?e:-e,d=r()**3/4*t,l=r()**3/4*t,h=r()**3/4*t,c=r()**3/4*t,u=d+l+h+c,m=r()**2*2e3;return[o,s,i||m,d,h,c,5*r()|0,r()**2*3,a()**3*n(99),a()**3*n(99),a()**2*n(1e3),r()**2*u,a()*u,a()**4,a()**3*n(9),a()**4,a()**3/2,1-a(),l]}PlaySamples(e,t,o=defaultSampleRate){return this.PlaySamplesArray([e],t,o)}PlaySamplesArray(e,t,o=defaultSampleRate){const s=audioContext.createBuffer(e.length,e[0].length,o),i=audioContext.createBufferSource();return e.map((e,t)=>s.getChannelData(t).set(e)),i.buffer=s,i.connect(i.gain=audioContext.createGain()).connect(t?gainMusic:gain),t&&(t>1?i.gain:i).connect(musicAnalyser),i.start(),i}PlayMusic(e){try{return this.PlaySamplesArray(zzfxM(...e),1)}catch(e){console.log(e)}}GetAnalyser(){return analyserCanvas}GetAnalyserData(e){return analyserData[e]?analyserData[e]:0}Note(e=0,t=440,o=12){return t*2**(e/o)}Speak(e,t=1,o=1,s=1,i="en",r){const a=new SpeechSynthesisUtterance(e);a.volume=s*gain.gain.value*3,a.pitch=o,a.rate=t,a.lang=i,r&&StopSpeech(),settings.s&&finishedStartup&&speechSynthesis&&speechSynthesis.speak(a)}CreateShader(e,t){const o=e.getContext("webgl2"),s=o.createShader(35633);o.shaderSource(s,"#version 300 es\nin vec4 c;void main(){gl_Position=c;}"),o.compileShader(s);const i=o.createShader(35632),r="#version 300 es\nprecision mediump float;uniform float iTime;uniform int iFrame;uniform vec4 iMouse;uniform vec3 iResolution;uniform sampler2D iChannel0;out vec4 OS13kcolor;\n"+`${t}`+"\nvoid main(){mainImage(OS13kcolor,gl_FragCoord.xy);OS13kcolor.a=1.;}";if(o.shaderSource(i,r),o.compileShader(i),!o.getShaderParameter(i,35713))throw o.getShaderInfoLog(i);o.bindBuffer(34962,o.createBuffer()),o.bufferData(34962,new Int8Array([-3,1,1,-3,1,1]),35044),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,5120,0,0,0),o.bindTexture(3553,o.createTexture()),o.texParameteri(3553,10241,9729),o.pixelStorei(37440,1);const a=o.createProgram();return o.attachShader(a,s),o.attachShader(a,i),o.linkProgram(a),o.useProgram(a),a}RenderShader(e,t,o,s,i,r,a,n){const d=e.getContext("webgl2");d.uniform3f(d.getUniformLocation(t,"iResolution"),e.width,e.height,1),d.uniform1f(d.getUniformLocation(t,"iTime"),o),d.uniform1f(d.getUniformLocation(t,"iFrame"),s),d.uniform1i(d.getUniformLocation(t,"iChannel0"),0),d.uniform4f(d.getUniformLocation(t,"iMouse"),i,r,a,n),d.viewport(0,0,e.width,e.height),d.drawArrays(6,0,3),d.texImage2D(3553,0,6408,6408,5121,e)}StripHTML(e,t){return(e+"").substring(0,t||e.length).replace(/<.*>/g,"")}Popup(e,t,o){const s=popups.appendChild(document.createElement("div"));s.className="popup",s.innerHTML=e,s.speak=t,s.speakLanguage=o,s.style.visibility="hidden"}Input(e){let t;e.document.OS13kInput&&((t={...e.document.OS13kInput}).x=t.y=0,t.keydown[87]|t.keydown[38]&&++t.y,t.keydown[83]|t.keydown[40]&&--t.y,t.keydown[68]|t.keydown[39]&&++t.x,t.keydown[65]|t.keydown[37]&&--t.x);const o=e.document.OS13kInput={x:0,y:0,keypress:[],mousepress:[],keydown:e.document.OS13kInput?e.document.OS13kInput.keydown:[],mousedown:e.document.OS13kInput?e.document.OS13kInput.mousedown:[],mousex:e.document.OS13kInput?e.document.OS13kInput.mousex:0,mousey:e.document.OS13kInput?e.document.OS13kInput.mousey:0};return e.onkeydown=(e=>e.repeat||(o.keydown[e.keyCode]=o.keypress[e.keyCode]=1)),e.onkeyup=(e=>o.keydown[e.keyCode]=0),e.onmousedown=(e=>(o.mousedown[e.button]=o.mousepress[e.button]=1,1!=e.button)),e.onmouseup=(e=>o.mousedown[e.button]=0),e.onmousemove=(e=>(o.mousex=e.x,o.mousey=e.y)),e.onblur=(e=>(o.keydown=[],o.mousedown=[])),t||o}Save(){finishedStartup&&(localStorage.OS13k=JSON.stringify({t:trophies,s:settings,i:programInfos,p:startProgramId,n:nextUserProgramId})),gain.gain.value=settings.v,gainMusic.gain.value=settings.m,settings.s&&settings.v||StopSpeech(),background.style.background=`linear-gradient(${settings.c},${settings.d})`,background.innerText=settings.t,background.style.filter=desktop.style.filter=settings.f}SaveSettings(e,t,o,s,i,r,a,n,d){this.Save(settings={v:gain.gain.value=e,m:gainMusic.gain.value=t,s:o,p:s,o:i,c:r,d:a,t:n,f:d})}Settings(){return settings}}var OS13k=new _OS13k;const taskbarHeight=44,titlebarHeight=37,programHeight=26,startOpenOffset=9,popupTime=3,defaultVolume=.3,maxWordLength=32,defaultSampleRate=44100,analyserWaitTime=1e4,soundOpen=-8,soundClose=92,soundGrabStart=45,soundGrabEnd=42,soundMenu=8,soundTrophy=96,soundActive=66,soundShrink=75,soundGrow=61,soundFullScreen=-9,soundHelp=48,soundCode=16,soundReload=85,soundProgram=90,soundSave=6,audioContext=new AudioContext,gain=audioContext.createGain(),gainMusic=audioContext.createGain(),musicAnalyser=audioContext.createAnalyser(),Start=()=>{if(localStorage.OS13k){const e=JSON.parse(localStorage.OS13k);trophies=e.t,settings=e.s,programInfos=e.i,startProgramId=e.p,nextUserProgramId=e.n}OS13k.Save(),gain.connect(audioContext.destination),gainMusic.connect(audioContext.destination),musicTrayIcon=new OS13kTrayIcon,trophyTrayIcon=new OS13kTrayIcon,settingsTrayIcon=new OS13kTrayIcon,clockTrayIcon=new OS13kTrayIcon,onstorage=(e=>CheckForTrophy(e.key)),onunload=(e=>StopSpeech()),buttonFullScreen.onmousedown=(()=>activeWindow.FullScreen()),buttonHelp.onmousedown=buttonCode.onmousedown=(()=>activeWindow.ShowCode()),buttonResetSize.onmousedown=(()=>activeWindow.SetActive(1,1,activeWindow.Resize(1,soundGrow))),buttonReload.onmousedown=(()=>activeWindow.Reload()),buttonClose.onmousedown=(()=>activeWindow.Close()),RebuildMenu(loadIcon=new OS13kTaskbarIcon({icon:"üíæ",name:"Load Program"},new OS13kProgramMenu(programStubs))),OS13k.Trophy("","üëã","Welcome to OS13k!");for(const e in localStorage)CheckForTrophy(e);Update(UpdateStartup())},RebuildMenu=()=>{const e=[],t=o=>o.map(o=>o[7]?t(o[7]):e.push(o));t(programStubs),loadIcon&&loadIcon.windowOrMenu.lastChild&&(loadIcon.windowOrMenu.removeChild(loadIcon.windowOrMenu.lastChild),programStubs.pop()),CreateUserFolder(programStubs,[,"üòÄ",,,,"User Programs"],"",e),loadIcon.windowOrMenu.Rebuild()},CreateUserFolder=(e,t,o,s)=>{const i=[[,"üìå",,,newUserProgram,"New User Program",,,,o],[,"‚ö†Ô∏è",,,deleteUserPrograms,o?`Delete User Folder "${o}"`:"Delete User Programs",,,,o]],r=[];o||programInfos.map(e=>null!=e.code&&e.userFolder&&!r.includes(e.userFolder)&&CreateUserFolder(i,[,"üìÅ",,,,e.userFolder],e.userFolder,s,r.push(e.userFolder))),programInfos.map(e=>null!=e.code&&e.userFolder==o&&i.push(s.find(t=>t[8]==e.id)||[,e.icon,e.width,e.height,defaultFlags|code,e.name,,,e.id,e.userFolder])),t[7]=i,e.push(t)},UpdateStartup=()=>!loading&!finishedStartup&&OS13k.Save(musicTrayIcon.prepend(analyserCanvas=document.createElement("canvas")),analyserCanvas.style="width:16;height:16;margin:2;pointer-events:none;display:none",self==top&&startProgram&&startProgram.Open(startProgram=0),finishedStartup=1),Update=e=>{requestAnimationFrame(Update);const t=document.activeElement,o=t.shadowRoot&&t.shadowRoot.activeElement==t.iframe?t.iframe:0;if(o&&lastActiveFrame!=o&&t.SetActive(hadInput=1),lastActiveFrame=o,loading||(document.body.style.opacity=Math.min(1,.02+1*document.body.style.opacity)),trophyTrayIcon.innerHTML=trophies.length+"üèÜ",clockTrayIcon.title=new Date,clockTrayIcon.innerHTML=clockTrayIcon.title.replace(/.* (\d+):(\d+).*/,(e,t,o)=>(t%12||12)+":"+o),!finishedStartup||!hadInput)return;const s=new Uint8Array(musicAnalyser.fftSize=512),i=analyserCanvas.getContext("2d");musicAnalyser.getByteFrequencyData(s),analyserCanvas.width=analyserCanvas.height=32;for(let t=0;t<32;){const o=(s[t+3]/255)**3*(1+Math.log10((t+3)*defaultSampleRate/1024));i.fillStyle=`hsl(${-99-59*o} 99%50%)`,i.fillRect(t,31,1,-7*o),analyserData[t++]=OS13k.Clamp(o/5,0,1),lastMusicTime=o?e:lastMusicTime}analyserCanvas.style.display=e-lastMusicTime<1e4?"":"none";let r=0;[...popups.children].map((e,t)=>{if(e.speak&&OS13k.Speak(e.speak,1,1,1,e.speakLanguage),e.speak=0,settings.p){if(!document.fullscreenElement){let o=e.style.visibility?innerHeight:parseInt(e.style.top)+r-9;e.style.visibility="",o<taskbarHeight&&(o=taskbarHeight,!t&&(e.style.opacity=(e.style.opacity||3)-.01)<0&&(r+=e.getBoundingClientRect().height,popups.removeChild(e))),e.style.top=o}}else popups.removeChild(e)})},CloseMenus=()=>{[...programsMenu.children].map(e=>e.style.visibility=menu.style.visibility=""),activeProgram&&(activeProgram.className="program")},CheckForTrophy=(e,t=(e?e.split(","):[]))=>"OS13kTrophy"==t.shift()&&OS13k.Trophy(...t,localStorage[e]),StopSpeech=()=>speechSynthesis&&speechSynthesis.cancel(),SystemSound=(e,t)=>finishedStartup&hadInput&settings.o&&OS13k.PlaySeed(e,t);let grabWindow,grabOffsetX,grabOffsetY,finishedStartup,activeWindow,activeProgram,activeTaskbarIcon,loadIcon,allCodeIsSafe,analyserCanvas,lastActiveFrame,startProgram,startProgramId,trophyTrayIcon,settingsTrayIcon,clockTrayIcon,musicTrayIcon,nextUserProgramId=0,analyserData=[],lastMusicTime=-1e4,topZ=0,loading=0,hadInput=0,windowOpenX=startOpenOffset,windowOpenY=startOpenOffset+taskbarHeight,programInfos=[],trophies=[],settings={v:.3,m:.3,s:1,p:1,o:1,c:"#222233",d:"#332222",t:"OS13k",f:""};class OS13kProgramMenu extends HTMLElement{constructor(e,t){super(),this.className="programMenu",this.parentMenu=t,this.programStubs=e}Rebuild(e=0){for(const e of this.programStubs){const t=e[-1]=e[-1]||new OS13kProgram(...e);t.programMenu=t.folder?new OS13kProgramMenu(t.folder,this):this}this.innerHTML="",programsMenu.appendChild(this),this.programStubs.map(e=>this.appendChild(e[-1])),this.style.top=e,this.style.left=this.parentMenu?this.parentMenu.getBoundingClientRect().right-2:programsMenu.style.left=0,this.programStubs.map(t=>{t[-1].programMenu!=this&&t[-1].programMenu.Rebuild(e),e+=programHeight})}SetActive(){CloseMenus(),this.parentMenu&&this.parentMenu.SetActive(),this.style.visibility="visible"}NewUserProgram(e,t){const o=e?[,e.icon,e.width,e.height,defaultFlags|code,e.name+"+",,,++nextUserProgramId,e.userFolder]:[,"‚úã",,,defaultFlags|code,,,,++nextUserProgramId,t],s=o[-1]=new OS13kProgram(...o);return this.programStubs.push(o),s.info.code=e?(s.info.scale=e.info.scale,windowOpenX=e.info.x,windowOpenY=e.info.y+titlebarHeight,e.info.code):"// Auto detects HTML, Dweet, or Shadertoy! You can drop files here too. ‚úåÔ∏èüòÑ\nfor(x.fillRect(0,0,i=s=2e3,s);i--;x.globalAlpha=.1)\nx.clearRect((S(i)*1e9-t*i/9)%s,i*9%s,i%9,i%9)",s.stopFocus=1,s.Open(s.userProgram=allCodeIsSafe=1),s.window.ShowCode(1),s.window.codeText.focus(),s.stopFocus=0,RebuildMenu(s.programMenu=this),s}}customElements.define("m-",OS13kProgramMenu);class OS13kProgram extends HTMLElement{constructor(e="",t="üí†",o=defaultWidth,s=defaultHeight,i,r="",a="",n,d,l){super();const h=e.split("."),c=h[0].split("/").pop().replace(/([a-z](?=[A-Z]))/g,"$1 ");r=r||c&&c[0].toUpperCase()+c.slice(1),this.isDweet="dweet"==h[1],this.isShader="shader"==h[1],this.className="program",this.src=e,this.width=o,this.height=s,this.folder=n,this.id=d||r,this.userFolder=l,this.SetName(t,r),this.code=!(this.help=a)&&(i&code||this.isDweet|this.isShader&&null==i),this.flags=i=i||defaultFlags,this.sticky=i&sticky,this.reload=i&reload,this.awake=i&awake,this.full=i&full,this.resize=i&resize,this.Load(),this.userProgram=null!=this.info.code,"Settings"==r&&settingsTrayIcon.SetProgram(this),"Trophy Case"==r&&trophyTrayIcon.SetProgram(this),"Clock"==r&&clockTrayIcon.SetProgram(this),"Music Player"==r&&musicTrayIcon.SetProgram(this),"Help"==r&&null==this.info.open&&(startProgram=this),this.sticky?this.info.open&&this.Open():this.id==startProgramId&&(startProgram=this)}SetName(e,t){this.icon=e,this.innerHTML='<span style="pointer-events:none;width:45;text-shadow:1px 1px 3px#000;text-align:center">'+e,this.innerHTML+=`<div style=flex:1;padding-right:9;pointer-events:none>${this.name=OS13k.StripHTML(t)||"User Program "+this.id}</div>`+(this.folder?"‚ñ∂":"")}Move(){this.programMenu.SetActive(),this.className="program programActive",activeProgram!=this&&SystemSound(soundProgram,0),activeProgram=this}Open(){if(this.window)this.window.SetActive(1,1);else if(this.src||this.userProgram){let e=this.info.x,t=this.info.y;e||(e=windowOpenX,t=windowOpenY,(windowOpenX+=titlebarHeight)>400&&(windowOpenX=windowOpenY=startOpenOffset),(windowOpenY+=titlebarHeight)>300&&(windowOpenY=windowOpenY=startOpenOffset+taskbarHeight)),this.window=new OS13kWindow(this,e,t),this.Save()}this.flags&newUserProgram&&this.programMenu.NewUserProgram(void 0,this.userFolder),this.flags&deleteUserPrograms&&confirm(this.name+"?")&&([...desktop.children].map(e=>e.Close&&(this.userFolder?e.program.info.userFolder==this.userFolder:null!=e.program.info.code)&&e.Close()),programInfos=programInfos.filter(e=>null==e.code||this.userFolder&&e.userFolder!=this.userFolder),RebuildMenu(OS13k.Save(SystemSound(soundClose,4)))),this.flags&closeAll&&([...desktop.children].map(e=>e.Close&&e.Close()),windowOpenX=startOpenOffset,windowOpenY=startOpenOffset+taskbarHeight,OS13k.Trophy("OS13k","‚òï","Coffee Is For Closers","Closed All"))}SetActive(){this.Open()}Toggle(){activeWindow&&activeWindow==this.window?this.window.Close():this.Open()}Load(){const e=programInfos.findIndex(e=>e.id==this.id);this.info=e<0?{}:programInfos[e]}Save(e=1){this.info={open:e,id:this.id,x:e|this.sticky?parseInt(this.window.style.left):0,y:parseInt(this.window.style.top),scale:e|this.sticky?this.window.scale:1,name:this.name,icon:this.icon,width:this.width,height:this.height,code:this.info.code,allowSleep:this.userProgram?this.window.allowSleep.checked:1,liveEdit:this.window.liveEdit.checked,userFolder:this.userFolder};const t=programInfos.findIndex(e=>e.id==this.id);t<0?programInfos.push(this.info):programInfos[t]=this.info,OS13k.Save()}}customElements.define("p-",OS13kProgram);class OS13kWindow extends HTMLElement{constructor(e,t,o){super(),desktop.appendChild(this),this.program=e,this.style.left=t,this.style.top=o,this.menu=1,this.activeCount=0,this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=T.innerHTML,this.titlebar=this.shadowRoot.appendChild(document.createElement("div")),this.titlebar.id="titlebar";const s=(e,t,o="path")=>{this.titlebar.innerHTML+=`<div id=${e.split(" ")[0]} title=${e}>`+`<svg viewBox='0 0 10 10'style=height:100%;width:28;pointer-events:none><${o} stroke=#000 fill=none ${t} />`};e.resize&&s("Grow",'d="M2 5L8 5M5 8L5 2"',s("Shrink",'d="M2 5L8 5"')),e.full&&s("Full Screen","x=1 y=2 width=8 height=6","rect"),e.help&&s("Help",'d="M5 8L8 2L2 2L5 8L8 2"'),e.code&&s("Code",'d="M5 2L8 8L2 8L5 2L8 8"'),e.reload&&s("Reload","cx=5 cy=5 r=3","circle"),s("Close",'d="M2 2L8 8M8 2L2 8"'),this.titlebar.prepend(this.name=document.createElement("div")),this.name.id="name";const i=()=>{this.name.innerHTML=`<span id=icon>${e.icon}`,this.name.innerHTML+=e.name};i(),this.iframeWrapper=this.shadowRoot.appendChild(document.createElement("div")),this.iframeWrapper.style.background="#000",this.codeDisplay=this.shadowRoot.appendChild(document.createElement("div")),this.codeDisplay.id="codeDisplay",this.codeText=this.codeDisplay.appendChild(document.createElement("textarea")),this.codeText.id="codeText",e.userProgram?this.codeText.value=e.info.code:this.codeText.readOnly=!0,this.codeText.spellcheck=!1,this.codeOptions=this.codeDisplay.appendChild(document.createElement("div")),this.codeOptions.id="codeOptions",this.codeOptions.style.display=e.userProgram?"":"none",this.codeOptions.innerHTML="<span><button id=S>üì∑</button></span><span>Icon <input style=width:50 id=I></span> <span>Name <input id=N></span> <span>Folder <input id=F></span> <span>Size <input style=width:50 type=number id=W>x<input style=width:50 type=number id=H></span>"+`<span>Sleep <input type=checkbox id=P ${0!=e.info.allowSleep?"checked":""}></span>`+`<span>Live Edit <input type=checkbox id=L ${0!=e.info.liveEdit?"checked":""}></span>`+"<span><button id=G>Save</button></span><span><button id=C>Copy</button></span><span><button id=D>Delete</button></span>"+`<span><span id=Z>${e.info.code&&e.info.code.length}</span> Bytes`+"<a id=A><canvas id=V style=display:none>";const r=this.shadowRoot.getElementById("I"),a=this.shadowRoot.getElementById("N"),n=this.shadowRoot.getElementById("F"),d=this.shadowRoot.getElementById("W"),l=this.shadowRoot.getElementById("H"),h=this.shadowRoot.getElementById("A"),c=this.shadowRoot.getElementById("V"),u=c.getContext("2d");this.errorText=this.codeDisplay.appendChild(document.createElement("textarea")),this.errorText.id="errorText",this.errorText.readOnly=!0,this.shadowRoot.getElementById("C").onmousedown=(()=>e.programMenu.NewUserProgram(e)),this.shadowRoot.getElementById("D").onmousedown=(()=>{this.Close(),RebuildMenu(OS13k.Save(programInfos=programInfos.filter(t=>t.id!=e.id)))}),this.shadowRoot.getElementById("G").onmousedown=(()=>h.click(SystemSound(soundSave),h.href=URL.createObjectURL(new Blob([this.codeText.value],{type:"text/plain"})),h.download="OS13k_File_"+e.name)),this.screenshot=this.shadowRoot.getElementById("S"),this.screenshot.onmousedown=(()=>{try{h.click(SystemSound(soundSave),u.fillRect(0,0,c.width=this.iframeContent.c.width,c.height=this.iframeContent.c.height,u.fillStyle="#fff"),u.drawImage(this.iframeContent.c,0,0),h.href=c.toDataURL("image/jpeg"),h.download="OS13k_Image_"+e.name)}catch(e){}}),this.codeSize=this.shadowRoot.getElementById("Z"),this.liveEdit=this.shadowRoot.getElementById("L"),this.allowSleep=this.shadowRoot.getElementById("P"),r.value=e.icon,a.value=e.name,null!=e.userFolder&&(n.value=e.userFolder),d.value=e.width,l.value=e.height,r.oninput=a.oninput=this.liveEdit.oninput=(t=>e.Save(i(this.taskbarIcon.SetName(e.SetName(OS13k.StripHTML(r.value),a.value))))),n.oninput=(t=>RebuildMenu(e.Save(e.userFolder=OS13k.StripHTML(n.value.trim())))),d.onchange=l.onchange=(t=>{e.width=d.value=OS13k.Clamp(d.value,99,defaultWidth),e.height=l.value=OS13k.Clamp(l.value,99,2*e.width),this.Resize(1),this.SetActive(1,1)}),this.allowSleep.oninput=(t=>this.Reload(1,e.Save()));const m=e.resize?Math.min(e.width*(e.info.scale||1),innerWidth-6):e.width;this.style.width=m,this.iframeWrapper.style.height=m*e.height/e.width,this.scale=m/e.width,OS13k.Speak(e.name),this.CreateFrame(loading+=!finishedStartup)}WriteToFrame(e){this.iframeContent.document.open(),this.iframeContent.onerror=((e,t,o,s,i)=>this.SetErrorText(i,i.stack&&[s,o])),(!this.program.userProgram||allCodeIsSafe)&&this.iframeContent.document.write(e),this.iframeContent.document.close()}SetErrorText(e,t){return this.errorText.value=e+(t?` (${t[0]+":"+(t[1]-1)})`:""),this.errorText.style.display=null!=e?"":"none",!0}CreateFrame(){const e=()=>{o.userProgram&&("<"!=o.info.code.trim()[0]?o.isDweet=!(o.isShader=o.info.code.search(/void\s+mainImage/)>=0):o.isDweet=o.isShader=0);const e=o.isDweet||o.isShader,i=!this.program.userProgram||allCodeIsSafe;this.screenshot.disabled=!e||!i,o.userProgram&&(t.onerror=((e,t,o,s,i)=>this.SetErrorText(i,i.stack&&[s,o])));const r=t.document,a=o.userProgram?o.info.code:o.help||(e?r.body.innerText:r.body.innerHTML);if(o.userProgram||(this.codeText.value=a),t.OS13k=OS13k,t.OS13kWindow=this,t.zzfx=zzfx,t.zzfxG=zzfxG,i||(r.body.style.background="#111"),e&&i)try{this.WriteToFrame(`<canvas id=c width=1920 height=1080 style=width:100%;background:${o.isShader?"#000":"#fff"}>`),r.body.style="background:#111;overflow:hidden;margin:0;display:flex;align-items:center";const e=o.userProgram&&!o.isShader?a.replace(/(for\s*\((?!\s+of\s+)(?!\s+in\s+)[^;]*;[^;]*;|while\s*\()\s*(\S)/g,(e,t,o)=>t&&o?t+'++OS13kL>1e5&&(e=>{throw"Timed out!"})()'+(")"==o?"":",")+o:e):a;onerror=((e,t,o,s,i)=>{throw this.SetErrorText(i,i.stack&&[s,o]),i}),t.eval("OS13k=parent.OS13k;x=c.getContext"+(o.isShader?`('webgl2'${o.userProgram?",{preserveDrawingBuffer:true}":""});`+"X=Y=Z=W=0;onmousemove=e=>e.buttons&&(X=e.x,Y=c.height-e.y);onmousedown=e=>(X=Z=e.x,Y=W=c.height-e.y);onmouseup=e=>Z=W=0;"+`s=OS13k.CreateShader(c,\`${e}\`);`+"OS13kU=t=>OS13k.RenderShader(c,s,t/1e3,frame++,X,Y,Z,W,c.width=innerWidth,c.height=innerHeight)":"('2d');zzfx=parent.zzfx;S=Math.sin;C=Math.cos;T=Math.tan;R=(r,g,b,a=1)=>`rgba(${0|r},${0|g},${0|b},${a})`;"+`u=t=>{\n${e}\n};`+"OS13kU=t=>t>OS13kF-2&&u(((t=frame++/60)*60|0==frame-1)&&t>0?t+1e-6:t,OS13kL=0,OS13kF=Math.max(OS13kF+100/6,t))")+";(OS13kA=t=>(requestAnimationFrame(OS13kA),"+(o.awake||0==o.info.allowSleep?"":"t<1e3|parent.document.activeElement==OS13kWindow&&")+"OS13kU(t)))(frame=OS13kF=0)")}catch(e){if(!o.userProgram)throw e}i||(t.onmousedown=(e=>(this.Reload(allCodeIsSafe=1),onmousedown(e)))),t.ondrop=t.ondragover=t.oncontextmenu=(()=>!1),this.taskbarIcon||(this.taskbarIcon=new OS13kTaskbarIcon(o,this)).SetActive(),this.style.visibility=this.iframe.style.visibility="visible",loading=loading&&--loading,UpdateStartup(),o.userProgram&&(this.iframe.onload=(()=>s++&&this.Reload(1,0))),grabWindow&&onmouseup()};this.iframe&&this.iframeWrapper.removeChild(this.iframe),this.iframe=this.iframeWrapper.appendChild(document.createElement("iframe"));const t=this.iframeContent=this.iframe.contentWindow,o=this.program;let s=0;this.iframe.id="frame",o.userProgram?(this.SetErrorText(),this.codeText.onkeydown=(e=>!e.altKey||13==e.keyCode&&this.SetCode(this.codeText.value)),this.codeText.oninput=(e=>this.liveEdit.checked&&this.SetCode(this.codeText.value)),e(this.WriteToFrame(o.info.code))):(this.iframe.onload=(()=>e()),this.iframe.src=o.src+"?v75")}SetCode(e,t){t&&(this.codeText.value=e),this.program.info.code=e,this.codeSize.innerHTML=e.length,this.program.Save(),this.CreateFrame(allCodeIsSafe=1)}Open(e,t,o){if("C"!=e.id&&this.SetActive(),e==this.name)return grabWindow=this,SystemSound(soundGrabStart),document.body.style.cursor="grabbing",desktop.style.pointerEvents="none",grabOffsetX=t-parseInt(this.style.left),void(grabOffsetY=o-parseInt(this.style.top));"Full"==e.id&&this.FullScreen(),"Reload"==e.id&&this.Reload(),"Close"==e.id&&this.Close(),"Shrink"==e.id&&this.Resize(this.scale-.2,soundShrink),"Grow"==e.id&&this.Resize(this.scale+.2,soundGrow),"Help"==e.id|"Code"==e.id&&this.ShowCode()}Resize(e,t){const o=OS13k.Clamp(this.program.width*e,170,1920);this.style.left=parseInt(this.style.left)+parseInt(this.style.width)-o,this.style.width=o,this.iframeWrapper.style.height=this.program.height*(this.scale=o/this.program.width),this.program.Save(),t&&SystemSound(t)}SetActive(e=1,t){if(CloseMenus(),this.className=e?"activeWindow":"",this.titlebar.className="titlebar titlebar"+(e?"Active":"")+(this.program.sticky?"Sticky":this.program.userProgram?"User":""),this.iframeWrapper.style.filter=e||this.program.awake?"":"saturate(.7)brightness(.7",!e)return;finishedStartup&&!this.program.sticky&&OS13k.Save(startProgramId=this.program.id),loading||this.program.stopFocus||document.activeElement!=this&&setTimeout(e=>this.iframeContent&&this.iframeContent.focus(lastActiveFrame=this.iframe));const o=this.getBoundingClientRect();if(t&&(this.style.left=OS13k.Clamp(o.x,0,innerWidth-o.width,this.style.top=OS13k.Clamp(o.y,taskbarHeight,Math.max(taskbarHeight,innerHeight-o.height)))),activeWindow!=this){activeWindow&&activeWindow.SetActive(0),activeWindow=this,SystemSound(this.activeCount++?soundActive:soundOpen),this.style.zIndex=++topZ;const e=(e,t)=>e.style.display=t?"":"none";e(buttonFullScreen,this.program.full),e(buttonCode,this.program.code),e(buttonHelp,this.program.help),e(buttonReload,this.program.reload),e(buttonResetSize,this.program.resize),this.taskbarIcon&&this.taskbarIcon.SetActive()}}FullScreen(){this.program.full&&(allCodeIsSafe||this.Reload(allCodeIsSafe=1),SystemSound(soundFullScreen),this.iframeContent.focus(),this.iframeWrapper.webkitRequestFullScreen&&this.iframeWrapper.webkitRequestFullScreen(),this.iframeWrapper.mozRequestFullScreen&&this.iframeWrapper.mozRequestFullScreen(),OS13k.Trophy("OS13k","üïπÔ∏è","Pro Gamer","Went Full Screen"))}ShowCode(e){this.codeDisplay.style.display=(this.showCode=!this.showCode)?"inline":"",e||SystemSound(this.program.help?soundHelp:soundCode),activeWindow.SetActive(1,1),this.program.help||OS13k.Trophy("OS13k","üë®‚Äçüíª","Hacker","Viewed Code")}Reload(e,t=1){this.program.userProgram&&(this.program.info.code=this.codeText.value),this.program.Save(),e||SystemSound(soundReload),activeWindow.SetActive(1,t),this.iframeContent&&this.iframeContent.OS13kReload?this.iframeContent.OS13kReload():this.program.userProgram?this.SetCode(this.program.info.code):this.CreateFrame(this.iframe.style.visibility="")}Close(){this.program.id==startProgramId&&(startProgramId=""),SystemSound(soundClose),this.program.Save(0),this.program.window=0,this.taskbarIcon&&this.taskbarIcon.remove(),this.remove()}}customElements.define("w-",OS13kWindow);class OS13kTaskbarIcon extends HTMLElement{constructor(e,t){super(),this.className="taskbarIcon",this.program=e,this.menu=this.windowOrMenu=t,this.SetName(),taskbarSpace.before(this)}SetName(){this.innerHTML="<div style=pointer-events:none>"+(this.program.icon||"üí†"),this.title=this.program.name}Open(){this.SetActive()}SetActive(e=1){if(e&&this.windowOrMenu.SetActive(1,1),this==loadIcon)return SystemSound(soundMenu,.5);this.className="taskbarIcon "+(e?"taskbarIconActive":""),e&&activeTaskbarIcon!=this&&(activeTaskbarIcon&&activeTaskbarIcon.SetActive(0),activeTaskbarIcon=this)}}customElements.define("i-",OS13kTaskbarIcon);class OS13kTrayIcon extends HTMLElement{constructor(){super(),this.className="trayIcon",tray.appendChild(this)}SetProgram(e){this.program=e,this.title=e.name,this.innerHTML=e.icon}Open(){this.program?this.program.Toggle():this.functionCall()}}customElements.define("t-",OS13kTrayIcon),onmousedown=(e=>{if(hadInput=1,e.target==loadIcon&&e.target.windowOrMenu.style.visibility)return CloseMenus(),activeWindow&&activeWindow.SetActive(),!1;if(CloseMenus(),programsMenu.style.left=0,programsMenu.style.top=taskbarHeight,grabWindow)return onmouseup(e);const t=e.originalTarget||e.path[0];if(!e.button)return e.target.Open?e.target.Open(t,e.x,e.y):activeWindow&&activeWindow.SetActive(),e.target==loadIcon||/input|textarea/.test(t.localName);if("button"==t.localName)return!1;if(2&e.button){(e.target.SetActive?e.target:loadIcon).SetActive();const t=e.target.menu?(SystemSound(soundMenu,.5),menu):programsMenu;t.style.left=e.x,t.style.top=e.y,t.style.visibility="visible"}}),onmousemove=(e=>{grabWindow&&(grabWindow.style.left=e.x-grabOffsetX),grabWindow&&(grabWindow.style.top=e.y-grabOffsetY),e.target.Move&&e.target.Move()}),onmouseup=(()=>grabWindow&&(grabWindow.program.Save(),SystemSound(42),grabWindow.SetActive(1,0),document.body.style.cursor=desktop.style.pointerEvents=grabWindow="")),oncontextmenu=(()=>!1),ondragover=(()=>!1),ondrop=(e=>{if(e.target.program.userProgram&&"codeText"==(e.originalTarget||e.path[0]).id){const t=new FileReader;t.onload=(t=>e.target.SetActive(1,0,e.target.SetCode(t.target.result,1))),t.readAsText(e.dataTransfer.files[0],"utf-8")}return!1});var zzfx=(...e)=>OS13k.PlaySamples(zzfxG(...e)),zzfxG=(e=1,t=.05,o=220,s=0,i=0,r=.1,a=0,n=1,d=0,l=0,h=0,c=0,u=0,m=0,p=0,g=0,S=0,f=1,y=0,w=[],k=defaultSampleRate)=>{s=99+s*k,i*=k,r*=k,y*=k,S*=k;let v=2*Math.PI,b=e=>1+2*e*Math.random()-e,O=e=>e>0?1:-1,C=s+y+i+r+S,I=d*=500*v/k**2,T=o*=b(t)*v/k,x=O(p)*v/4,M=0,P=0,R=0,F=1,W=0,A=0,L=0;for(u*=k,c*=k,h*=v/k,l*=500*v/k**3,p*=v/k;R<C;w[R]=(w[R++]||0)+L)++A>100*g&&(A=0,L=M*o*Math.sin(P*p-x),L=O(L=a?a>1?a>2?a>3?Math.sin((L%v)**3):OS13k.Clamp(Math.tan(L),-1,1):1-(2*L/v%2+2)%2:1-4*Math.abs(Math.round(L/v)-L/v):Math.sin(L))*Math.abs(L)**n*e*(R<s?R/s:R<s+y?1-(R-s)/y*(1-f):R<s+y+i?f:R<C-S?(C-R-S)/r*f:0),L=S?L/2+(S>R?0:(R<C-S?1:(R-C)/S)*w[R-S|0]/2):L),M+=b(m),P+=b(m),o+=d+=l,F&&++F>c&&(o+=h,T+=h,F=0),u&&++W>u&&(o=T,d=I,W=1,F=F||1);return w},zzfxM=(e,t,o,s=6,i)=>{let r,a,n,d,l,h,c,u,m,p,g,S=defaultSampleRate/(50/s)|0,f=0,y={},w=[],k=[];return o.map(o=>{t[o].map((t,o)=>{for(a=f,c=i?.5+(i[o]||0)/2:o%2*2-1,h=0;h<t.length;a+=S)for(m=t[h++]||m,(g=t[h++])&&(n=y[d=[g,m,u=l=0]]||((p=[...e[m-1]])[2]=OS13k.Note(g-12,p[2]),y[d]=zzfxG(...p))),u=t[h++]/64||u,r=a;r<a+S;){const e=n&&n[l++]*(1-u)||0;w[r]=(w[r]||0)+e*(1-c),k[r]=(k[r++]||0)+e*c}}),f=r}),[w,k]};Start()</script>